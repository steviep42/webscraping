<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Web Scraping with R</title>
  <meta name="description" content="This is in support of my talk for the Data Science group">
  <meta name="generator" content="bookdown <!--bookdown:version--> and GitBook 2.6.7">

  <meta property="og:title" content="Web Scraping with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is in support of my talk for the Data Science group" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Web Scraping with R" />
  
  <meta name="twitter:description" content="This is in support of my talk for the Data Science group" />
  

<meta name="author" content="Steve Pittard">


<meta name="date" content="2018-11-12">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.1/leaflet.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Web Scraping with R</h1>
<h4 class="author"><em>Steve Pittard</em></h4>
<h4 class="date"><em>2018-11-12</em></h4>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#motivations"><span class="toc-section-number">1</span> Motivations</a><ul>
<li><a href="#lots-of-data-for-the-taking"><span class="toc-section-number">1.1</span> Lots of Data For The Taking ?</a></li>
<li><a href="#web-scraping-can-be-ugly"><span class="toc-section-number">1.2</span> Web Scraping Can Be Ugly</a></li>
<li><a href="#understanding-the-language-of-the-web"><span class="toc-section-number">1.3</span> Understanding The Language of The Web</a></li>
<li><a href="#useful-packages"><span class="toc-section-number">1.4</span> Useful Packages</a></li>
<li><a href="#quick-rvest-tutorial"><span class="toc-section-number">1.5</span> Quick <strong>rvest</strong> tutorial</a></li>
<li><a href="#example-parsing-a-table-from-wikipedia"><span class="toc-section-number">1.6</span> Example: Parsing A Table From Wikipedia</a></li>
<li><a href="#summary"><span class="toc-section-number">1.7</span> Summary</a></li>
</ul></li>
<li><a href="#xml"><span class="toc-section-number">2</span> XML and JSON</a><ul>
<li><a href="#finding-xpaths"><span class="toc-section-number">2.1</span> Finding XPaths</a></li>
<li><a href="#example-geocoding-with-google"><span class="toc-section-number">2.2</span> Example: GeoCoding With Google</a></li>
<li><a href="#using-json"><span class="toc-section-number">2.3</span> Using JSON</a></li>
<li><a href="#using-the-rjsonio-package"><span class="toc-section-number">2.4</span> Using the RJSONIO Package</a></li>
</ul></li>
<li><a href="#Moreexamples"><span class="toc-section-number">3</span> More Real Life Examples</a><ul>
<li><a href="#bitcoin-prices"><span class="toc-section-number">3.1</span> BitCoin Prices</a></li>
<li><a href="#faculty-salaries"><span class="toc-section-number">3.2</span> Faculty Salaries</a></li>
<li><a href="#filling-out-forms-from-a-program"><span class="toc-section-number">3.3</span> Filling Out Forms From a Program</a></li>
<li><a href="#pubmed"><span class="toc-section-number">3.4</span> PubMed</a></li>
</ul></li>
<li><a href="#APIs"><span class="toc-section-number">4</span> APIs</a><ul>
<li><a href="#omdb"><span class="toc-section-number">4.1</span> OMDB</a></li>
<li><a href="#the-omdbapi-package"><span class="toc-section-number">4.2</span> The omdbapi package</a></li>
<li><a href="#rselenium"><span class="toc-section-number">4.3</span> RSelenium</a></li>
<li><a href="#easypubmed"><span class="toc-section-number">4.4</span> EasyPubMed</a></li>
</ul></li>
<li><a href="#bagofwords"><span class="toc-section-number">5</span> Bag of Words Sentiment Analysis</a><ul>
<li><a href="#workflow"><span class="toc-section-number">5.1</span> Workflow</a></li>
<li><a href="#simple-example"><span class="toc-section-number">5.2</span> Simple Example</a></li>
<li><a href="#tidytext"><span class="toc-section-number">5.3</span> tidytext</a></li>
<li><a href="#back-to-the-pubmed-example"><span class="toc-section-number">5.4</span> Back To The PubMed Example</a></li>
<li><a href="#bigrams"><span class="toc-section-number">5.5</span> BiGrams</a></li>
</ul></li>
<li><a href="#final-words"><span class="toc-section-number">6</span> Final Words</a></li>
<li><a href="#references">References</a></li>
<li><a href="#motivations-1"><span class="toc-section-number">7</span> Motivations</a><ul>
<li><a href="#lots-of-data-for-the-taking-1"><span class="toc-section-number">7.1</span> Lots of Data For The Taking ?</a></li>
<li><a href="#web-scraping-can-be-ugly-1"><span class="toc-section-number">7.2</span> Web Scraping Can Be Ugly</a></li>
<li><a href="#understanding-the-language-of-the-web-1"><span class="toc-section-number">7.3</span> Understanding The Language of The Web</a></li>
<li><a href="#useful-packages-1"><span class="toc-section-number">7.4</span> Useful Packages</a></li>
<li><a href="#quick-rvest-tutorial-1"><span class="toc-section-number">7.5</span> Quick <strong>rvest</strong> tutorial</a></li>
<li><a href="#example-parsing-a-table-from-wikipedia-1"><span class="toc-section-number">7.6</span> Example: Parsing A Table From Wikipedia</a></li>
<li><a href="#summary-1"><span class="toc-section-number">7.7</span> Summary</a></li>
</ul></li>
<li><a href="#xml"><span class="toc-section-number">8</span> XML and JSON</a><ul>
<li><a href="#finding-xpaths-1"><span class="toc-section-number">8.1</span> Finding XPaths</a></li>
<li><a href="#example-geocoding-with-google-1"><span class="toc-section-number">8.2</span> Example: GeoCoding With Google</a></li>
<li><a href="#using-json-1"><span class="toc-section-number">8.3</span> Using JSON</a></li>
<li><a href="#using-the-rjsonio-package-1"><span class="toc-section-number">8.4</span> Using the RJSONIO Package</a></li>
</ul></li>
<li><a href="#Moreexamples"><span class="toc-section-number">9</span> More Real Life Examples</a><ul>
<li><a href="#bitcoin-prices-1"><span class="toc-section-number">9.1</span> BitCoin Prices</a></li>
<li><a href="#faculty-salaries-1"><span class="toc-section-number">9.2</span> Faculty Salaries</a></li>
<li><a href="#filling-out-forms-from-a-program-1"><span class="toc-section-number">9.3</span> Filling Out Forms From a Program</a></li>
<li><a href="#pubmed-1"><span class="toc-section-number">9.4</span> PubMed</a></li>
</ul></li>
<li><a href="#APIs"><span class="toc-section-number">10</span> APIs</a><ul>
<li><a href="#omdb-1"><span class="toc-section-number">10.1</span> OMDB</a></li>
<li><a href="#the-omdbapi-package-1"><span class="toc-section-number">10.2</span> The omdbapi package</a></li>
<li><a href="#rselenium-1"><span class="toc-section-number">10.3</span> RSelenium</a></li>
<li><a href="#easypubmed-1"><span class="toc-section-number">10.4</span> EasyPubMed</a></li>
</ul></li>
<li><a href="#bagofwords"><span class="toc-section-number">11</span> Bag of Words Sentiment Analysis</a><ul>
<li><a href="#workflow-1"><span class="toc-section-number">11.1</span> Workflow</a></li>
<li><a href="#simple-example-1"><span class="toc-section-number">11.2</span> Simple Example</a></li>
<li><a href="#tidytext-1"><span class="toc-section-number">11.3</span> tidytext</a></li>
<li><a href="#back-to-the-pubmed-example-1"><span class="toc-section-number">11.4</span> Back To The PubMed Example</a></li>
<li><a href="#bigrams-1"><span class="toc-section-number">11.5</span> BiGrams</a></li>
</ul></li>
<li><a href="#final-words-1"><span class="toc-section-number">12</span> Final Words</a></li>
<li><a href="#references-1">References</a></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Web Scraping with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="motivations" class="section level1">
<h1><span class="header-section-number">1</span> Motivations</h1>
<div id="lots-of-data-for-the-taking" class="section level2">
<h2><span class="header-section-number">1.1</span> Lots of Data For The Taking ?</h2>
<p>The web hosts lots of interesting data that you can ”scrape”. Some of it is stashed in data bases, behind APIs, or in free form text. Lots of people want to grab information of of Twitter or from user forums to see what people are thinking. There is a lot of valuable information out there for the taking although some web sites have “caught on” and either block programmatic access or they setup “pay walls” that require you to subscribe to an API for access. The New York Times does this. But there are lots of opportunities to get data.</p>
<table>
<tbody>
<tr class="odd">
<td>tables</td>
<td>Fetch tables like from Wikipedia</td>
</tr>
<tr class="even">
<td>forms</td>
<td>You can submit forms and fetch the results</td>
</tr>
<tr class="odd">
<td>css</td>
<td>You can access parts of a web site using style or css selectors</td>
</tr>
<tr class="even">
<td>Tweets</td>
<td>Process tweets including emojis</td>
</tr>
<tr class="odd">
<td>Web Sites</td>
<td>User forums have lots of content</td>
</tr>
<tr class="even">
<td>Instagram</td>
<td>Yes you can “scrape” photos also</td>
</tr>
</tbody>
</table>
</div>
<div id="web-scraping-can-be-ugly" class="section level2">
<h2><span class="header-section-number">1.2</span> Web Scraping Can Be Ugly</h2>
<p>Depending on what web sites you want to scrape the process can be involved and quite tedious. Many websites are very much aware that people are scraping so they offer Application Programming Interfaces (APIs) to make requests for information easier for the user and easier for the server administrators to control access. Most times the user must apply for a “key” to gain access. For premium sites, the key costs money. Some sites like Google and Wunderground (a popular weather site) allow some number of free accesses before they start charging you. Even so the results are typically returned in XML or JSON which then requires you to parse the result to get the information you want. In the best situation there is an R package that will wrap in the parsing and will return lists or data frames.</p>
<p>Here is a summary:</p>
<ul>
<li><p>First. Always try to find an R package that will access a site (e.g. New York Times, Wunderground, PubMed). These packages (e.g. omdbapi, easyPubMed, RBitCoin, rtimes) provide a programmatic search interface and return data frames with little to no effort on your part.</p></li>
<li><p>If no package exists then hopefully there is an API that allows you to query the website and get results back in JSON or XML. I prefer JSON because it’s “easier” and the packages for parsing JSON return lists which are native data structures to R. So you can easily turn results into data frames. You will ususally use the <em>rvest</em> package in conjunction with XML, and the RSJONIO packages.</p></li>
<li><p>If the Web site doesn’t have an API then you will need to scrape text. This isn’t hard but it is tedious. You will need to use <em>rvest</em> to parse HMTL elements. If you want to parse mutliple pages then you will need to use <em>rvest</em> to move to the other pages and possibly fill out forms. If there is a lot of Javascript then you might need to use RSelenium to programmatically manage the web page.</p></li>
</ul>
</div>
<div id="understanding-the-language-of-the-web" class="section level2">
<h2><span class="header-section-number">1.3</span> Understanding The Language of The Web</h2>
<p>The Web has its own languages: HTML, CSS, Javascript</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;</span>h1<span class="op">&gt;</span>, <span class="op">&lt;</span>h2<span class="op">&gt;</span>, ..., <span class="op">&lt;</span>h6<span class="op">&gt;</span><span class="st"> </span>Heading <span class="dv">1</span> and so on
<span class="op">&lt;</span>p<span class="op">&gt;</span><span class="st"> </span>Paragraph elements
<span class="op">&lt;</span>ul<span class="op">&gt;</span><span class="st"> </span>Unordered List
<span class="op">&lt;</span>ol<span class="op">&gt;</span><span class="st"> </span>Ordered List
<span class="op">&lt;</span>li<span class="op">&gt;</span><span class="st"> </span>List Element
<span class="op">&lt;</span>div<span class="op">&gt;</span><span class="st"> </span>Division <span class="op">/</span><span class="st"> </span>Section
<span class="op">&lt;</span>table<span class="op">&gt;</span><span class="st"> </span>Tables
<span class="op">&lt;</span>form<span class="op">&gt;</span><span class="st"> </span>Web forms</code></pre></div>
<p>So to be productive at scraping requires you to have some familiairty with HMTL XML, and CSS. Here we look at a very basic HTML file</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;!</span>DOCTYPE html<span class="op">&gt;</span>
<span class="er">&lt;</span>html<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>body<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>h1<span class="op">&gt;</span>My First Heading<span class="op">&lt;</span><span class="er">/</span>h1<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>p<span class="op">&gt;</span>My first paragraph.<span class="op">&lt;</span><span class="er">/</span>p<span class="op">&gt;</span>
<span class="st">   </span><span class="er">&lt;/</span>body<span class="op">&gt;</span>
<span class="er">&lt;/</span>html<span class="op">&gt;</span></code></pre></div>
<div class="figure">
<img src="PICS/first_heading.png" width="450" />

</div>
<p> </p>
<p>And you could apply some styling to this courtest of the CSS language which allows you to inject styles into plain HTML:</p>
<div class="figure">
<img src="PICS/css.png" width="450" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/css_page.png" width="450" />

</div>
<p>There are a number of tools that allow us to inspect web pages and see “what is under the hood”. Warning - I just discovered that one of my favorite browser plugins to find the xpaths and/or css paths of page elements is no longer supported under Firefox or Chrome. I’ve found a couple of replacements but they don’t work as well. I’ll research it more.</p>
<p> </p>
<table style="width:56%;">
<colgroup>
<col width="9%" />
<col width="45%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Selector Gadget</td>
<td><a href="http://selectorgadget.com/" class="uri">http://selectorgadget.com/</a></td>
</tr>
<tr class="even">
<td>Firebug</td>
<td><a href="https://getfirebug.com/" class="uri">https://getfirebug.com/</a> (now integrated into a version of Firefox)</td>
</tr>
<tr class="odd">
<td>Google Chrome</td>
<td>Right click to inspect a page element</td>
</tr>
<tr class="even">
<td>Google Chrome</td>
<td>View Developer - Developer Tools</td>
</tr>
<tr class="odd">
<td>Oxygen Editor</td>
<td>Can obtain via the Emory Software Express Site</td>
</tr>
</tbody>
</table>
</div>
<div id="useful-packages" class="section level2">
<h2><span class="header-section-number">1.4</span> Useful Packages</h2>
<p>You will use the following three primary packages to help you get data from various web pages: <em>rvest</em>, <em>XML</em>, and <em>RJSONIO</em>. Note that you won’t always use them simultaneously but you might use them in pairs or individually depending on the task at hand.</p>
</div>
<div id="quick-rvest-tutorial" class="section level2">
<h2><span class="header-section-number">1.5</span> Quick <strong>rvest</strong> tutorial</h2>
<p>Now let’s do a quick <em>rvest</em> tutorial:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>

(paragraphs &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;p&quot;</span>))</code></pre></div>
<pre><code>## {xml_nodeset (61)}
##  [1] &lt;p class=&quot;mw-empty-elt&quot;&gt; \n&lt;/p&gt;
##  [2] &lt;p class=&quot;mw-empty-elt&quot;&gt;\n&lt;/p&gt;
##  [3] &lt;p&gt;In &lt;a href=&quot;/wiki/Demographics&quot; class=&quot;mw-redirect&quot; title=&quot;Demog ...
##  [4] &lt;p&gt;World population has experienced &lt;a href=&quot;/wiki/Population_growt ...
##  [5] &lt;p&gt;Total annual births were highest in the late 1980s at about 139  ...
##  [6] &lt;p&gt;Six of the &lt;a href=&quot;/wiki/Earth&quot; title=&quot;Earth&quot;&gt;Earth&lt;/a&gt;&#39;s seven ...
##  [7] &lt;p&gt;Estimates of world population by their nature are an aspect of &lt; ...
##  [8] &lt;p&gt;It is difficult for estimates to be better than rough approximat ...
##  [9] &lt;p&gt;Estimates of the population of the world at the time agriculture ...
## [10] &lt;p&gt;The &lt;a href=&quot;/wiki/Plague_of_Justinian&quot; title=&quot;Plague of Justini ...
## [11] &lt;p&gt;Starting in AD 2, the &lt;a href=&quot;/wiki/Han_Dynasty&quot; class=&quot;mw-redi ...
## [12] &lt;p&gt;The &lt;a href=&quot;/wiki/Pre-Columbian_era&quot; title=&quot;Pre-Columbian era&quot;&gt; ...
## [13] &lt;p&gt;During the European &lt;a href=&quot;/wiki/British_Agricultural_Revoluti ...
## [14] &lt;p&gt;Population growth in the West became more rapid after the introd ...
## [15] &lt;p&gt;The first half of the 20th century in &lt;a href=&quot;/wiki/Russian_Emp ...
## [16] &lt;p&gt;Many countries in the &lt;a href=&quot;/wiki/Developing_world&quot; class=&quot;mw ...
## [17] &lt;p&gt;It is estimated that the world population reached one billion fo ...
## [18] &lt;p&gt;According to current projections, the global population will rea ...
## [19] &lt;p&gt;There is no estimation for the exact day or month the world&#39;s po ...
## [20] &lt;p&gt;As of 2012, the global &lt;a href=&quot;/wiki/Human_sex_ratio&quot; title=&quot;Hu ...
## ...</code></pre>
<p>Then we might want to actually parse out those paragraphs into text:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>
paragraphs &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;p&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()
paragraphs[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</code></pre></div>
<pre><code>##  [1] &quot; \n&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
##  [2] &quot;\n&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
##  [3] &quot;In demographics, the world population is the total number of humans currently living, and was estimated to have reached 7.7 billion people as of November 2018.[1] It took over 200,000 years of human history for the world&#39;s population to reach 1 billion;[2] and only 200 years more to reach 7 billion.[3]&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
##  [4] &quot;World population has experienced continuous growth since the end of the Great Famine of 1315–17 and the Black Death in 1350, when it was near 370 million.[4] \nThe highest population growth rates – global population increases above 1.8% per year – occurred between 1955 and 1975, peaking to 2.06% between 1965 and 1970.[5] The growth rate has declined to 1.18% between 2010 and 2015 and is projected to decline further in the course of the 21st century.[5]&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
##  [5] &quot;Total annual births were highest in the late 1980s at about 139 million,[6] and as of 2011 were expected to remain essentially constant at a level of 135 million,[7] while deaths numbered 56 million per year and were expected to increase to 80 million per year by 2040.[8] \nThe median age of the world&#39;s population was estimated to be 30.4 years in 2018.[9]&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [6] &quot;Six of the Earth&#39;s seven continents are permanently inhabited on a large scale. Asia is the most populous continent, with its 4.54 billion inhabitants accounting for 60% of the world population. The world&#39;s two most populated countries, China and India, together constitute about 36% of the world&#39;s population. Africa is the second most populated continent, with around 1.28 billion people, or 16% of the world&#39;s population. Europe&#39;s 742 million people make up 10% of the world&#39;s population as of 2018, while the Latin American and Caribbean regions are home to around 651 million (9%). Northern America, primarily consisting of the United States and Canada, has a population of around 363 million (5%), and Oceania, the least populated region, has about 41 million inhabitants (0.5%).[11] Though it is not permanently inhabited by any fixed population, Antarctica has a small, fluctuating international population based mainly in polar science stations. This population tends to rise in the summer months and decrease significantly in winter, as visiting researchers return to their home countries.[12]&quot;
##  [7] &quot;Estimates of world population by their nature are an aspect of modernity, possible only since the Age of Discovery. Early estimates for the population of the world[14] date to the 17th century: William Petty in 1682 estimated world population at  320 million (modern estimates ranging close to twice this number); by the late 18th century, estimates ranged close to one billion (consistent with modern estimates).[15] More refined estimates, broken down by continents, were published in the first half of the 19th century, at 600 to 1000 million in the early 1800s and at 800 to 1000 million in the 1840s.[16]&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
##  [8] &quot;It is difficult for estimates to be better than rough approximations, as even modern population estimates are fraught with uncertainties on the order of 3% to 5%.[17]&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [9] &quot;Estimates of the population of the world at the time agriculture emerged in around 10,000 BC have ranged between 1 million and 15 million.[18][19]  Even earlier, genetic evidence suggests humans may have gone through a population bottleneck of between 1,000 and 10,000 people about 70,000 BC, according to the Toba catastrophe theory. By contrast, it is estimated that around 50–60 million people lived in the combined eastern and western Roman Empire in the 4th century AD.[20]&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
## [10] &quot;The Plague of Justinian, which first emerged during the reign of the Roman emperor Justinian, caused Europe&#39;s population to drop by around 50% between the 6th and 8th centuries AD.[21] The population of Europe was more than 70 million in 1340.[22] The Black Death pandemic of the 14th century may have reduced the world&#39;s population from an estimated 450 million in 1340 to between 350 and 375 million in 1400;[23] it took 200 years for population figures to recover.[24] The population of China decreased from 123 million in 1200 to 65 million in 1393,[25] presumably due to a combination of Mongol invasions, famine, and plague.[26]&quot;</code></pre>
<p>Get some other types of HTML obejects. Let’s get all the “h2” HTML elements:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;h2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</code></pre></div>
<pre><code>##  [1] &quot;Contents&quot;                       &quot;Population by region&quot;          
##  [3] &quot;History&quot;                        &quot;Global demographics&quot;           
##  [5] &quot;Largest populations by country&quot; &quot;Fluctuation&quot;                   
##  [7] &quot;Mathematical approximations&quot;    &quot;Overpopulation&quot;                
##  [9] &quot;See also&quot;                       &quot;Notes&quot;                         
## [11] &quot;References&quot;                     &quot;External links&quot;                
## [13] &quot;Navigation menu&quot;</code></pre>
<p>What about tables ?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>
tables &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;table&quot;</span>) 
tables</code></pre></div>
<pre><code>## {xml_nodeset (23)}
##  [1] &lt;table class=&quot;plainlinks metadata ambox ambox-content&quot; role=&quot;presen ...
##  [2] &lt;table class=&quot;infobox&quot; style=&quot;float: right; font-size:90%&quot;&gt;&lt;tbody&gt;\ ...
##  [3] &lt;table class=&quot;wikitable sortable&quot;&gt;\n&lt;caption&gt;Population by continen ...
##  [4] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:center; float:right; cle ...
##  [5] &lt;table width=&quot;100%&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td valign=&quot;top&quot;&gt; &lt;div class=&quot;lege ...
##  [6] &lt;table class=&quot;wikitable sortable&quot; style=&quot;text-align:left&quot;&gt;&lt;tbody&gt;\n ...
##  [7] &lt;table class=&quot;wikitable sortable&quot; style=&quot;text-align:right&quot;&gt;\n&lt;capti ...
##  [8] &lt;table class=&quot;wikitable sortable&quot; style=&quot;text-align:right&quot;&gt;\n&lt;capti ...
##  [9] &lt;table class=&quot;wikitable sortable&quot; style=&quot;font-size:97%; text-align: ...
## [10] &lt;table class=&quot;wikitable sortable&quot; style=&quot;font-size:97%; text-align: ...
## [11] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:right;&quot;&gt;&lt;tbody&gt;\n&lt;tr&gt;\n&lt; ...
## [12] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:center; margin:1em; floa ...
## [13] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:right; font-size:96%;&quot;&gt;\ ...
## [14] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:center;&quot;&gt;\n&lt;caption&gt;Star ...
## [15] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:center;&quot;&gt;\n&lt;caption&gt;Star ...
## [16] &lt;table role=&quot;presentation&quot; class=&quot;mbox-small plainlinks sistersiteb ...
## [17] &lt;table class=&quot;nowraplinks collapsible autocollapse navbox-inner&quot; st ...
## [18] &lt;table class=&quot;nowraplinks collapsible collapsed navbox-inner&quot; style ...
## [19] &lt;table class=&quot;nowraplinks hlist collapsible autocollapse navbox-inn ...
## [20] &lt;table class=&quot;nowraplinks hlist collapsible autocollapse navbox-inn ...
## ...</code></pre>
</div>
<div id="example-parsing-a-table-from-wikipedia" class="section level2">
<h2><span class="header-section-number">1.6</span> Example: Parsing A Table From Wikipedia</h2>
<p>Look at the <a href="https://en.wikipedia.org/wiki/World_population">Wikipedia Page</a> for world population:</p>
<p><a href="https://en.wikipedia.org/wiki/World_population" class="uri">https://en.wikipedia.org/wiki/World_population</a></p>
<ul>
<li>We can get any table we want using rvest</li>
<li>We might have to experiment to figure out which one</li>
<li>Get the one that lists the ten most populous countries</li>
<li>I think this might be the 4th or 5th table on the page</li>
<li>How do we get this ?</li>
</ul>
<div class="figure">
<img src="PICS/worldpop.png" width="450" />

</div>
<p>First we will load packages that will help us throughout this session.</p>
<p>In this case we’ll need to figure out what number table it is we want. We could fetch all the tables and then experiment to find the precise one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)

<span class="co"># Use read_html to fetch the webpage</span>
url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>
ten_most_df &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) 
  
ten_most_populous &lt;-<span class="st"> </span>ten_most_df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()

<span class="co"># Let&#39;s get just the first three columns</span>
ten_most_populous &lt;-<span class="st"> </span>ten_most_populous[,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>]

<span class="co"># Get some content - Change the column names</span>
<span class="kw">names</span>(ten_most_populous) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Country_Territory&quot;</span>,<span class="st">&quot;Population&quot;</span>,<span class="st">&quot;Date&quot;</span>)

<span class="co"># Do reformatting on the columns to be actual numerics where appropriate</span>
ten_most_populous <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Population=</span><span class="kw">gsub</span>(<span class="st">&quot;,&quot;</span>,<span class="st">&quot;&quot;</span>,Population)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Population=</span><span class="kw">round</span>(<span class="kw">as.numeric</span>(Population)<span class="op">/</span><span class="fl">1e+06</span>))  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Country_Territory,<span class="dt">y=</span>Population)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Population / 1,000,000&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Top 10 Most Populous Countries&quot;</span>)</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>In the above example we leveraged the fact that we were looking specifically for a table element and it became a project to locate the correct table number. This isn’t always the case with more complicated websites in that the element we are trying to grab or scrape is contained within a nested structure that doesn’t correspond neatly to a paragraph, link, heading, or table. This can be the case if the page is heavily styled with CSS or Javascript. We might have to work harder. But it’s okay to try to use simple elements and then try to refine the search some more.</p>
</div>
<div id="summary" class="section level2">
<h2><span class="header-section-number">1.7</span> Summary</h2>
<ul>
<li>Need some basic HTML and CSS knowledge to find correct elements</li>
<li>How to extract text from common elements</li>
<li>How to extract text from specific elements</li>
<li>Always have to do some text cleanup of data</li>
<li>It usually takes multiple times to get it right</li>
</ul>
<p>See <a href="http://bradleyboehmke.github.io/2015/12/scraping-html-text.html" class="uri">http://bradleyboehmke.github.io/2015/12/scraping-html-text.html</a></p>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="xml" class="section level1">
<h1><span class="header-section-number">2</span> XML and JSON</h1>
<p>This is where things get a little dicey because some web pages will return XML and JSON in response to inquiries and while these formats seem complicated they are actually doing you a really big favor by doing this since these formats can ususally be easily parsed using various packges. XML is a bit hard to get your head around and JSON is the new kid on the block which is easier to use.</p>
<p>Since this isn’t a full-on course lecture I’ll keep it short as to how and why you would want to use these but any time you spend trying to better understand JSON (and XML) the better of you will be when parsing web pages. It’s not such a big deal if all you are going to be parsing is raw text since the mthods we use to do that avoid XML and JSON although cleaning up raw text has its own problems. Let’s revisit the Wikipedia example from the previous section.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)

<span class="co"># Use read_html to fetch the webpage</span>
url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>
ten_most_df &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) 
  
ten_most_populous &lt;-<span class="st"> </span>ten_most_df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()</code></pre></div>
<div class="figure">
<img src="PICS/xml.png" width="650" />

</div>
<div class="figure">
<img src="PICS/xmls.png" width="450" />

</div>
<p>Let’s look at an XML file that has some basic content:  </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;</span>?xml version=<span class="st">&quot;1.0&quot;</span> encoding=<span class="st">&quot;UTF-8&quot;</span>?<span class="op">&gt;</span>
<span class="er">&lt;</span>bookstore<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;COOKING&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Everyday Italian<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>Giada De Laurentiis<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2005</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">30.00</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;CHILDREN&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Harry Potter<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>J K. Rowling<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2005</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">29.99</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;WEB&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Learning XML<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>Erik T. Ray<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2003</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">39.95</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="er">&lt;/</span>bookstore<span class="op">&gt;</span></code></pre></div>
<p>Well we pulled out all tables and then, by experimentation, we isolated table 6 and got the content corresponding to that. But. Is there a more direct way to find the content ? There is. It requires us to install some helper plugins such as the xPath Finder for Firefox and Chrome. In reality there are a number of ways to find the XML Path or CSS Path for an element within a web page but this is a good one to start.</p>
<div class="figure">
<img src="PICS/xpath_finder.png" width="350" />

</div>
<p>Remeber that we want to find the table corresponding to the “10 Most Populous Countries”. So we activate the <em>xPath</em> finder plugin and the highlight the element of interest. This takes some practice to get it right. Once you highlight the desired elment you will see the corresponding XPATH. Here is a screenshot of what I did. We can use the resulting path to directly access the table without first having to first pull out all tables and then trying to find the right one</p>
<div class="figure">
<img src="PICS/xpath_pop.png" width="350" />

</div>
<p> </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use read_html to fetch the webpage</span>
url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>
ten_most_populous &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) 

ten_most_df &lt;-<span class="st"> </span>ten_most_populous <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="dt">xpath=</span><span class="st">&#39;/html/body/div[3]/div[3]/div[4]/div/table[5]&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_table</span>() 

<span class="co"># We have to get the first element of the list. </span>
ten_most_df &lt;-<span class="st"> </span>ten_most_df[[<span class="dv">1</span>]]

ten_most_df</code></pre></div>
<pre><code>##    Rank Country / Territory    Population              Date
## 1     1       China[note 4] 1,395,120,000 November 11, 2018
## 2     2               India 1,339,420,000 November 11, 2018
## 3     3       United States   328,156,000 November 11, 2018
## 4     4           Indonesia   265,015,300      July 1, 2018
## 5     5            Pakistan   212,742,631      May 25, 2017
## 6     6              Brazil   209,833,000 November 11, 2018
## 7     7             Nigeria   188,500,000  October 31, 2016
## 8     8          Bangladesh   165,514,000 November 11, 2018
## 9     9      Russia[note 5]   146,877,088   January 1, 2018
## 10   10               Japan   126,440,000   October 1, 2018
##    % of worldpopulation Source
## 1                 18.2%   [82]
## 2                 17.5%   [83]
## 3                 4.28%   [84]
## 4                 3.46%   [85]
## 5                 2.78%   [86]
## 6                 2.74%   [87]
## 7                 2.46%   [88]
## 8                 2.16%   [89]
## 9                 1.92%   [90]
## 10                1.65%   [91]</code></pre>
<div id="finding-xpaths" class="section level2">
<h2><span class="header-section-number">2.1</span> Finding XPaths</h2>
<div class="figure">
<img src="PICS/xml_path_1.png" width="650" />

</div>
<p> </p>
<p>In addition to Browser Plugins there are standalone tools such as the Oxygen XML Editor which is availabel through the Emory Software Express Website. This is a comprehensive XML editor that will allow you to parse XML and develop paths to locate specific nodes within an XML document. If you find yourself working with websites with lots of XML then this will be useful. The Oxygen editor is free.</p>
<div class="figure">
<img src="PICS/xml_path_10.png" width="350" />

</div>
<p>Let’s look at an XML file that has some basic content:  </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;</span>?xml version=<span class="st">&quot;1.0&quot;</span> encoding=<span class="st">&quot;UTF-8&quot;</span>?<span class="op">&gt;</span>
<span class="er">&lt;</span>bookstore<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;COOKING&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Everyday Italian<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>Giada De Laurentiis<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2005</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">30.00</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;CHILDREN&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Harry Potter<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>J K. Rowling<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2005</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">29.99</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;WEB&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Learning XML<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>Erik T. Ray<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2003</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">39.95</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="er">&lt;/</span>bookstore<span class="op">&gt;</span></code></pre></div>
<div class="figure">
<img src="PICS/xml_path_2.png" width="650" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/xml_path_3.png" width="550" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/xml_path_4.png" width="550" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/xml_path_4.png" width="550" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/xml_path_6.png" width="550" />

</div>
<div class="figure">
<img src="PICS/xml_path_7.png" width="550" />

</div>
<div class="figure">
<img src="PICS/xml_path_8.png" width="550" />

</div>
<div class="figure">
<img src="PICS/xml_path_9.png" width="550" />

</div>
</div>
<div id="example-geocoding-with-google" class="section level2">
<h2><span class="header-section-number">2.2</span> Example: GeoCoding With Google</h2>
<p>Let’s run through an example of using the GeoCoding API with Google. They used to provide free access to this service and they still do although you are limited to a certain number. You have to sign up for an account and get an API key. Anyway, let’s run through this example and then look at how I parsed the XML file that is returned by the Google GeoCoding API. Let’s say that we wanted to get the latitude and longitude associated with the the address <em>1510 Clifton Rd, Atlanta, GA</em> which corresponds to the Rollins Research Building.</p>
<p>First we will see an example of what Google returns in terms of XML. We can use some tools like Oxygen Editor (available free via Emory Software Express) to develop an appropriate XPATH expression to parse out the latitude and longitude information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># https://maps.googleapis.com/maps/api/geocode/xml?address=1510+Clifton+Road,+Atlanta,+GA&amp;key=AIzaSyAbhVdPH0wDVWUayUaj5N4r379Fbkq5NBM</span>

<span class="co"># https://maps.googleapis.com/maps/api/geocode/json?address=1510+Clifton+Road,+Atlanta,+GA&amp;key=AIzaSyAbhVdPH0wDVWUayUaj5N4r379Fbkq5NBM</span>

myGeo &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">address=</span><span class="st">&quot;1510 Clifton Rd Atlanta GA&quot;</span>,<span class="dt">form=</span><span class="st">&quot;xml&quot;</span>) {
  <span class="kw">library</span>(XML)
  <span class="kw">library</span>(RCurl)
  
  geourl &lt;-<span class="st"> &quot;https://maps.googleapis.com/maps/api/geocode/&quot;</span>
  key &lt;-<span class="st"> &quot;AIzaSyAbhVdPH0wDVWUayUaj5N4r379Fbkq5NBM&quot;</span>
  address &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot; &quot;</span>,<span class="st">&quot;+&quot;</span>,address)
  
  add &lt;-<span class="st"> </span><span class="kw">paste0</span>(geourl,form,<span class="dt">sep=</span><span class="st">&quot;?address=&quot;</span>)
  add &lt;-<span class="st"> </span><span class="kw">paste0</span>(add,address,<span class="st">&quot;&amp;key=&quot;</span>)
  geourl &lt;-<span class="st"> </span><span class="kw">paste0</span>(add,key)
  
  locale &lt;-<span class="st"> </span><span class="kw">getURL</span>(geourl)
  plocal &lt;-<span class="st"> </span><span class="kw">xmlParse</span>(locale,<span class="dt">useInternalNodes=</span><span class="ot">TRUE</span>)
  
  <span class="co"># Okay let&#39;s extract the lat and lon</span>
  latlon &lt;-<span class="st"> </span><span class="kw">getNodeSet</span>(plocal,<span class="st">&quot;/GeocodeResponse/result/geometry/location/descendant::*&quot;</span>)
  lat  &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">xmlSApply</span>(latlon,xmlValue))[<span class="dv">1</span>]
  lon  &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">xmlSApply</span>(latlon,xmlValue))[<span class="dv">2</span>]
  
  <span class="kw">return</span>(<span class="kw">c</span>(<span class="dt">lat=</span>lat,<span class="dt">lng=</span>lon))  
}

<span class="kw">myGeo</span>()</code></pre></div>
<pre><code>##       lat       lng 
##  33.79667 -84.32319</code></pre>
<p>  Now. We could have saved the report to a file on our local computer and open it up with Oxygen editor and figure out what the approproate XPATH would be. This is basically what I did. Here is a screenshot of the session:</p>
<div class="figure">
<img src="PICS/oxygen2.png" width="650" />

</div>
<p>  We could expand this considerable to process a number of addresses:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">namevec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Atlanta GA&quot;</span>, 
             <span class="st">&quot;Birmingham AL&quot;</span>, 
             <span class="st">&quot;Seattle WA&quot;</span>, 
             <span class="st">&quot;Sacramento CA&quot;</span>,
             <span class="st">&quot;Denver CO&quot;</span>, 
             <span class="st">&quot;LosAngeles CA&quot;</span>, 
             <span class="st">&quot;Rochester NY&quot;</span>)

cityList &lt;-<span class="st"> </span><span class="kw">lapply</span>(namevec,myGeo)

<span class="co"># Or to get a data frame</span>

cities &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">city=</span>namevec,<span class="kw">do.call</span>(rbind,cityList),
                     <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
cities</code></pre></div>
<pre><code>##            city      lat        lng
## 1    Atlanta GA 33.74900  -84.38798
## 2 Birmingham AL 33.51859  -86.81036
## 3    Seattle WA 47.60621 -122.33207
## 4 Sacramento CA 38.58157 -121.49440
## 5     Denver CO 39.73924 -104.99025
## 6 LosAngeles CA 34.05223 -118.24368
## 7  Rochester NY 43.15658  -77.60885</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Let&#39;s create a Map</span>

<span class="kw">library</span>(leaflet)
m &lt;-<span class="st"> </span><span class="kw">leaflet</span>(<span class="dt">data=</span>cities)
m &lt;-<span class="st"> </span><span class="kw">addTiles</span>(m)
m &lt;-<span class="st"> </span><span class="kw">addMarkers</span>(m,<span class="dt">popup=</span>cities<span class="op">$</span>city)

<span class="co"># Put up the Map - click on the markers</span>
m</code></pre></div>
<div id="htmlwidget-d06a52765ce9415bcc76" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-d06a52765ce9415bcc76">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[[33.7489954,33.5185892,47.6062095,38.5815719,39.7392358,34.0522342,43.1565779],[-84.3879824,-86.8103567,-122.3320708,-121.4943996,-104.990251,-118.2436849,-77.6088465],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Atlanta GA","Birmingham AL","Seattle WA","Sacramento CA","Denver CO","LosAngeles CA","Rochester NY"],null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[33.5185892,47.6062095],"lng":[-122.3320708,-77.6088465]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="using-json" class="section level2">
<h2><span class="header-section-number">2.3</span> Using JSON</h2>
<p>JSON is fast becoming the primary interchange format over XML although XML is still well supported. R has a number of packages to ease the parsing of JSON/ documents returned by web pages. Ususally you get back a <em>list</em> which is a native data type in R that can easily be manipulated into a data frame. Most web APIs provide an option for JSON or XML although some only provide JSON.</p>
<div class="figure">
<img src="PICS/json.png" width="650" />

</div>
<p>There are rules and regulations about how JSON is formed and we will learn them by example but you can look at the numerous tutotorials on the web to locate definitive references. See <a href="http://www.w3schools.com/json/" class="uri">http://www.w3schools.com/json/</a> Here is an XML file that describes some employees.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;</span>employees<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;</span>employee<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>firstName<span class="op">&gt;</span>John<span class="op">&lt;</span><span class="er">/</span>firstName<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>lastName<span class="op">&gt;</span>Doe<span class="op">&lt;</span><span class="er">/</span>lastName<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;/</span>employee<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;</span>employee<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>firstName<span class="op">&gt;</span>Anna<span class="op">&lt;</span><span class="er">/</span>firstName<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>lastName<span class="op">&gt;</span>Smith<span class="op">&lt;</span><span class="er">/</span>lastName<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;/</span>employee<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;</span>employee<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>firstName<span class="op">&gt;</span>Peter<span class="op">&lt;</span><span class="er">/</span>firstName<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>lastName<span class="op">&gt;</span>Jones<span class="op">&lt;</span><span class="er">/</span>lastName<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;/</span>employee<span class="op">&gt;</span>
<span class="st"> </span><span class="er">&lt;/</span>employees<span class="op">&gt;</span></code></pre></div>
<p>And here is the corresposning JSON file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">{
  <span class="st">&quot;employees&quot;</span><span class="op">:</span>[
    {<span class="st">&quot;firstName&quot;</span><span class="op">:</span><span class="st">&quot;John&quot;</span>, <span class="st">&quot;lastName&quot;</span><span class="op">:</span><span class="st">&quot;Doe&quot;</span>},
    {<span class="st">&quot;firstName&quot;</span><span class="op">:</span><span class="st">&quot;Anna&quot;</span>, <span class="st">&quot;lastName&quot;</span><span class="op">:</span><span class="st">&quot;Smith&quot;</span>},
    {<span class="st">&quot;firstName&quot;</span><span class="op">:</span><span class="st">&quot;Peter&quot;</span>,<span class="st">&quot;lastName&quot;</span><span class="op">:</span><span class="st">&quot;Jones&quot;</span>}
] }</code></pre></div>
<ul>
<li><p>It is important to note that the actual information in the document, things like city name, county name, latitude, and longitude are the same as they would be in the comparable XML document.</p></li>
<li><p>JSON documents are at the heart of the NoSQL“database”called MongoDB</p></li>
<li><p>JSON can be found within many webpages since it is closely related to JavaScript which is a language strongly related to web pages.</p></li>
<li><p>JSON is very compact and lighweight which has made it a natural followon to XML so much so that it appears to be replacing XML</p></li>
</ul>
<p>See http:..www.json.org/ for a full description of the specification</p>
<ul>
<li><p>An object is an unordered set of name/value pairs. An object begins with (left brace) and ends with (right brace). Each name is followed by : (colon) and the name/value pairs are separated by , (comma).</p></li>
<li><p>An array is an ordered collection of values. An array begins with [ (left bracket) and ends with ] (right bracket). Values are separated by , (comma).</p></li>
<li><p>A value can be a string in double quotes, or a number, or true or false or null, or an object or an array. These structures can be nested.</p></li>
<li><p>A string is a sequence of zero or more Unicode characters, wrapped in double quotes, using backslash escapes. A character is represented as a single character string.</p></li>
</ul>
<p>Do you remember the Google Geocding example from before ? We can tell Google to send us back JSON instead of XML just by adjusting the URL accordingly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://maps.googleapis.com/maps/api/geocode/json?address=1510+Clifton+Rd+Atlanta+GA&amp;key=AIzaSyAbhVdPH0wDVWUayUaj5N4r379Fbkq5NBM&quot;</span></code></pre></div>
<div class="figure">
<img src="PICS/json_google.png" width="650" />

</div>
</div>
<div id="using-the-rjsonio-package" class="section level2">
<h2><span class="header-section-number">2.4</span> Using the RJSONIO Package</h2>
<p>To read/parse this in R we use a package called RJSONIO. There are other packages but this is the one we will be using. Download and install it.</p>
<p>There is a function called fromJSON which will parse the JSON file and return a list to contain the data.</p>
<p>So we parse lists instead of using XPath. Many people feel this to be easier than trying to construct XPath statments. You will have to decide for yourself.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RJSONIO)

url &lt;-<span class="st"> &quot;https://maps.googleapis.com/maps/api/geocode/json?address=1510+Clifton+Road,+Atlanta,+GA&amp;key=AIzaSyAbhVdPH0wDVWUayUaj5N4r379Fbkq5NBM&quot;</span>
geo &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(url)
<span class="kw">str</span>(geo,<span class="dv">3</span>)</code></pre></div>
<pre><code>## List of 2
##  $ results:List of 1
##   ..$ :List of 6
##   .. ..$ address_components:List of 7
##   .. ..$ formatted_address : chr &quot;1510 Clifton Rd, Atlanta, GA 30322, USA&quot;
##   .. ..$ geometry          :List of 3
##   .. ..$ place_id          : chr &quot;ChIJ5QjdF_oG9YgRWAJzCm19Vf8&quot;
##   .. ..$ plus_code         : Named chr [1:2] &quot;QMWG+MP Druid Hills, Georgia, United States&quot; &quot;865QQMWG+MP&quot;
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;compound_code&quot; &quot;global_code&quot;
##   .. ..$ types             : chr &quot;street_address&quot;
##  $ status : chr &quot;OK&quot;</code></pre>
<p>Since what we get back is a list we can directly access whatever we want. We just index into the list. No need for complicated XPATHS.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">geo<span class="op">$</span>results[[<span class="dv">1</span>]]<span class="op">$</span>geometry<span class="op">$</span>location</code></pre></div>
<pre><code>##       lat       lng 
##  33.79667 -84.32319</code></pre>
<!--chapter:end:01-xmljson.Rmd-->
</div>
</div>
<div id="Moreexamples" class="section level1">
<h1><span class="header-section-number">3</span> More Real Life Examples</h1>
<p>Okay. This is a tour of some sites that will serve as important examples on how to parse sites. Let’s check the price of bitcoins. You want to be rich don’t you ?</p>
<div id="bitcoin-prices" class="section level2">
<h2><span class="header-section-number">3.1</span> BitCoin Prices</h2>
<div class="figure">
<img src="PICS/crypto.png" width="650" />

</div>
<div class="figure">
<img src="PICS/view_source.png" width="750" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)
url &lt;-<span class="st"> &quot;https://coinmarketcap.com/all/views/all/&quot;</span>
bc &lt;-<span class="st"> </span><span class="kw">read_html</span>(url)

path &lt;-<span class="st"> &#39;//*[@id=&quot;currencies-all&quot;]&#39;</span>
 bc_table &lt;-<span class="st"> </span>bc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="dt">xpath=</span>path) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()
 <span class="co"># We get back a one element list that is a data frame</span>
 <span class="kw">str</span>(bc_table,<span class="dv">0</span>)</code></pre></div>
<pre><code>## List of 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> bc_table &lt;-<span class="st"> </span>bc_table[[<span class="dv">1</span>]]
 <span class="kw">head</span>(bc_table[,<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>])</code></pre></div>
<pre><code>##   Symbol       Market Cap     Price
## 1    BTC $110,506,260,873  $6360.77
## 2    ETH  $21,565,430,142   $209.04
## 3    XRP  $20,738,359,893 $0.515809
## 4    BCH   $9,007,279,340   $516.03
## 5    XLM   $5,065,544,817 $0.267523
## 6    EOS   $4,877,744,763     $5.38</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The data is &quot;dirty&quot; and has characers in it that need cleaning</span>
bc_table &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Name,Symbol,Price)
bc_table &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Name=</span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,<span class="st">&quot; &quot;</span>,Name))
bc_table &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Name=</span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.+&quot;</span>,<span class="st">&quot;&quot;</span>,Name))
bc_table &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Price=</span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">$&quot;</span>,<span class="st">&quot;&quot;</span>,Price))
bc_table &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Price=</span><span class="kw">round</span>(<span class="kw">as.numeric</span>(Price),<span class="dv">2</span>))</code></pre></div>
<pre><code>## Warning in evalq(round(as.numeric(Price), 2), &lt;environment&gt;): NAs
## introduced by coercion</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># There are four rows wherein the Price is missing NA</span>
bc_table &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">complete.cases</span>(bc_table))

<span class="co"># Let&#39;s get the Crypto currencies with the Top 10 highest prices </span>
top_<span class="dv">10</span> &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Price)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>)

<span class="co"># Next we want to make a barplot of the Top 10</span>
ylim=<span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">max</span>(top_<span class="dv">10</span><span class="op">$</span>Price)<span class="op">+</span><span class="dv">10000</span>)
main=<span class="st">&quot;Top 10 Crypto Currencies in Terms of Price&quot;</span>
bp &lt;-<span class="st"> </span><span class="kw">barplot</span>(top_<span class="dv">10</span><span class="op">$</span>Price,<span class="dt">col=</span><span class="st">&quot;aquamarine&quot;</span>,
              <span class="dt">ylim=</span>ylim,<span class="dt">main=</span>main)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span>bp, <span class="dt">labels=</span>top_<span class="dv">10</span><span class="op">$</span>Symbol,  <span class="dt">cex.axis =</span> <span class="fl">0.7</span>)
<span class="kw">grid</span>()</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Let&#39;s take the log of the price</span>
ylim=<span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">max</span>(<span class="kw">log</span>(top_<span class="dv">10</span><span class="op">$</span>Price))<span class="op">+</span><span class="dv">5</span>)
main=<span class="st">&quot;Top 10 Crypto Currencies in Terms of log(Price)&quot;</span>
bp &lt;-<span class="st"> </span><span class="kw">barplot</span>(<span class="kw">log</span>(top_<span class="dv">10</span><span class="op">$</span>Price),<span class="dt">col=</span><span class="st">&quot;aquamarine&quot;</span>,
              <span class="dt">ylim=</span>ylim,<span class="dt">main=</span>main)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span>bp, <span class="dt">labels=</span>top_<span class="dv">10</span><span class="op">$</span>Symbol,  <span class="dt">cex.axis =</span> <span class="fl">0.7</span>)
<span class="kw">grid</span>()</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-23-2.png" width="672" /></p>
</div>
<div id="faculty-salaries" class="section level2">
<h2><span class="header-section-number">3.2</span> Faculty Salaries</h2>
<p>In this example we have to parse the main table associated with the results page.</p>
<div class="figure">
<img src="PICS/salary.png" alt="Salary" />
<p class="caption">Salary</p>
</div>
<div class="figure">
<img src="PICS/sal_page.png" alt="Salary" />
<p class="caption">Salary</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://www.insidehighered.com/aaup-compensation-survey&quot;</span>
df &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>() <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">1</span>)
intost &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Institution&quot;</span>,<span class="st">&quot;Category&quot;</span>,<span class="st">&quot;State&quot;</span>)
salary &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(InstitutionCategoryState,<span class="dt">into=</span>intost,<span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>) 
salary</code></pre></div>
<pre><code>##                            Institution      Category   State
## 1                    Auburn University      Doctoral ALABAMA
## 2          Birmingham Southern College Baccalaureate ALABAMA
## 3                   Huntingdon College Baccalaureate ALABAMA
## 4                   Samford University        Master ALABAMA
## 5                      Troy University        Master ALABAMA
## 6            The University of Alabama      Doctoral ALABAMA
## 7  University of Alabama at Birmingham      Doctoral ALABAMA
## 8  University of Alabama in Huntsville      Doctoral ALABAMA
## 9             University of Montevallo        Master ALABAMA
## 10         University of South Alabama        Master ALABAMA
##    Avg. SalaryFull Professors Avg. ChangeContinuing Full Professors
## 1                    $126,900                                  3.7%
## 2                     $80,400                                  0.3%
## 3                     $76,700                                  0.0%
## 4                    $104,500                                  1.4%
## 5                     $84,500                                  1.6%
## 6                    $148,100                                  2.0%
## 7                    $135,100                                  1.9%
## 8                    $131,000                                  2.4%
## 9                     $79,800                                  0.0%
## 10                    $89,100                                   N/A
##    CountFull Professors Avg. Total CompensationFull Professors
## 1                   411                               $181,600
## 2                    38                               $102,800
## 3                    13                                $89,500
## 4                   117                               $141,300
## 5                    30                                $88,500
## 6                   300                               $202,400
## 7                   191                               $178,800
## 8                    62                               $177,700
## 9                    44                                      -
## 10                  111                                $97,100
##    Salary EquityFull Professors
## 1                          88.8
## 2                          95.5
## 3                         109.6
## 4                          84.3
## 5                         105.7
## 6                          86.7
## 7                          89.4
## 8                          92.0
## 9                          93.4
## 10                         97.6</code></pre>
<p>So we could process multiple pages</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># So now we could process multiple pages</span>

url &lt;-<span class="st"> &#39;https://www.insidehighered.com/aaup-compensation-survey?institution-name=&amp;professor-category=1591&amp;page=1&#39;</span>
str1 &lt;-<span class="st"> &quot;https://www.insidehighered.com/aaup-compensation-survey?&quot;</span>
str2 &lt;-<span class="st"> &quot;institution-name=&amp;professor-category=1591&amp;page=&quot;</span>
intost &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Institution&quot;</span>,<span class="st">&quot;Category&quot;</span>,<span class="st">&quot;State&quot;</span>)

salary &lt;-<span class="st"> </span><span class="kw">data.frame</span>()
<span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) {
  nurl  &lt;-<span class="st"> </span><span class="kw">paste</span>(str1,str2,ii,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
  df &lt;-<span class="st"> </span><span class="kw">read_html</span>(nurl)
  tmp &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>() <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">1</span>)
  tmp &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(InstitutionCategoryState,<span class="dt">into=</span>intost,<span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>) 
  salary &lt;-<span class="st"> </span><span class="kw">rbind</span>(salary,tmp)
}

salary</code></pre></div>
<p>Look at the URLs at the bottom of the main page to find beginning and ending page numbers. Visually this is easy. Programmatically we could do something like the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># https://www.insidehighered.com/aaup-compensation-survey?page=1</span>
<span class="co"># https://www.insidehighered.com/aaup-compensation-survey?page=94</span>

<span class="co"># What is the last page number ? We already know the answer - 94</span>

lastnum &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="dt">xpath=</span><span class="st">&#39;//a&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>) <span class="op">%&gt;%</span><span class="st"> &#39;[&#39;</span>(<span class="dv">103</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">strsplit</span>(.,<span class="st">&quot;page=&quot;</span>) <span class="op">%&gt;%</span><span class="st"> &#39;[[&#39;</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> &#39;[&#39;</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>(.)

<span class="co"># So now we could get all pages of the survey</span>

str1 &lt;-<span class="st"> &quot;https://www.insidehighered.com/aaup-compensation-survey?&quot;</span>
str2 &lt;-<span class="st"> &quot;institution-name=&amp;professor-category=1591&amp;page=&quot;</span>
intost &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Institution&quot;</span>,<span class="st">&quot;Category&quot;</span>,<span class="st">&quot;State&quot;</span>)

salary &lt;-<span class="st"> </span><span class="kw">data.frame</span>()

<span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>lastnum) {
  nurl  &lt;-<span class="st"> </span><span class="kw">paste</span>(str1,str2,ii,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
  df &lt;-<span class="st"> </span><span class="kw">read_html</span>(nurl)
  tmp &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>() <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">1</span>)
  tmp &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(InstitutionCategoryState,<span class="dt">into=</span>intost,<span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>) 
  salary &lt;-<span class="st"> </span><span class="kw">rbind</span>(salary,tmp)
  <span class="kw">Sys.sleep</span>(<span class="dv">1</span>)
}
<span class="kw">names</span>(salary) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Institution&quot;</span>,<span class="st">&quot;Category&quot;</span>,<span class="st">&quot;State&quot;</span>,<span class="st">&quot;AvgSalFP&quot;</span>,<span class="st">&quot;AvgChgFP&quot;</span>,
                   <span class="st">&quot;CntFP&quot;</span>,<span class="st">&quot;AvgTotCompFP&quot;</span>,<span class="st">&quot;SalEquityFP&quot;</span>)

salary &lt;-<span class="st"> </span>salary <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">AvgSalFP=</span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">$|,&quot;</span>,<span class="st">&quot;&quot;</span>,salary<span class="op">$</span>AvgSalFP))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">AvgTotCompFP=</span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">$|,&quot;</span>,<span class="st">&quot;&quot;</span>,salary<span class="op">$</span>AvgTotCompFP)))

salary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(State,Category) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg=</span><span class="kw">mean</span>(AvgSalFP)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(avg))</code></pre></div>
<p>There are some problems:</p>
<ul>
<li>Data is large and scattered across multiple pages</li>
<li>We could use above techniques to move from page to page</li>
<li>There is a form we could use to narrow criteria</li>
<li>But we have to programmatically submit the form</li>
<li>rvest (and other packages) let you do this</li>
</ul>
</div>
<div id="filling-out-forms-from-a-program" class="section level2">
<h2><span class="header-section-number">3.3</span> Filling Out Forms From a Program</h2>
<div class="figure">
<img src="PICS/salary_form.png" alt="Salary" width="250" />
<p class="caption">Salary</p>
</div>
<p>Let’s find salaries between $ 150,000 and the default max ($ 244,000)</p>
<ul>
<li>Find the element name associated with “Average Salary”</li>
<li>Establish a connection with the form (usually the url of the page)</li>
<li>Get a local copy of the form</li>
<li>Fill in the value for the “Average Salary”</li>
<li>Submit the lled in form</li>
<li>Get the results and parse them like above `</li>
</ul>
<p>So finding the correct element is more challenging. I use Chrome to do this. Just highlight the area over the form and right click to “Insepct” the element. This opens up the developer tools. You have to dig down to find the corrext form and the element name. Here is a screen shot of my activity:</p>
<div class="figure">
<img src="PICS/form.png" alt="Salary" width="550" />
<p class="caption">Salary</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://www.insidehighered.com/aaup-compensation-survey&quot;</span>

<span class="co"># Establish a session</span>
mysess &lt;-<span class="st"> </span><span class="kw">html_session</span>(url)

<span class="co"># Get the form</span>

form_unfilled &lt;-<span class="st"> </span>mysess <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_node</span>(<span class="st">&quot;form&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_form</span>()
form_filled   &lt;-<span class="st"> </span>form_unfilled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">set_values</span>(<span class="st">&quot;range-from&quot;</span>=<span class="dv">150000</span>)

<span class="co"># Submit form</span>

results &lt;-<span class="st"> </span><span class="kw">submit_form</span>(mysess,form_filled)</code></pre></div>
<pre><code>## Submitting with &#39;op&#39;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">first_page &lt;-<span class="st"> </span>results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="dt">xpath=</span>expr) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()

first_page</code></pre></div>
<pre><code>## [[1]]
##                                                     InstitutionCategoryState
## 1                          Ohio State University-Main Campus\nDoctoral\nOHIO
## 2             University of Illinois at Urbana-Champaign\nDoctoral\nILLINOIS
## 3  University of Colorado Denver/Anschutz Medical Campus\nDoctoral\nCOLORADO
## 4                                     University of Houston\nDoctoral\nTEXAS
## 5                              Amherst College\nBaccalaureate\nMASSACHUSETTS
## 6                 University of California-Merced\nBaccalaureate\nCALIFORNIA
## 7                      University of Illinois at Chicago\nDoctoral\nILLINOIS
## 8                             Wake Forest University\nMaster\nNORTH CAROLINA
## 9                       Rensselaer Polytechnic Institute\nDoctoral\nNEW YORK
## 10                              Brandeis University\nDoctoral\nMASSACHUSETTS
##    Avg. SalaryFull Professors Avg. ChangeContinuing Full Professors
## 1                    $150,000                                  2.7%
## 2                    $150,500                                  4.1%
## 3                    $150,800                                  2.2%
## 4                    $150,900                                  0.9%
## 5                    $151,000                                  2.8%
## 6                    $151,100                                   N/A
## 7                    $151,100                                  4.1%
## 8                    $151,700                                  3.2%
## 9                    $151,800                                  3.3%
## 10                   $151,900                                  3.5%
##    CountFull Professors Avg. Total CompensationFull Professors
## 1                   994                               $195,700
## 2                   833                               $190,600
## 3                   179                               $207,200
## 4                   427                               $183,300
## 5                    85                               $196,700
## 6                    55                               $204,500
## 7                   346                               $194,000
## 8                   194                               $191,000
## 9                   199                               $204,000
## 10                  150                               $194,300
##    Salary EquityFull Professors
## 1                          89.6
## 2                          91.4
## 3                          93.1
## 4                          85.8
## 5                          92.3
## 6                          88.9
## 7                          94.4
## 8                          85.4
## 9                          98.6
## 10                         96.6</code></pre>
</div>
<div id="pubmed" class="section level2">
<h2><span class="header-section-number">3.4</span> PubMed</h2>
<p>Pubmed provides a rich source of information on published scientific literature. There are tutorials on how to leverage its capabilities but one thing to consider is that MESH terms are a good starting place since the search is index-based. MeSH (Medical Subject Headings) is the NLM controlled vocabulary thesaurus used for indexing articles for PubMed. It’s faster and more accurate so you can first use the MESH browser to generate the appropriate search terms and add that into the Search interface. The MESH browser can be found at <a href="https://www.ncbi.nlm.nih.gov/mesh/" class="uri">https://www.ncbi.nlm.nih.gov/mesh/</a></p>
<div class="figure">
<img src="PICS/pubmed1.png" width="550" />

</div>
<div class="figure">
<img src="PICS/mesh.png" width="550" />

</div>
<p>What we do here is get the links associated with each publication so we can then process each of those and get the abstract associated with each publication.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># &quot;hemodialysis, home&quot; [MeSH Terms] </span>

url &lt;-<span class="st"> &quot;https://www.ncbi.nlm.nih.gov/pubmed/?term=%22hemodialysis%2C+home%22+%5BMeSH+Terms%5D&quot;</span>

<span class="co"># </span>

results &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grep</span>(<span class="st">&quot;/pubmed/[0-9]{1,6}&quot;</span>,.,<span class="dt">value=</span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>(.)

results</code></pre></div>
<pre><code>##  [1] &quot;/pubmed/30212930&quot; &quot;/pubmed/29656667&quot; &quot;/pubmed/29272506&quot;
##  [4] &quot;/pubmed/29148012&quot; &quot;/pubmed/29122999&quot; &quot;/pubmed/29122220&quot;
##  [7] &quot;/pubmed/28978613&quot; &quot;/pubmed/28963833&quot; &quot;/pubmed/28835369&quot;
## [10] &quot;/pubmed/28710094&quot; &quot;/pubmed/28679363&quot; &quot;/pubmed/28651528&quot;
## [13] &quot;/pubmed/28614637&quot; &quot;/pubmed/28597060&quot; &quot;/pubmed/28546368&quot;
## [16] &quot;/pubmed/28535526&quot; &quot;/pubmed/28495360&quot; &quot;/pubmed/28490435&quot;
## [19] &quot;/pubmed/28485119&quot; &quot;/pubmed/28448966&quot;</code></pre>
<div class="figure">
<img src="PICS/pubmed_results.png" width="550" />

</div>
<p>So now we could loop through these links and get the abstracts for these results. It looks that there are approximately 10 results per page. As before we would have to dive in to the underlying structure of the page to get the correct XML pathnames or we could look for Paragraph elements and pick out the links that way.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text.vec &lt;-<span class="st"> </span><span class="kw">vector</span>()

<span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(results)) {
  string &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;https://www.ncbi.nlm.nih.gov&quot;</span>,results[ii])
  text.vec[ii] &lt;-<span class="st"> </span><span class="kw">read_html</span>(string) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;p&quot;</span>) <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()
}

<span class="co"># Eliminate lines with newlines characters</span>

final.vec &lt;-<span class="st"> </span>text.vec[<span class="kw">grep</span>(<span class="st">&quot;^</span><span class="ch">\n</span><span class="st">&quot;</span>,text.vec,<span class="dt">invert=</span><span class="ot">TRUE</span>)]

final.vec</code></pre></div>
<pre><code>##  [1] &quot;End-stage renal disease (ESRD) is the final stage of chronic kidney disease in which the kidney is not sufficient to meet the needs of daily life. It is necessary to understand the role of genes expression involved in ESRD patient responses to nocturnal hemodialysis (NHD) and to improve the immunity responsiveness. The aim of this study was to investigate novel immune-associated genes that may play important roles in patients with ESRD.The microarray expression profiles of peripheral blood in patients with ESRD before and after NHD were analyzed by network-based approaches, and then using Gene Ontology (GO) and Kyoto Encyclopedia of Genes and Genomes pathway analysis to explore the biological process and molecular functions of differentially expressed genes. Subsequently, a transcriptional regulatory network of the core genes and the connected transcriptional regulators was constructed. We found that NHD had a significant effect on neutrophil activation and immune response in patients with ESRD.In addition, Our findings suggest that MAPKAPK3, RHOA, ARRB2, FLOT1, MYH9, PRKCD, RHOG, PTPN6, MAPK3, CNPY3, PI3KCG, and PYGL genes maybe potential targets regulated by core transcriptional factors, including ARNT, C/EBPalpha, CEBPA, CREB1, PSG1, DAND5, SP1, GATA1, MYC, EGR2, and EGR3.&quot;                                                                                                                                                                                                                                                                                                                  
##  [2] &quot;Only a minority of patients with chronic kidney disease treated by hemodialysis are currently treated at home. Until relatively recently, the only type of hemodialysis machine available for these patients was a slightly smaller version of the standard machines used for in-center dialysis treatments. Areas covered: There are now an alternative generation of dialysis machines specifically designed for home hemodialysis. The home dialysis patient wants a smaller machine, which is intuitive to use, easy to trouble shoot, robust and reliable, quick to setup and put away, requiring minimal waste disposal. The machines designed for home dialysis have some similarities in terms of touch-screen patient interfaces, and using pre-prepared cartridges to speed up setting up the machine. On the other hand, they differ in terms of whether they use slower or standard dialysate flows, prepare batches of dialysis fluid, require separate water purification equipment, or whether this is integrated, or use pre-prepared sterile bags of dialysis fluid. Expert commentary: Dialysis machine complexity is one of the hurdles reducing the number of patients opting for home hemodialysis and the introduction of the newer generation of dialysis machines designed for ease of use will hopefully increase the number of patients opting for home hemodialysis.&quot;                                                                                                                                                                                                                                                                   
##  [3] &quot;Home haemodialysis (HHD) has the potential to impact positively on patient outcomes and health resource management. There has been rejuvenated international interest in HHD in recent years.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
##  [4] &quot;Assess the feasibility of using a bovine carotid artery graft for buttonhole technique hemodialysis in patients who are not candidates for a native fistula.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
##  [5] &quot;renal system; urology; vascular surgery&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
##  [6] &quot;NxStage System One is a new dialytic technology based on easy setup, simplicity of use and reduced dimensions, which is increasingly in use worldwide for home hemodialysis treatments. The system utilizes a low amount of dialysate, usually 15-30 liters according to anthropometric patients&#39; values. The dialysate is supplied at very low flux, generally about 1/3 of blood flow, in order to obtain an elevated saturation of dialysate for solutes. In these conditions the clearance of urea will be almost equal to dialysate flow rate. In order to achieve an obptimal weekly clearance evaluated by Std Kt/V the dialysis sessions are repeated six times a week. In this way a good control of blood voleme can be reached. In this paper we report our experience of treatment with NxStage System One in 12 patients from May 2011 to Dicember 2016.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
##  [7] &quot;Data on racial disparities in home dialysis utilization and outcomes are lacking in Canada, where health care is universally available.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
##  [8] &quot;Telehealth and remote monitoring of a patient&#39;s health status has become more commonplace in the last decade and has been applied to conditions such as heart failure, diabetes mellitus, hypertension, and chronic obstructive pulmonary disease. Conversely, uptake of these technologies to help engender and support home RRTs has lagged. Although studies have looked at the role of telehealth in RRT, they are small and single-centered, and both outcome and cost-effectiveness data are needed to inform future decision making. Furthermore, alignment of payer and government (federal and state) regulations with telehealth procedures is needed along with a better understanding of the viewpoints of the various stakeholders in this process (patients, caregivers, clinicians, payers, dialysis organizations, and government regulators). Despite these barriers, telehealth has great potential to increase the acceptance of home dialysis, and improve outcomes and patient satisfaction while potentially decreasing costs. The Kidney Health Initiative convened a multidisciplinary workgroup to examine the current state of telehealth use in home RRTs as well as outline potential benefits and drawbacks, impediments to implementation, and key unanswered questions.&quot;                                                                                                                                                                                                                                                                                                                                                            
##  [9] &quot;Patients starting dialysis often have substantial residual kidney function. Incremental hemodialysis provides a hemodialysis prescription that supplements patients&#39; residual kidney function while maintaining total (residual + dialysis) urea clearance (standard Kt/Vurea) targets. We describe our experience with incremental hemodialysis in patients using NxStage System One for home hemodialysis.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
## [10] &quot;Internationally, the use of patient-reported outcomes (PROs) is increasing. Electronic PROs (ePROs) offer immediate access of such reports to healthcare providers. The objectives of this study were to assess nurses&#39; perspectives on the usefulness and impact of ePRO administration in home dialysis clinics and assess patient perceptions of satisfaction with nursing care following use of ePROs.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
## [11] &quot;The Lancashire Teaching Hospitals NHS Trust in the UK has been providing renal care through video-as-a-service (VAAS) to patients since 2013, with support from the North West NHS Shared Infrastructure Service, a collaborative team that supports information and communication technology use in the UK National Health Service.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
## [12] &quot;Neonatal autosomal recessive polycystic kidney disease (ARPKD) is associated with giant kidneys, lung hypoplasia, pulmonal hypertension, and end-stage renal failure. Depending on the study, mortality is reported to range between 20 and 80%.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
## [13] &quot;Improvement in the rates of home dialysis has been a desirable but difficult-to-achieve target for United States nephrology. Provision of comprehensive predialysis education (CPE) in institutes with established home dialysis programs has been shown to facilitate a higher home dialysis choice amongst chronic kidney disease (CKD) patients. Unfortunately, limited data have shown the efficacy of such programs in the United States or in institutes with small home dialysis (HoD) programs.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
## [14] &quot;Home hemodialysis (HD) is undergoing a resurgence. A major driver of this is economics, however, providers are also encouraged by a combination of excellent patient outcomes and patient experiences as well as the development of newer technologies that offer ease of use. Home HD offers significant advantages in flexible scheduling and the practical implementation of extended hours dialysis. This paper explores the reasons why home HD is making a comeback and strives to offer approaches to improve the uptake of this dialysis modality.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
## [15] &quot;Bone deformities and fractures are common consequences of renal osteodystrophy in the dialysis population. Persistent hypophosphatemia may be observed with more frequent home hemodialysis regimens, but the specific effects on the skeleton are unknown. We present a patient with end-stage renal disease treated with frequent home hemodialysis who developed severe bone pain and multiple fractures, including a hip fracture and a tibia-fibula fracture complicated by nonunion, rendering her nonambulatory and wheelchair bound for more than a year. A bone biopsy revealed severe osteomalacia, likely secondary to chronic hypophosphatemia and hypocalcemia. Treatment changes included the addition of phosphate to the dialysate, a higher dialysate calcium concentration, and increased calcitriol dose. Several months later, the patient no longer required a wheelchair and was able to ambulate without pain. Repeat bone biopsy revealed marked improvements in bone mineralization and turnover parameters. Also, with increased dialysate phosphate and calcium concentrations, as well as increased calcitriol, circulating fibroblast growth factor 23 levels increased.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
## [16] &quot;The ESRD Prospective Payment System introduced two incentives to increase home dialysis use: bundling injectable medications into a single payment for treatment and paying for home dialysis training. We evaluated the effects of the ESRD Prospective Payment System on home dialysis use by patients starting dialysis in the United States from January 1, 2006 to August 31, 2013. We analyzed data on dialysis modality, insurance type, and comorbidities from the United States Renal Data System. We estimated the effect of the policy on home dialysis use with multivariable logistic regression and compared the effect on Medicare Parts A/B beneficiaries with the effect on patients with other types of insurance. The ESRD Prospective Payment System associated with a 5.0% (95% confidence interval [95% CI], 4.0% to 6.0%) increase in home dialysis use by the end of the study period. Home dialysis use increased by 5.8% (95% CI, 4.3% to 6.9%) among Medicare beneficiaries and 4.1% (95% CI, 2.3% to 5.4%) among patients covered by other forms of health insurance. The difference between these groups was not statistically significant (1.8%; 95% CI, -0.2% to 3.8%). Conversely, in both populations, the training add-on did not associate with increases in home dialysis use beyond the effect of the policy. The ESRD Prospective Payment System bundling, but not the training add-on, associated with substantial increases in home dialysis, which were identical for both Medicare and non-Medicare patients. These spill-over effects suggest that major payment changes in Medicare can affect all patients with ESRD.&quot;
## [17] &quot;We present a case of a patient on home hemodialysis who developed Mycobacterium mucogenicum bacteremia. While infections with this particular organism are rare, disseminated infections have been reported and have been associated with significant morbidity and mortality. Diagnosis required appropriate cultures, understanding of natural habitat of organism and complete environmental analysis including blood, dialysis sample port, reverse osmosis and incoming water supply cultures. The patient was treated successfully with systemic antibiotics, removal of central venous catheter, patient education and complete exchange of the hemodialysis circuit.&quot;</code></pre>
<p>Well that was a lot of work and it’s very tedious. And we processed only the first page of results. How do we “progrmmatically” hit the “Next” Button at the bottom of the page ? This is complicated by the fact that there appears to be some Javascript at work that we would have to somehow interact with to get the URL for the next page. Unlike with the school salary example it isn’t obvious how to do this. If we hove over the “Next” button we don’t get an associated link.</p>
<!--chapter:end:02-moreexamples.Rmd-->
</div>
</div>
<div id="APIs" class="section level1">
<h1><span class="header-section-number">4</span> APIs</h1>
<div id="omdb" class="section level2">
<h2><span class="header-section-number">4.1</span> OMDB</h2>
<p>Let’s look at the IMDB page whic catalogues lots of information about movies. Just got to the web site and search although here is an example link. <a href="https://www.imdb.com/title/tt0076786/?ref_=fn_al_tt_2" class="uri">https://www.imdb.com/title/tt0076786/?ref_=fn_al_tt_2</a> In this case we would like to get the summary information for the movie. So we would use Selector Gadget or some other method to find the XPATH or CSS associated with this element.</p>
<div class="figure">
<img src="PICS/suspiria_77.png" width="450" />

</div>
<p>This pretty easy and doesn’t present much of a problem although for large scale mining of movie data we would run into trouble because IMDB doesn’t really like you to scrape their pages. They have an API that they would like for you to use.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &#39;https://www.imdb.com/title/tt0076786/?ref_=fn_al_tt_2&#39;</span>
summary &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;.summary_text&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_text</span>()</code></pre></div>
<p>But here we go again. We have to parse the desired elements on this page and then what if we wanted to follow other links or set up a general function to search IMDB for other movies of various genres, titles, directors, etc.</p>
<div class="figure">
<img src="PICS/omdb.png" width="550" />

</div>
<div class="figure">
<img src="PICS/omdb_api.png" width="450" />

</div>
<div class="figure">
<img src="PICS/omdb_instruc.png" width="450" />

</div>
<hr />
<p>So as an example on how this works. Paste the URL into any web browser. You must supply your key for this to work. What you get back is a JSON formatted entry corresponding to ”The GodFather”movie.</p>
<hr />
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;http://www.omdbapi.com/?apikey=f7c004c&amp;t=The+Godfather&quot;</span></code></pre></div>
<div class="figure">
<img src="PICS/omdb_result.png" width="650" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RJSONIO)

url &lt;-<span class="st"> &quot;http://www.omdbapi.com/?apikey=f7c004c&amp;t=The+Godfather&quot;</span>

<span class="co"># Fetch the URL via fromJSON</span>
movie &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(<span class="st">&quot;http://www.omdbapi.com/?apikey=f7c004c&amp;t=The+Godfather&quot;</span>)

<span class="co"># We get back a list which is much easier to process than raw JSON or XML</span>
<span class="kw">str</span>(movie)</code></pre></div>
<pre><code>## List of 25
##  $ Title     : chr &quot;The Godfather&quot;
##  $ Year      : chr &quot;1972&quot;
##  $ Rated     : chr &quot;R&quot;
##  $ Released  : chr &quot;24 Mar 1972&quot;
##  $ Runtime   : chr &quot;175 min&quot;
##  $ Genre     : chr &quot;Crime, Drama&quot;
##  $ Director  : chr &quot;Francis Ford Coppola&quot;
##  $ Writer    : chr &quot;Mario Puzo (screenplay by), Francis Ford Coppola (screenplay by), Mario Puzo (based on the novel by)&quot;
##  $ Actors    : chr &quot;Marlon Brando, Al Pacino, James Caan, Richard S. Castellano&quot;
##  $ Plot      : chr &quot;The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.&quot;
##  $ Language  : chr &quot;English, Italian, Latin&quot;
##  $ Country   : chr &quot;USA&quot;
##  $ Awards    : chr &quot;Won 3 Oscars. Another 24 wins &amp; 28 nominations.&quot;
##  $ Poster    : chr &quot;https://m.media-amazon.com/images/M/MV5BM2MyNjYxNmUtYTAwNi00MTYxLWJmNWYtYzZlODY3ZTk3OTFlXkEyXkFqcGdeQXVyNzkwMjQ&quot;| __truncated__
##  $ Ratings   :List of 3
##   ..$ : Named chr [1:2] &quot;Internet Movie Database&quot; &quot;9.2/10&quot;
##   .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Source&quot; &quot;Value&quot;
##   ..$ : Named chr [1:2] &quot;Rotten Tomatoes&quot; &quot;98%&quot;
##   .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Source&quot; &quot;Value&quot;
##   ..$ : Named chr [1:2] &quot;Metacritic&quot; &quot;100/100&quot;
##   .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Source&quot; &quot;Value&quot;
##  $ Metascore : chr &quot;100&quot;
##  $ imdbRating: chr &quot;9.2&quot;
##  $ imdbVotes : chr &quot;1,378,375&quot;
##  $ imdbID    : chr &quot;tt0068646&quot;
##  $ Type      : chr &quot;movie&quot;
##  $ DVD       : chr &quot;09 Oct 2001&quot;
##  $ BoxOffice : chr &quot;N/A&quot;
##  $ Production: chr &quot;Paramount Pictures&quot;
##  $ Website   : chr &quot;http://www.thegodfather.com&quot;
##  $ Response  : chr &quot;True&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movie<span class="op">$</span>Plot</code></pre></div>
<pre><code>## [1] &quot;The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(movie<span class="op">$</span>Ratings,unlist)</code></pre></div>
<pre><code>##        [,1]                      [,2]              [,3]        
## Source &quot;Internet Movie Database&quot; &quot;Rotten Tomatoes&quot; &quot;Metacritic&quot;
## Value  &quot;9.2/10&quot;                  &quot;98%&quot;             &quot;100/100&quot;</code></pre>
<p>Let’s Get all the Episodes for Season 1 of Game of Thrones</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;http://www.omdbapi.com/?apikey=f7c004c&amp;t=Game%20of%20Thrones&amp;Season=1&quot;</span>
movie &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(url)
<span class="kw">str</span>(movie,<span class="dv">1</span>)</code></pre></div>
<pre><code>## List of 5
##  $ Title       : chr &quot;Game of Thrones&quot;
##  $ Season      : chr &quot;1&quot;
##  $ totalSeasons: chr &quot;8&quot;
##  $ Episodes    :List of 10
##  $ Response    : chr &quot;True&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">episodes &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">do.call</span>(rbind,movie<span class="op">$</span>Episodes),<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
episodes</code></pre></div>
<pre><code>##                                    Title   Released Episode imdbRating
## 1                       Winter Is Coming 2011-04-17       1        9.0
## 2                          The Kingsroad 2011-04-24       2        8.8
## 3                              Lord Snow 2011-05-01       3        8.7
## 4  Cripples, Bastards, and Broken Things 2011-05-08       4        8.8
## 5                  The Wolf and the Lion 2011-05-15       5        9.1
## 6                         A Golden Crown 2011-05-22       6        9.2
## 7                     You Win or You Die 2011-05-29       7        9.3
## 8                         The Pointy End 2011-06-05       8        9.1
## 9                                 Baelor 2011-06-12       9        9.6
## 10                        Fire and Blood 2011-06-19      10        9.5
##       imdbID
## 1  tt1480055
## 2  tt1668746
## 3  tt1829962
## 4  tt1829963
## 5  tt1829964
## 6  tt1837862
## 7  tt1837863
## 8  tt1837864
## 9  tt1851398
## 10 tt1851397</code></pre>
</div>
<div id="the-omdbapi-package" class="section level2">
<h2><span class="header-section-number">4.2</span> The omdbapi package</h2>
<p>Wait a minute. Looks like someone created an R package that wraps all this for us. It is called omdbapi</p>
<div class="figure">
<img src="PICS/omdbapi.png" width="650" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use devtools to install</span>
devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;hrbrmstr/omdbapi&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(omdbapi)
<span class="co"># The first time you use this you will be prompted to enter your</span>
 <span class="co"># API key</span>
movie_df &lt;-<span class="st"> </span><span class="kw">search_by_title</span>(<span class="st">&quot;Star Wars&quot;</span>, <span class="dt">page =</span> <span class="dv">2</span>)
(movie_df &lt;-<span class="st"> </span>movie_df[,<span class="op">-</span><span class="dv">5</span>])</code></pre></div>
<pre><code>##                                     Title      Year    imdbID   Type
## 1               Star Wars: The Clone Wars      2008 tt1185834  movie
## 2               Star Wars: The Clone Wars 2008–2019 tt0458290 series
## 3                        Star Wars Rebels 2014–2018 tt2930604 series
## 4                   Star Wars: Clone Wars 2003–2005 tt0361243 series
## 5           The Star Wars Holiday Special      1978 tt0193524  movie
## 6                Robot Chicken: Star Wars      2007 tt1020990  movie
## 7  Star Wars: Knights of the Old Republic      2003 tt0356070   game
## 8          Star Wars: The Force Unleashed      2008 tt1024923   game
## 9               Star Wars: Battlefront II      2005 tt0483168   game
## 10    Robot Chicken: Star Wars Episode II      2008 tt1334272  movie</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get lots of info on The GodFather</span>

(gf &lt;-<span class="st"> </span><span class="kw">find_by_title</span>(<span class="st">&quot;The GodFather&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 3 x 25
##   Title Year  Rated Released   Runtime Genre Director Writer Actors Plot 
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;
## 1 The … 1972  R     1972-03-24 175 min Crim… Francis… Mario… Marlo… The …
## 2 The … 1972  R     1972-03-24 175 min Crim… Francis… Mario… Marlo… The …
## 3 The … 1972  R     1972-03-24 175 min Crim… Francis… Mario… Marlo… The …
## # ... with 15 more variables: Language &lt;chr&gt;, Country &lt;chr&gt;, Awards &lt;chr&gt;,
## #   Poster &lt;chr&gt;, Ratings &lt;list&gt;, Metascore &lt;chr&gt;, imdbRating &lt;dbl&gt;,
## #   imdbVotes &lt;dbl&gt;, imdbID &lt;chr&gt;, Type &lt;chr&gt;, DVD &lt;date&gt;,
## #   BoxOffice &lt;chr&gt;, Production &lt;chr&gt;, Website &lt;chr&gt;, Response &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get the actors from the GodFather</span>
<span class="kw">get_actors</span>((gf))</code></pre></div>
<pre><code>## [1] &quot;Marlon Brando&quot;         &quot;Al Pacino&quot;             &quot;James Caan&quot;           
## [4] &quot;Richard S. Castellano&quot;</code></pre>
<div class="figure">
<img src="PICS/api_summary.png" width="550" />

</div>
</div>
<div id="rselenium" class="section level2">
<h2><span class="header-section-number">4.3</span> RSelenium</h2>
<p>Sometimes we interact with websites that use Javascript to load more text or comments in a user forum. Here is an example of that. Look at <a href="https://www.dailystrength.org/group/dialysis" class="uri">https://www.dailystrength.org/group/dialysis</a> which is a website associated with people wanting to share information about dialysis.</p>
<div class="figure">
<img src="PICS/diasupport.png" />

</div>
<p>If you check the bottom of the pag you will see a button.</p>
<div class="figure">
<img src="PICS/showmore.png" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># https://www.dailystrength.org/group/dialysis</span>

<span class="kw">library</span>(RSelenium)
<span class="kw">library</span>(rvest)
<span class="kw">library</span>(tm)
<span class="kw">library</span>(SentimentAnalysis)
<span class="kw">library</span>(wordcloud)

url &lt;-<span class="st"> &quot;https://www.dailystrength.org/group/dialysis&quot;</span>

<span class="co"># The website has a &quot;show more&quot; button that hides most of the patient posts</span>
<span class="co"># If we don&#39;t find a way to programmatically &quot;click&quot; this button then we can</span>
<span class="co"># only get a few of the posts and their responses. To do this we need to</span>
<span class="co"># use the RSelenium package which does a lot of behind the scenes work</span>

<span class="co"># See https://cran.r-project.org/web/packages/RSelenium/RSelenium.pdf</span>
<span class="co"># http://brazenly.blogspot.com/2016/05/r-advanced-web-scraping-dynamic.html</span>

<span class="co"># Open up a connection </span>

rD &lt;-<span class="st"> </span><span class="kw">rsDriver</span>()
remDr &lt;-<span class="st"> </span>rD[[<span class="st">&quot;client&quot;</span>]]
remDr<span class="op">$</span><span class="kw">navigate</span>(url)

loadmorebutton &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">findElement</span>(<span class="dt">using =</span> <span class="st">&#39;css selector&#39;</span>, <span class="st">&quot;#load-more-discussions&quot;</span>)

<span class="co"># Do this a number of times to get more links</span>

loadmorebutton<span class="op">$</span><span class="kw">clickElement</span>()

<span class="co"># Now get the page with more comments and questions</span>

page_source &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">getPageSource</span>()

<span class="co"># So let&#39;s parse the contents</span>

comments &lt;-<span class="st"> </span><span class="kw">read_html</span>(page_source[[<span class="dv">1</span>]])

cumulative_comments &lt;-<span class="st"> </span><span class="kw">vector</span>()

links &lt;-<span class="st"> </span>comments <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="dt">css=</span><span class="st">&quot;.newsfeed__description&quot;</span>)  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_node</span>(<span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)

full_links &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;https://www.dailystrength.org&quot;</span>,links)

<span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">grep</span>(<span class="st">&quot;NA&quot;</span>,full_links)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
  full_links &lt;-<span class="st"> </span>full_links[<span class="op">-</span><span class="kw">grep</span>(<span class="st">&quot;NA&quot;</span>,full_links)]
}

ugly_xpath &lt;-<span class="st"> &#39;//*[contains(concat( &quot; &quot;, @class, &quot; &quot; ), concat( &quot; &quot;, &quot;comments__comment-text&quot;, &quot; &quot; ))] | //p&#39;</span>

<span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(full_links)) {
  text &lt;-<span class="st"> </span><span class="kw">read_html</span>(full_links[ii]) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">html_nodes</span>(<span class="dt">xpath=</span>ugly_xpath) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">html_text</span>() 
  <span class="kw">length</span>(text) &lt;-<span class="st"> </span><span class="kw">length</span>(text) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
  text &lt;-<span class="st"> </span>text[<span class="op">-</span><span class="dv">1</span>]
  
  text
  
  cumulative_comments &lt;-<span class="st"> </span><span class="kw">c</span>(cumulative_comments,text)
}

remDr<span class="op">$</span><span class="kw">close</span>()
<span class="co"># stop the selenium server</span>
rD[[<span class="st">&quot;server&quot;</span>]]<span class="op">$</span><span class="kw">stop</span>()</code></pre></div>
</div>
<div id="easypubmed" class="section level2">
<h2><span class="header-section-number">4.4</span> EasyPubMed</h2>
<p>So there is an R package called <em>EasyPubMed</em> that helps ease the access of data on the Internet. The idea behind this package is to be able to query NCBI Entrez and retrieve PubMed records in XML or TXT format. The PubMed records can be downloaded and saved as XML or text files if desired. According to the package authours, “Data integrity is enforced during data download, allowing to retrieve and save very large number of records effortlessly”. The bottom line is that you can do what you want after that. Let’s look at an example involving home hemodialysis</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(easyPubMed)</code></pre></div>
<p>Let’s do some searching</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_query &lt;-<span class="st"> &#39;hemodialysis, home&quot; [MeSH Terms]&#39;</span>
my_entrez_id &lt;-<span class="st"> </span><span class="kw">get_pubmed_ids</span>(my_query)
my_abstracts_txt &lt;-<span class="st"> </span><span class="kw">fetch_pubmed_data</span>(my_entrez_id, <span class="dt">format =</span> <span class="st">&quot;abstract&quot;</span>)
my_abstracts_txt[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>]</code></pre></div>
<pre><code>##  [1] &quot;&quot;                                                                                  
##  [2] &quot;1. Medicine (Baltimore). 2018 Sep;97(37):e12018. doi: 10.1097/MD.0000000000012018.&quot;
##  [3] &quot;&quot;                                                                                  
##  [4] &quot;Gene co-expression network analysis identifies the hub genes associated with&quot;      
##  [5] &quot;immune functions for nocturnal hemodialysis in patients with end-stage renal&quot;      
##  [6] &quot;disease.&quot;                                                                          
##  [7] &quot;&quot;                                                                                  
##  [8] &quot;Dai H, Zhou J, Zhu B.&quot;                                                             
##  [9] &quot;&quot;                                                                                  
## [10] &quot;End-stage renal disease (ESRD) is the final stage of chronic kidney disease in&quot;    
## [11] &quot;which the kidney is not sufficient to meet the needs of daily life. It is&quot;         
## [12] &quot;necessary to understand the role of genes expression involved in ESRD patient&quot;     
## [13] &quot;responses to nocturnal hemodialysis (NHD) and to improve the immunity&quot;             
## [14] &quot;responsiveness. The aim of this study was to investigate novel immune-associated &quot; 
## [15] &quot;genes that may play important roles in patients with ESRD.The microarray&quot;          
## [16] &quot;expression profiles of peripheral blood in patients with ESRD before and after&quot;    
## [17] &quot;NHD were analyzed by network-based approaches, and then using Gene Ontology (GO) &quot; 
## [18] &quot;and Kyoto Encyclopedia of Genes and Genomes pathway analysis to explore the&quot;       
## [19] &quot;biological process and molecular functions of differentially expressed genes.&quot;     
## [20] &quot;Subsequently, a transcriptional regulatory network of the core genes and the&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_abstracts_xml &lt;-<span class="st"> </span><span class="kw">fetch_pubmed_data</span>(my_entrez_id)</code></pre></div>
<p>Well the results aren’t bad but we still have to parse out some junk but nothing like before. It’s a minor problem. In this case the API gives us some XML back that we then have to parse.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_abstracts &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">xpathApply</span>(my_abstracts_xml, <span class="st">&quot;//AbstractText&quot;</span>, saveXML))

<span class="co"># Still have to clear out some junk in each abstract</span>

my_abstracts &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;&lt;(.*)&quot;&gt;&#39;</span>,<span class="st">&quot;&quot;</span>,my_abstracts)
my_abstracts &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;&lt;AbstractText&gt;|&lt;/AbstractText&gt;&#39;</span>,<span class="st">&quot;&quot;</span>,my_abstracts)

<span class="kw">length</span>(my_abstracts)</code></pre></div>
<pre><code>## [1] 935</code></pre>
<p>But we have around 935 abstracts that we can now mess with. The benefit of this approach is that we dont’ have to do all the text conversions and manipulations that we would have with the manual approach. Plus, we are able to get a lot more results more conveniently.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_abstracts[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</code></pre></div>
<pre><code>## [1] &quot;End-stage renal disease (ESRD) is the final stage of chronic kidney disease in which the kidney is not sufficient to meet the needs of daily life. It is necessary to understand the role of genes expression involved in ESRD patient responses to nocturnal hemodialysis (NHD) and to improve the immunity responsiveness. The aim of this study was to investigate novel immune-associated genes that may play important roles in patients with ESRD.The microarray expression profiles of peripheral blood in patients with ESRD before and after NHD were analyzed by network-based approaches, and then using Gene Ontology (GO) and Kyoto Encyclopedia of Genes and Genomes pathway analysis to explore the biological process and molecular functions of differentially expressed genes. Subsequently, a transcriptional regulatory network of the core genes and the connected transcriptional regulators was constructed. We found that NHD had a significant effect on neutrophil activation and immune response in patients with ESRD.In addition, Our findings suggest that MAPKAPK3, RHOA, ARRB2, FLOT1, MYH9, PRKCD, RHOG, PTPN6, MAPK3, CNPY3, PI3KCG, and PYGL genes maybe potential targets regulated by core transcriptional factors, including ARNT, C/EBPalpha, CEBPA, CREB1, PSG1, DAND5, SP1, GATA1, MYC, EGR2, and EGR3.&quot;                                               
## [2] &quot;Only a minority of patients with chronic kidney disease treated by hemodialysis are currently treated at home. Until relatively recently, the only type of hemodialysis machine available for these patients was a slightly smaller version of the standard machines used for in-center dialysis treatments. Areas covered: There are now an alternative generation of dialysis machines specifically designed for home hemodialysis. The home dialysis patient wants a smaller machine, which is intuitive to use, easy to trouble shoot, robust and reliable, quick to setup and put away, requiring minimal waste disposal. The machines designed for home dialysis have some similarities in terms of touch-screen patient interfaces, and using pre-prepared cartridges to speed up setting up the machine. On the other hand, they differ in terms of whether they use slower or standard dialysate flows, prepare batches of dialysis fluid, require separate water purification equipment, or whether this is integrated, or use pre-prepared sterile bags of dialysis fluid. Expert commentary: Dialysis machine complexity is one of the hurdles reducing the number of patients opting for home hemodialysis and the introduction of the newer generation of dialysis machines designed for ease of use will hopefully increase the number of patients opting for home hemodialysis.&quot;
## [3] &quot;Home haemodialysis (HHD) has the potential to impact positively on patient outcomes and health resource management. There has been rejuvenated international interest in HHD in recent years.&quot;</code></pre>
<!--chapter:end:03-apis.Rmd-->
</div>
</div>
<div id="bagofwords" class="section level1">
<h1><span class="header-section-number">5</span> Bag of Words Sentiment Analysis</h1>
<p>One we have a collection of text it’s interesting to figure out what it might mean or infer - if anything at all. In text analysis and NLP (Natural Language Processing) we talk about “Bag of Words” to describe a collection or “corpus” of unstructured text. What do we do with a “bag of words” ?</p>
<ul>
<li>Extract meaning from collections of text (without reading !)</li>
<li>Detect and analyze patterns in unstructured textual collections</li>
<li>Use Natural Language Processing techniques to reach conclusions</li>
<li>Discover what ideas occur in text and how they might be linked</li>
<li>Determine if the discovered patterns be used to predict behavior ?</li>
<li>Identify interesting ideas that might otherwise be ignored</li>
</ul>
<div id="workflow" class="section level2">
<h2><span class="header-section-number">5.1</span> Workflow</h2>
<ul>
<li>Identify and Obtain text (e.g. websites, Twitter, Databases, PDFs, surveys)</li>
<li>Create a text ”Corpus”- a structure that contains the raw text</li>
<li>Apply transformations:
<ul>
<li>Normalize case (convert to lower case)</li>
<li>Remove puncutation and stopwords</li>
<li>Remove domain specific stopwords</li>
</ul></li>
<li>Perform Analysis and Visualizations (word frequency, tagging, wordclouds)</li>
<li>Do Sentiment Analysis</li>
</ul>
<p>R has Packages to Help. These are just some of them:</p>
<ul>
<li>QDAP - Quantitative Discourse Package</li>
<li>tm - text mining applications within R</li>
<li>tidytext - Text Mining using ddplyr and ggplot and tidyverse tools</li>
<li>SentimentAnalysis - For Sentiment Analysis</li>
</ul>
<p>However, consider that:</p>
<ul>
<li>Some of these are easier to use than others</li>
<li>Some can be kind of a problem to install (e.g. qdap)</li>
<li>They all offer similar capabilities</li>
<li>We’ll look at tidytext</li>
</ul>
</div>
<div id="simple-example" class="section level2">
<h2><span class="header-section-number">5.2</span> Simple Example</h2>
<div class="figure">
<img src="PICS/prez.png" width="650" />

</div>
<p>Find the URL for Lincoln’s March 4, 1865 Speech:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://millercenter.org/the-presidency/presidential-speeches/march-4-1865-second-inaugural-address&quot;</span>
<span class="kw">library</span>(rvest)
lincoln_doc &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span>
<span class="st">                    </span><span class="kw">html_nodes</span>(<span class="st">&quot;.view-transcript&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">                    </span><span class="kw">html_text</span>()
lincoln_doc</code></pre></div>
<pre><code>## [1] &quot;TranscriptFellow-Countrymen:  At this second appearing to take the oath of the Presidential office there is less occasion for an extended address than there was at the first. Then a statement somewhat in detail of a course to be pursued seemed fitting and proper. Now, at the expiration of four years, during which public declarations have been constantly called forth on every point and phase of the great contest which still absorbs the attention and engrosses the energies of the nation, little that is new could be presented. The progress of our arms, upon which all else chiefly depends, is as well known to the public as to myself, and it is, I trust, reasonably satisfactory and encouraging to all. With high hope for the future, no prediction in regard to it is ventured.On the occasion corresponding to this four years ago all thoughts were anxiously directed to an impending civil war. All dreaded it, all sought to avert it. While the inaugural address was being delivered from this place, devoted altogether to saving the Union without war, insurgent agents were in the city seeking to destroy it without war-seeking to dissolve the Union and divide effects by negotiation. Both parties deprecated war, but one of them would make war rather than let the nation survive, and the other would accept war rather than let it perish, and the war came.One-eighth of the whole population were colored slaves, not distributed generally over the Union. but localized in the southern part of it. These slaves constituted a peculiar and powerful interest. All knew that this interest was somehow the cause of the war. To strengthen, perpetuate, and extend this interest was the object for which the insurgents would rend the Union even by war, while the Government claimed no right to do more than to restrict the territorial enlargement of it. Neither party expected for the war the magnitude or the duration which it has already attained. Neither anticipated that the cause of the conflict might cease with or even before the conflict itself should cease. Each looked for an easier triumph, and a result less fundamental and astounding. Both read the same Bible and pray to the same God, and each invokes His aid against the other. It may seem strange that any men should dare to ask a just God&#39;s assistance in wringing their bread from the sweat of other men&#39;s faces, but let us judge not, that we be not judged. The prayers of both could not be answered. That of neither has been answered fully. The Almighty has His own purposes. \&quot;Woe unto the world because of offenses; for it must needs be that offenses come, but woe to that man by whom the offense cometh.\&quot; If we shall suppose that American slavery is one of those offenses which, in the providence of God, must needs come, but which, having continued through His appointed time, He now wills to remove, and that He gives to both North and South this terrible war as the woe due to those by whom the offense came, shall we discern therein any departure from those divine attributes which the believers in a living God always ascribe to Him? Fondly do we hope, fervently do we pray, that this mighty scourge of war may speedily pass away. Yet, if God wills that it continue until all the wealth piled by the bondsman&#39;s two hundred and fifty years of unrequited toil shall be sunk, and until every drop of blood drawn with the lash shall be paid by another drawn with the sword, as was said three thousand years ago, so still it must be said \&quot;the judgments of the Lord are true and righteous altogether.\&quot;With malice toward none, with charity for all, with firmness in the fight as God gives us to see the right, let us strive on to finish the work we are in, to bind up the nation&#39;s wounds, to care for him who shall have borne the battle and for his widow and his orphan, to do all which may achieve and cherish a just and lasting peace among ourselves and with all nations.&quot;</code></pre>
<p>There are probably lots of words that don’t really “matter” or contribute to the “real” meaning of the speech.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">word_vec &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(lincoln_doc,<span class="st">&quot; &quot;</span>))
word_vec[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>]</code></pre></div>
<pre><code>##  [1] &quot;TranscriptFellow-Countrymen:&quot; &quot;&quot;                            
##  [3] &quot;At&quot;                           &quot;this&quot;                        
##  [5] &quot;second&quot;                       &quot;appearing&quot;                   
##  [7] &quot;to&quot;                           &quot;take&quot;                        
##  [9] &quot;the&quot;                          &quot;oath&quot;                        
## [11] &quot;of&quot;                           &quot;the&quot;                         
## [13] &quot;Presidential&quot;                 &quot;office&quot;                      
## [15] &quot;there&quot;                        &quot;is&quot;                          
## [17] &quot;less&quot;                         &quot;occasion&quot;                    
## [19] &quot;for&quot;                          &quot;an&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sort</span>(<span class="kw">table</span>(word_vec),<span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</code></pre></div>
<pre><code>## word_vec
##  the   to  and   of that  for   be   in   it    a 
##   54   26   24   22   11    9    8    8    8    7</code></pre>
<p>How do we remove all the uninteresting words ? We could do it manaully</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Remove all punctuation marks</span>
word_vec &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>,<span class="st">&quot;&quot;</span>,word_vec)
stop_words &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;the&quot;</span>,<span class="st">&quot;to&quot;</span>,<span class="st">&quot;and&quot;</span>,<span class="st">&quot;of&quot;</span>,<span class="st">&quot;the&quot;</span>,<span class="st">&quot;for&quot;</span>,<span class="st">&quot;in&quot;</span>,<span class="st">&quot;it&quot;</span>,
                <span class="st">&quot;a&quot;</span>,<span class="st">&quot;this&quot;</span>,<span class="st">&quot;which&quot;</span>,<span class="st">&quot;by&quot;</span>,<span class="st">&quot;is&quot;</span>,<span class="st">&quot;an&quot;</span>,<span class="st">&quot;hqs&quot;</span>,<span class="st">&quot;from&quot;</span>,
                <span class="st">&quot;that&quot;</span>,<span class="st">&quot;with&quot;</span>,<span class="st">&quot;as&quot;</span>)
<span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(stop_words)) {
    <span class="cf">for</span> (jj <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(word_vec)) {
      <span class="cf">if</span> (stop_words[ii] <span class="op">==</span><span class="st"> </span>word_vec[jj]) {
          word_vec[jj] &lt;-<span class="st"> &quot;&quot;</span>
} }
}
word_vec &lt;-<span class="st"> </span>word_vec[word_vec <span class="op">!=</span><span class="st"> &quot;&quot;</span>]
<span class="kw">sort</span>(<span class="kw">table</span>(word_vec),<span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</code></pre></div>
<pre><code>## word_vec
##   war   all    be    we   but   God shall   was    do   let 
##    11     8     8     6     5     5     5     5     4     4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">word_vec[<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>]</code></pre></div>
<pre><code>##  [1] &quot;TranscriptFellowCountrymen&quot; &quot;At&quot;                        
##  [3] &quot;second&quot;                     &quot;appearing&quot;                 
##  [5] &quot;take&quot;                       &quot;oath&quot;                      
##  [7] &quot;Presidential&quot;               &quot;office&quot;                    
##  [9] &quot;there&quot;                      &quot;less&quot;                      
## [11] &quot;occasion&quot;                   &quot;extended&quot;                  
## [13] &quot;address&quot;                    &quot;than&quot;                      
## [15] &quot;there&quot;                      &quot;was&quot;                       
## [17] &quot;at&quot;                         &quot;first&quot;                     
## [19] &quot;Then&quot;                       &quot;statement&quot;                 
## [21] &quot;somewhat&quot;                   &quot;detail&quot;                    
## [23] &quot;course&quot;                     &quot;be&quot;                        
## [25] &quot;pursued&quot;                    &quot;seemed&quot;                    
## [27] &quot;fitting&quot;                    &quot;proper&quot;                    
## [29] &quot;Now&quot;                        &quot;at&quot;</code></pre>
</div>
<div id="tidytext" class="section level2">
<h2><span class="header-section-number">5.3</span> tidytext</h2>
<p>A better way would be to use the tidytext package. First we need to create a data frame out of the text. Then we “tokenize” the text which means we have one line per word.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidytext)

text_df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">line =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(lincoln_doc), <span class="dt">text =</span> lincoln_doc)
token_text &lt;-<span class="st"> </span>text_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_tokens</span>(word, text)

token_text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(word,<span class="dt">sort=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 339 x 2
##    word      n
##    &lt;chr&gt; &lt;int&gt;
##  1 the      58
##  2 to       27
##  3 and      24
##  4 of       22
##  5 it       13
##  6 that     12
##  7 war      12
##  8 all      10
##  9 for       9
## 10 in        9
## # ... with 329 more rows</code></pre>
<p>But we need to get rid of the “stop words”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now remove stop words</span>
<span class="kw">data</span>(stop_words)
tidy_text &lt;-<span class="st"> </span>token_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(stop_words)</code></pre></div>
<pre><code>## Joining, by = &quot;word&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This could also be done by the following. I point this out only because some people react</span>
<span class="co"># negatively to &quot;joins&quot; although fully understanding what joins are can only help you since</span>
<span class="co"># much of what the dplyr package does is based on SQL type joins. </span>

tidy_text &lt;-<span class="st"> </span>token_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>word <span class="op">%in%</span><span class="st"> </span>stop_words<span class="op">$</span>word)

tidy_text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(word,<span class="dt">sort=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 193 x 2
##    word           n
##    &lt;chr&gt;      &lt;int&gt;
##  1 war           12
##  2 god            5
##  3 union          4
##  4 offenses       3
##  5 woe            3
##  6 address        2
##  7 ago            2
##  8 altogether     2
##  9 answered       2
## 10 cease          2
## # ... with 183 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(word,<span class="dt">sort=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 193 x 2
##    word           n
##    &lt;chr&gt;      &lt;int&gt;
##  1 war           12
##  2 god            5
##  3 union          4
##  4 offenses       3
##  5 woe            3
##  6 address        2
##  7 ago            2
##  8 altogether     2
##  9 answered       2
## 10 cease          2
## # ... with 183 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">word =</span> <span class="kw">reorder</span>(word, n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(word, n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
</div>
<div id="back-to-the-pubmed-example" class="section level2">
<h2><span class="header-section-number">5.4</span> Back To The PubMed Example</h2>
<p>We have around 935 abstracts that we can now mess with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a data frame out of the cleaned up abstracts</span>

text_df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">line =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(my_abstracts), <span class="dt">text =</span> my_abstracts)
token_text &lt;-<span class="st"> </span>text_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_tokens</span>(word, text)

<span class="co"># Many of these words aren&#39;t helpful </span>
token_text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(<span class="dt">total=</span>word,<span class="dt">sort=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 6,942 x 2
##    total        n
##    &lt;chr&gt;    &lt;int&gt;
##  1 the       3087
##  2 of        2929
##  3 and       2880
##  4 in        1919
##  5 to        1863
##  6 a         1376
##  7 dialysis  1335
##  8 patients  1324
##  9 home      1236
## 10 with      1035
## # ... with 6,932 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now remove stop words</span>
<span class="kw">data</span>(stop_words)
tidy_text &lt;-<span class="st"> </span>token_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(stop_words)</code></pre></div>
<pre><code>## Joining, by = &quot;word&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This could also be done by the following. I point this out only because some people react</span>
<span class="co"># negatively to &quot;joins&quot; although fully understanding what joins are can only help you since</span>
<span class="co"># much of what the dplyr package does is based on SQL type joins. </span>

tidy_text &lt;-<span class="st"> </span>token_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>word <span class="op">%in%</span><span class="st"> </span>stop_words<span class="op">$</span>word)

<span class="co"># Arrange the text by descending word frequency </span>

tidy_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) </code></pre></div>
<pre><code>## # A tibble: 6,465 x 2
##    word             n
##    &lt;chr&gt;        &lt;int&gt;
##  1 dialysis      1335
##  2 patients      1324
##  3 home          1236
##  4 hemodialysis   665
##  5 hd             472
##  6 hhd            406
##  7 patient        380
##  8 pd             307
##  9 renal          277
## 10 study          270
## # ... with 6,455 more rows</code></pre>
<p>Some of the most frequently occurring words are in fact “dialysis”, “patients” so maybe we should consider them to be stop words also since we already know quite well that the overall theme is, well, dialysis and kidneys. There are also synonymns and abbreviations that are somewhat redundant such as “pdd”,“pd”,“hhd” so let’s eliminate them also.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_text &lt;-<span class="st"> </span>token_text <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">filter</span>(<span class="op">!</span>word <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(stop_words<span class="op">$</span>word,<span class="st">&quot;dialysis&quot;</span>,<span class="st">&quot;patients&quot;</span>,<span class="st">&quot;home&quot;</span>,<span class="st">&quot;kidney&quot;</span>,
                       <span class="st">&quot;hemodialysis&quot;</span>,<span class="st">&quot;haemodialysis&quot;</span>,<span class="st">&quot;patient&quot;</span>,<span class="st">&quot;hhd&quot;</span>,
                       <span class="st">&quot;pd&quot;</span>,<span class="st">&quot;peritoneal&quot;</span>,<span class="st">&quot;hd&quot;</span>,<span class="st">&quot;renal&quot;</span>,<span class="st">&quot;study&quot;</span>,<span class="st">&quot;care&quot;</span>,
                       <span class="st">&quot;ci&quot;</span>,<span class="st">&quot;chd&quot;</span>,<span class="st">&quot;nhd&quot;</span>,<span class="st">&quot;disease&quot;</span>))

tidy_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) </code></pre></div>
<pre><code>## # A tibble: 6,447 x 2
##    word             n
##    &lt;chr&gt;        &lt;int&gt;
##  1 treatment      228
##  2 therapy        191
##  3 survival       188
##  4 clinical       180
##  5 center         178
##  6 conventional   177
##  7 nocturnal      177
##  8 quality        176
##  9 compared       172
## 10 outcomes       165
## # ... with 6,437 more rows</code></pre>
<p>Let’s do some plotting of these words</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">word =</span> <span class="kw">reorder</span>(word, n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(word, n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p>Okay, it looks like there are numbers in there which might be useful. I suspect that the “95” is probably associated with the idea of a confidence interval. But there are other references to numbers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">grep</span>(<span class="st">&quot;^[0-9]{1,3}$&quot;</span>,tidy_text<span class="op">$</span>word)[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>]</code></pre></div>
<pre><code>##  [1] 203 260 268 269 271 333 347 351 356 400 401 409 410 446 513 523 530
## [18] 545 552 569</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_text_nonum &lt;-<span class="st"> </span>tidy_text[<span class="kw">grep</span>(<span class="st">&quot;^[0-9]{1,3}$&quot;</span>,tidy_text<span class="op">$</span>word,<span class="dt">invert=</span><span class="ot">TRUE</span>),]</code></pre></div>
<p>Okay well I think maybe we have some reasonable data to examine. As you might have realized by now, manipulating data to get it “clean” can be tedious and frustrating though it is an inevitable part of the process.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_text_nonum <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">word =</span> <span class="kw">reorder</span>(word, n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(word, n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nrc_joy &lt;-<span class="st"> </span><span class="kw">get_sentiments</span>(<span class="st">&quot;nrc&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(sentiment <span class="op">==</span><span class="st"> &quot;joy&quot;</span>)

bing_word_counts &lt;-<span class="st"> </span>tidy_text_nonum <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(<span class="kw">get_sentiments</span>(<span class="st">&quot;nrc&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(word,sentiment,<span class="dt">sort=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Joining, by = &quot;word&quot;</code></pre>
<p>t the positive vs negative words</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bing_word_counts <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(sentiment) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">top_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">word =</span> <span class="kw">reorder</span>(word, n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(word, n, <span class="dt">fill =</span> sentiment)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>sentiment, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Contribution to sentiment&quot;</span>,
       <span class="dt">x =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<pre><code>## Selecting by n</code></pre>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<p>Let’s create a word cloud</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(wordcloud)
<span class="co">#</span>

tidy_text_nonum <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">count</span>(word) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">with</span>(<span class="kw">wordcloud</span>(word,n,<span class="dt">max.words=</span><span class="dv">100</span>,<span class="dt">colors=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&quot;Dark2&quot;</span>)))</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
</div>
<div id="bigrams" class="section level2">
<h2><span class="header-section-number">5.5</span> BiGrams</h2>
<p>Let’s look at bigrams. We need to go back to the cleaned abstracts and pair words to get phrase that might be suggestive of some sentiment</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text_df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">line =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(my_abstracts), <span class="dt">text =</span> my_abstracts)
dialysis_bigrams &lt;-<span class="st"> </span>text_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_tokens</span>(bigram, text, <span class="dt">token =</span> <span class="st">&quot;ngrams&quot;</span>, <span class="dt">n =</span> <span class="dv">2</span>)

dialysis_bigrams <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(bigram, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 41,630 x 2
##    bigram                  n
##    &lt;chr&gt;               &lt;int&gt;
##  1 in the                382
##  2 of the                316
##  3 home dialysis         280
##  4 home hemodialysis     267
##  5 peritoneal dialysis   198
##  6 of home               189
##  7 associated with       172
##  8 home hd               153
##  9 home haemodialysis    138
## 10 in center             138
## # ... with 41,620 more rows</code></pre>
<p>But we have to filter out stop words</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bigrams_sep &lt;-<span class="st"> </span>dialysis_bigrams <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(bigram,<span class="kw">c</span>(<span class="st">&quot;word1&quot;</span>,<span class="st">&quot;word2&quot;</span>),<span class="dt">sep=</span><span class="st">&quot; &quot;</span>)

stop_list &lt;-<span class="st"> </span><span class="kw">c</span>(stop_words<span class="op">$</span>word,<span class="st">&quot;dialysis&quot;</span>,<span class="st">&quot;patients&quot;</span>,<span class="st">&quot;home&quot;</span>,<span class="st">&quot;kidney&quot;</span>,
                       <span class="st">&quot;hemodialysis&quot;</span>,<span class="st">&quot;haemodialysis&quot;</span>,<span class="st">&quot;patient&quot;</span>,<span class="st">&quot;hhd&quot;</span>,
                       <span class="st">&quot;pd&quot;</span>,<span class="st">&quot;peritoneal&quot;</span>,<span class="st">&quot;hd&quot;</span>,<span class="st">&quot;renal&quot;</span>,<span class="st">&quot;study&quot;</span>,<span class="st">&quot;care&quot;</span>,
                       <span class="st">&quot;ci&quot;</span>,<span class="st">&quot;chd&quot;</span>,<span class="st">&quot;nhd&quot;</span>,<span class="st">&quot;esrd&quot;</span>,<span class="st">&quot;lt&quot;</span>,<span class="st">&quot;95&quot;</span>,<span class="st">&quot;0.001&quot;</span>)

bigrams_filtered &lt;-<span class="st"> </span>bigrams_sep <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>word1 <span class="op">%in%</span><span class="st"> </span>stop_list) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>word2 <span class="op">%in%</span><span class="st"> </span>stop_list)

bigram_counts &lt;-<span class="st"> </span>bigrams_filtered <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(word1, word2, <span class="dt">sort =</span> <span class="ot">TRUE</span>)

bigrams_united &lt;-<span class="st"> </span>bigrams_filtered <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unite</span>(bigram, word1, word2, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)

bigrams_united <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">count</span>(bigram, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">n=</span><span class="dv">25</span>)</code></pre></div>
<pre><code>## # A tibble: 11,825 x 2
##    bigram                     n
##    &lt;chr&gt;                  &lt;int&gt;
##  1 replacement therapy       69
##  2 vascular access           62
##  3 technique failure         54
##  4 left ventricular          42
##  5 confidence interval       40
##  6 blood pressure            39
##  7 clinical outcomes         36
##  8 thrice weekly             32
##  9 short daily               31
## 10 technique survival        29
## 11 quality improvement       26
## 12 hazard ratio              25
## 13 adverse events            22
## 14 6 months                  20
## 15 access related            20
## 16 ventricular mass          19
## 17 12 months                 18
## 18 arteriovenous fistula     17
## 19 3 times                   15
## 20 buttonhole cannulation    15
## 21 daily life                15
## 22 health related            15
## 23 observational studies     15
## 24 cost effective            14
## 25 cost effectiveness        14
## # ... with 1.18e+04 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bigram_counts <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(word1, <span class="op">-</span>n), <span class="dt">y =</span> <span class="kw">reorder</span>(word2, <span class="op">-</span>n), <span class="dt">fill =</span> n)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_tile</span>(<span class="dt">alpha =</span> <span class="fl">0.8</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colours =</span> <span class="kw">c</span>(<span class="kw">palette_light</span>()[[<span class="dv">1</span>]], <span class="kw">palette_light</span>()[[<span class="dv">2</span>]])) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">theme_tq</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;right&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;first word in pair&quot;</span>,
         <span class="dt">y =</span> <span class="st">&quot;second word in pair&quot;</span>)</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<!--chapter:end:04-bow.Rmd-->
</div>
</div>
<div id="final-words" class="section level1">
<h1><span class="header-section-number">6</span> Final Words</h1>
<p>We have finished a nice book.</p>
<!--chapter:end:05-summary.Rmd-->
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<!--chapter:end:06-references.Rmd-->
</div>
<div id="motivations-1" class="section level1">
<h1><span class="header-section-number">7</span> Motivations</h1>
<div id="lots-of-data-for-the-taking-1" class="section level2">
<h2><span class="header-section-number">7.1</span> Lots of Data For The Taking ?</h2>
<p>The web hosts lots of interesting data that you can ”scrape”. Some of it is stashed in data bases, behind APIs, or in free form text. Lots of people want to grab information of of Twitter or from user forums to see what people are thinking. There is a lot of valuable information out there for the taking although some web sites have “caught on” and either block programmatic access or they setup “pay walls” that require you to subscribe to an API for access. The New York Times does this. But there are lots of opportunities to get data.</p>
<table>
<tbody>
<tr class="odd">
<td>tables</td>
<td>Fetch tables like from Wikipedia</td>
</tr>
<tr class="even">
<td>forms</td>
<td>You can submit forms and fetch the results</td>
</tr>
<tr class="odd">
<td>css</td>
<td>You can access parts of a web site using style or css selectors</td>
</tr>
<tr class="even">
<td>Tweets</td>
<td>Process tweets including emojis</td>
</tr>
<tr class="odd">
<td>Web Sites</td>
<td>User forums have lots of content</td>
</tr>
<tr class="even">
<td>Instagram</td>
<td>Yes you can “scrape” photos also</td>
</tr>
</tbody>
</table>
</div>
<div id="web-scraping-can-be-ugly-1" class="section level2">
<h2><span class="header-section-number">7.2</span> Web Scraping Can Be Ugly</h2>
<p>Depending on what web sites you want to scrape the process can be involved and quite tedious. Many websites are very much aware that people are scraping so they offer Application Programming Interfaces (APIs) to make requests for information easier for the user and easier for the server administrators to control access. Most times the user must apply for a “key” to gain access. For premium sites, the key costs money. Some sites like Google and Wunderground (a popular weather site) allow some number of free accesses before they start charging you. Even so the results are typically returned in XML or JSON which then requires you to parse the result to get the information you want. In the best situation there is an R package that will wrap in the parsing and will return lists or data frames.</p>
<p>Here is a summary:</p>
<ul>
<li><p>First. Always try to find an R package that will access a site (e.g. New York Times, Wunderground, PubMed). These packages (e.g. omdbapi, easyPubMed, RBitCoin, rtimes) provide a programmatic search interface and return data frames with little to no effort on your part.</p></li>
<li><p>If no package exists then hopefully there is an API that allows you to query the website and get results back in JSON or XML. I prefer JSON because it’s “easier” and the packages for parsing JSON return lists which are native data structures to R. So you can easily turn results into data frames. You will ususally use the <em>rvest</em> package in conjunction with XML, and the RSJONIO packages.</p></li>
<li><p>If the Web site doesn’t have an API then you will need to scrape text. This isn’t hard but it is tedious. You will need to use <em>rvest</em> to parse HMTL elements. If you want to parse mutliple pages then you will need to use <em>rvest</em> to move to the other pages and possibly fill out forms. If there is a lot of Javascript then you might need to use RSelenium to programmatically manage the web page.</p></li>
</ul>
</div>
<div id="understanding-the-language-of-the-web-1" class="section level2">
<h2><span class="header-section-number">7.3</span> Understanding The Language of The Web</h2>
<p>The Web has its own languages: HTML, CSS, Javascript</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;</span>h1<span class="op">&gt;</span>, <span class="op">&lt;</span>h2<span class="op">&gt;</span>, ..., <span class="op">&lt;</span>h6<span class="op">&gt;</span><span class="st"> </span>Heading <span class="dv">1</span> and so on
<span class="op">&lt;</span>p<span class="op">&gt;</span><span class="st"> </span>Paragraph elements
<span class="op">&lt;</span>ul<span class="op">&gt;</span><span class="st"> </span>Unordered List
<span class="op">&lt;</span>ol<span class="op">&gt;</span><span class="st"> </span>Ordered List
<span class="op">&lt;</span>li<span class="op">&gt;</span><span class="st"> </span>List Element
<span class="op">&lt;</span>div<span class="op">&gt;</span><span class="st"> </span>Division <span class="op">/</span><span class="st"> </span>Section
<span class="op">&lt;</span>table<span class="op">&gt;</span><span class="st"> </span>Tables
<span class="op">&lt;</span>form<span class="op">&gt;</span><span class="st"> </span>Web forms</code></pre></div>
<p>So to be productive at scraping requires you to have some familiairty with HMTL XML, and CSS. Here we look at a very basic HTML file</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;!</span>DOCTYPE html<span class="op">&gt;</span>
<span class="er">&lt;</span>html<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>body<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>h1<span class="op">&gt;</span>My First Heading<span class="op">&lt;</span><span class="er">/</span>h1<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>p<span class="op">&gt;</span>My first paragraph.<span class="op">&lt;</span><span class="er">/</span>p<span class="op">&gt;</span>
<span class="st">   </span><span class="er">&lt;/</span>body<span class="op">&gt;</span>
<span class="er">&lt;/</span>html<span class="op">&gt;</span></code></pre></div>
<div class="figure">
<img src="PICS/first_heading.png" width="450" />

</div>
<p> </p>
<p>And you could apply some styling to this courtest of the CSS language which allows you to inject styles into plain HTML:</p>
<div class="figure">
<img src="PICS/css.png" width="450" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/css_page.png" width="450" />

</div>
<p>There are a number of tools that allow us to inspect web pages and see “what is under the hood”. Warning - I just discovered that one of my favorite browser plugins to find the xpaths and/or css paths of page elements is no longer supported under Firefox or Chrome. I’ve found a couple of replacements but they don’t work as well. I’ll research it more.</p>
<p> </p>
<table style="width:56%;">
<colgroup>
<col width="9%" />
<col width="45%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Selector Gadget</td>
<td><a href="http://selectorgadget.com/" class="uri">http://selectorgadget.com/</a></td>
</tr>
<tr class="even">
<td>Firebug</td>
<td><a href="https://getfirebug.com/" class="uri">https://getfirebug.com/</a> (now integrated into a version of Firefox)</td>
</tr>
<tr class="odd">
<td>Google Chrome</td>
<td>Right click to inspect a page element</td>
</tr>
<tr class="even">
<td>Google Chrome</td>
<td>View Developer - Developer Tools</td>
</tr>
<tr class="odd">
<td>Oxygen Editor</td>
<td>Can obtain via the Emory Software Express Site</td>
</tr>
</tbody>
</table>
</div>
<div id="useful-packages-1" class="section level2">
<h2><span class="header-section-number">7.4</span> Useful Packages</h2>
<p>You will use the following three primary packages to help you get data from various web pages: <em>rvest</em>, <em>XML</em>, and <em>RJSONIO</em>. Note that you won’t always use them simultaneously but you might use them in pairs or individually depending on the task at hand.</p>
</div>
<div id="quick-rvest-tutorial-1" class="section level2">
<h2><span class="header-section-number">7.5</span> Quick <strong>rvest</strong> tutorial</h2>
<p>Now let’s do a quick <em>rvest</em> tutorial:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>

(paragraphs &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;p&quot;</span>))</code></pre></div>
<pre><code>## {xml_nodeset (61)}
##  [1] &lt;p class=&quot;mw-empty-elt&quot;&gt; \n&lt;/p&gt;
##  [2] &lt;p class=&quot;mw-empty-elt&quot;&gt;\n&lt;/p&gt;
##  [3] &lt;p&gt;In &lt;a href=&quot;/wiki/Demographics&quot; class=&quot;mw-redirect&quot; title=&quot;Demog ...
##  [4] &lt;p&gt;World population has experienced &lt;a href=&quot;/wiki/Population_growt ...
##  [5] &lt;p&gt;Total annual births were highest in the late 1980s at about 139  ...
##  [6] &lt;p&gt;Six of the &lt;a href=&quot;/wiki/Earth&quot; title=&quot;Earth&quot;&gt;Earth&lt;/a&gt;&#39;s seven ...
##  [7] &lt;p&gt;Estimates of world population by their nature are an aspect of &lt; ...
##  [8] &lt;p&gt;It is difficult for estimates to be better than rough approximat ...
##  [9] &lt;p&gt;Estimates of the population of the world at the time agriculture ...
## [10] &lt;p&gt;The &lt;a href=&quot;/wiki/Plague_of_Justinian&quot; title=&quot;Plague of Justini ...
## [11] &lt;p&gt;Starting in AD 2, the &lt;a href=&quot;/wiki/Han_Dynasty&quot; class=&quot;mw-redi ...
## [12] &lt;p&gt;The &lt;a href=&quot;/wiki/Pre-Columbian_era&quot; title=&quot;Pre-Columbian era&quot;&gt; ...
## [13] &lt;p&gt;During the European &lt;a href=&quot;/wiki/British_Agricultural_Revoluti ...
## [14] &lt;p&gt;Population growth in the West became more rapid after the introd ...
## [15] &lt;p&gt;The first half of the 20th century in &lt;a href=&quot;/wiki/Russian_Emp ...
## [16] &lt;p&gt;Many countries in the &lt;a href=&quot;/wiki/Developing_world&quot; class=&quot;mw ...
## [17] &lt;p&gt;It is estimated that the world population reached one billion fo ...
## [18] &lt;p&gt;According to current projections, the global population will rea ...
## [19] &lt;p&gt;There is no estimation for the exact day or month the world&#39;s po ...
## [20] &lt;p&gt;As of 2012, the global &lt;a href=&quot;/wiki/Human_sex_ratio&quot; title=&quot;Hu ...
## ...</code></pre>
<p>Then we might want to actually parse out those paragraphs into text:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>
paragraphs &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;p&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()
paragraphs[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</code></pre></div>
<pre><code>##  [1] &quot; \n&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
##  [2] &quot;\n&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
##  [3] &quot;In demographics, the world population is the total number of humans currently living, and was estimated to have reached 7.7 billion people as of November 2018.[1] It took over 200,000 years of human history for the world&#39;s population to reach 1 billion;[2] and only 200 years more to reach 7 billion.[3]&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
##  [4] &quot;World population has experienced continuous growth since the end of the Great Famine of 1315–17 and the Black Death in 1350, when it was near 370 million.[4] \nThe highest population growth rates – global population increases above 1.8% per year – occurred between 1955 and 1975, peaking to 2.06% between 1965 and 1970.[5] The growth rate has declined to 1.18% between 2010 and 2015 and is projected to decline further in the course of the 21st century.[5]&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
##  [5] &quot;Total annual births were highest in the late 1980s at about 139 million,[6] and as of 2011 were expected to remain essentially constant at a level of 135 million,[7] while deaths numbered 56 million per year and were expected to increase to 80 million per year by 2040.[8] \nThe median age of the world&#39;s population was estimated to be 30.4 years in 2018.[9]&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [6] &quot;Six of the Earth&#39;s seven continents are permanently inhabited on a large scale. Asia is the most populous continent, with its 4.54 billion inhabitants accounting for 60% of the world population. The world&#39;s two most populated countries, China and India, together constitute about 36% of the world&#39;s population. Africa is the second most populated continent, with around 1.28 billion people, or 16% of the world&#39;s population. Europe&#39;s 742 million people make up 10% of the world&#39;s population as of 2018, while the Latin American and Caribbean regions are home to around 651 million (9%). Northern America, primarily consisting of the United States and Canada, has a population of around 363 million (5%), and Oceania, the least populated region, has about 41 million inhabitants (0.5%).[11] Though it is not permanently inhabited by any fixed population, Antarctica has a small, fluctuating international population based mainly in polar science stations. This population tends to rise in the summer months and decrease significantly in winter, as visiting researchers return to their home countries.[12]&quot;
##  [7] &quot;Estimates of world population by their nature are an aspect of modernity, possible only since the Age of Discovery. Early estimates for the population of the world[14] date to the 17th century: William Petty in 1682 estimated world population at  320 million (modern estimates ranging close to twice this number); by the late 18th century, estimates ranged close to one billion (consistent with modern estimates).[15] More refined estimates, broken down by continents, were published in the first half of the 19th century, at 600 to 1000 million in the early 1800s and at 800 to 1000 million in the 1840s.[16]&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
##  [8] &quot;It is difficult for estimates to be better than rough approximations, as even modern population estimates are fraught with uncertainties on the order of 3% to 5%.[17]&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [9] &quot;Estimates of the population of the world at the time agriculture emerged in around 10,000 BC have ranged between 1 million and 15 million.[18][19]  Even earlier, genetic evidence suggests humans may have gone through a population bottleneck of between 1,000 and 10,000 people about 70,000 BC, according to the Toba catastrophe theory. By contrast, it is estimated that around 50–60 million people lived in the combined eastern and western Roman Empire in the 4th century AD.[20]&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
## [10] &quot;The Plague of Justinian, which first emerged during the reign of the Roman emperor Justinian, caused Europe&#39;s population to drop by around 50% between the 6th and 8th centuries AD.[21] The population of Europe was more than 70 million in 1340.[22] The Black Death pandemic of the 14th century may have reduced the world&#39;s population from an estimated 450 million in 1340 to between 350 and 375 million in 1400;[23] it took 200 years for population figures to recover.[24] The population of China decreased from 123 million in 1200 to 65 million in 1393,[25] presumably due to a combination of Mongol invasions, famine, and plague.[26]&quot;</code></pre>
<p>Get some other types of HTML obejects. Let’s get all the “h2” HTML elements:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;h2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</code></pre></div>
<pre><code>##  [1] &quot;Contents&quot;                       &quot;Population by region&quot;          
##  [3] &quot;History&quot;                        &quot;Global demographics&quot;           
##  [5] &quot;Largest populations by country&quot; &quot;Fluctuation&quot;                   
##  [7] &quot;Mathematical approximations&quot;    &quot;Overpopulation&quot;                
##  [9] &quot;See also&quot;                       &quot;Notes&quot;                         
## [11] &quot;References&quot;                     &quot;External links&quot;                
## [13] &quot;Navigation menu&quot;</code></pre>
<p>What about tables ?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>
tables &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;table&quot;</span>) 
tables</code></pre></div>
<pre><code>## {xml_nodeset (23)}
##  [1] &lt;table class=&quot;plainlinks metadata ambox ambox-content&quot; role=&quot;presen ...
##  [2] &lt;table class=&quot;infobox&quot; style=&quot;float: right; font-size:90%&quot;&gt;&lt;tbody&gt;\ ...
##  [3] &lt;table class=&quot;wikitable sortable&quot;&gt;\n&lt;caption&gt;Population by continen ...
##  [4] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:center; float:right; cle ...
##  [5] &lt;table width=&quot;100%&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\n&lt;td valign=&quot;top&quot;&gt; &lt;div class=&quot;lege ...
##  [6] &lt;table class=&quot;wikitable sortable&quot; style=&quot;text-align:left&quot;&gt;&lt;tbody&gt;\n ...
##  [7] &lt;table class=&quot;wikitable sortable&quot; style=&quot;text-align:right&quot;&gt;\n&lt;capti ...
##  [8] &lt;table class=&quot;wikitable sortable&quot; style=&quot;text-align:right&quot;&gt;\n&lt;capti ...
##  [9] &lt;table class=&quot;wikitable sortable&quot; style=&quot;font-size:97%; text-align: ...
## [10] &lt;table class=&quot;wikitable sortable&quot; style=&quot;font-size:97%; text-align: ...
## [11] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:right;&quot;&gt;&lt;tbody&gt;\n&lt;tr&gt;\n&lt; ...
## [12] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:center; margin:1em; floa ...
## [13] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:right; font-size:96%;&quot;&gt;\ ...
## [14] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:center;&quot;&gt;\n&lt;caption&gt;Star ...
## [15] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:center;&quot;&gt;\n&lt;caption&gt;Star ...
## [16] &lt;table role=&quot;presentation&quot; class=&quot;mbox-small plainlinks sistersiteb ...
## [17] &lt;table class=&quot;nowraplinks collapsible autocollapse navbox-inner&quot; st ...
## [18] &lt;table class=&quot;nowraplinks collapsible collapsed navbox-inner&quot; style ...
## [19] &lt;table class=&quot;nowraplinks hlist collapsible autocollapse navbox-inn ...
## [20] &lt;table class=&quot;nowraplinks hlist collapsible autocollapse navbox-inn ...
## ...</code></pre>
</div>
<div id="example-parsing-a-table-from-wikipedia-1" class="section level2">
<h2><span class="header-section-number">7.6</span> Example: Parsing A Table From Wikipedia</h2>
<p>Look at the <a href="https://en.wikipedia.org/wiki/World_population">Wikipedia Page</a> for world population:</p>
<p><a href="https://en.wikipedia.org/wiki/World_population" class="uri">https://en.wikipedia.org/wiki/World_population</a></p>
<ul>
<li>We can get any table we want using rvest</li>
<li>We might have to experiment to figure out which one</li>
<li>Get the one that lists the ten most populous countries</li>
<li>I think this might be the 4th or 5th table on the page</li>
<li>How do we get this ?</li>
</ul>
<div class="figure">
<img src="PICS/worldpop.png" width="450" />

</div>
<p>First we will load packages that will help us throughout this session.</p>
<p>In this case we’ll need to figure out what number table it is we want. We could fetch all the tables and then experiment to find the precise one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)

<span class="co"># Use read_html to fetch the webpage</span>
url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>
ten_most_df &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) 
  
ten_most_populous &lt;-<span class="st"> </span>ten_most_df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()

<span class="co"># Let&#39;s get just the first three columns</span>
ten_most_populous &lt;-<span class="st"> </span>ten_most_populous[,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>]

<span class="co"># Get some content - Change the column names</span>
<span class="kw">names</span>(ten_most_populous) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Country_Territory&quot;</span>,<span class="st">&quot;Population&quot;</span>,<span class="st">&quot;Date&quot;</span>)

<span class="co"># Do reformatting on the columns to be actual numerics where appropriate</span>
ten_most_populous <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Population=</span><span class="kw">gsub</span>(<span class="st">&quot;,&quot;</span>,<span class="st">&quot;&quot;</span>,Population)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Population=</span><span class="kw">round</span>(<span class="kw">as.numeric</span>(Population)<span class="op">/</span><span class="fl">1e+06</span>))  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Country_Territory,<span class="dt">y=</span>Population)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Population / 1,000,000&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Top 10 Most Populous Countries&quot;</span>)</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<p>In the above example we leveraged the fact that we were looking specifically for a table element and it became a project to locate the correct table number. This isn’t always the case with more complicated websites in that the element we are trying to grab or scrape is contained within a nested structure that doesn’t correspond neatly to a paragraph, link, heading, or table. This can be the case if the page is heavily styled with CSS or Javascript. We might have to work harder. But it’s okay to try to use simple elements and then try to refine the search some more.</p>
</div>
<div id="summary-1" class="section level2">
<h2><span class="header-section-number">7.7</span> Summary</h2>
<ul>
<li>Need some basic HTML and CSS knowledge to find correct elements</li>
<li>How to extract text from common elements</li>
<li>How to extract text from specific elements</li>
<li>Always have to do some text cleanup of data</li>
<li>It usually takes multiple times to get it right</li>
</ul>
<p>See <a href="http://bradleyboehmke.github.io/2015/12/scraping-html-text.html" class="uri">http://bradleyboehmke.github.io/2015/12/scraping-html-text.html</a></p>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="xml" class="section level1">
<h1><span class="header-section-number">8</span> XML and JSON</h1>
<p>This is where things get a little dicey because some web pages will return XML and JSON in response to inquiries and while these formats seem complicated they are actually doing you a really big favor by doing this since these formats can ususally be easily parsed using various packges. XML is a bit hard to get your head around and JSON is the new kid on the block which is easier to use.</p>
<p>Since this isn’t a full-on course lecture I’ll keep it short as to how and why you would want to use these but any time you spend trying to better understand JSON (and XML) the better of you will be when parsing web pages. It’s not such a big deal if all you are going to be parsing is raw text since the mthods we use to do that avoid XML and JSON although cleaning up raw text has its own problems. Let’s revisit the Wikipedia example from the previous section.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)

<span class="co"># Use read_html to fetch the webpage</span>
url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>
ten_most_df &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) 
  
ten_most_populous &lt;-<span class="st"> </span>ten_most_df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()</code></pre></div>
<div class="figure">
<img src="PICS/xml.png" width="650" />

</div>
<div class="figure">
<img src="PICS/xmls.png" width="450" />

</div>
<p>Let’s look at an XML file that has some basic content:  </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;</span>?xml version=<span class="st">&quot;1.0&quot;</span> encoding=<span class="st">&quot;UTF-8&quot;</span>?<span class="op">&gt;</span>
<span class="er">&lt;</span>bookstore<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;COOKING&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Everyday Italian<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>Giada De Laurentiis<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2005</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">30.00</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;CHILDREN&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Harry Potter<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>J K. Rowling<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2005</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">29.99</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;WEB&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Learning XML<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>Erik T. Ray<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2003</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">39.95</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="er">&lt;/</span>bookstore<span class="op">&gt;</span></code></pre></div>
<p>Well we pulled out all tables and then, by experimentation, we isolated table 6 and got the content corresponding to that. But. Is there a more direct way to find the content ? There is. It requires us to install some helper plugins such as the xPath Finder for Firefox and Chrome. In reality there are a number of ways to find the XML Path or CSS Path for an element within a web page but this is a good one to start.</p>
<div class="figure">
<img src="PICS/xpath_finder.png" width="350" />

</div>
<p>Remeber that we want to find the table corresponding to the “10 Most Populous Countries”. So we activate the <em>xPath</em> finder plugin and the highlight the element of interest. This takes some practice to get it right. Once you highlight the desired elment you will see the corresponding XPATH. Here is a screenshot of what I did. We can use the resulting path to directly access the table without first having to first pull out all tables and then trying to find the right one</p>
<div class="figure">
<img src="PICS/xpath_pop.png" width="350" />

</div>
<p> </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use read_html to fetch the webpage</span>
url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>
ten_most_populous &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) 

ten_most_df &lt;-<span class="st"> </span>ten_most_populous <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="dt">xpath=</span><span class="st">&#39;/html/body/div[3]/div[3]/div[4]/div/table[5]&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_table</span>() 

<span class="co"># We have to get the first element of the list. </span>
ten_most_df &lt;-<span class="st"> </span>ten_most_df[[<span class="dv">1</span>]]

ten_most_df</code></pre></div>
<pre><code>##    Rank Country / Territory    Population              Date
## 1     1       China[note 4] 1,395,120,000 November 11, 2018
## 2     2               India 1,339,420,000 November 11, 2018
## 3     3       United States   328,156,000 November 11, 2018
## 4     4           Indonesia   265,015,300      July 1, 2018
## 5     5            Pakistan   212,742,631      May 25, 2017
## 6     6              Brazil   209,833,000 November 11, 2018
## 7     7             Nigeria   188,500,000  October 31, 2016
## 8     8          Bangladesh   165,514,000 November 11, 2018
## 9     9      Russia[note 5]   146,877,088   January 1, 2018
## 10   10               Japan   126,440,000   October 1, 2018
##    % of worldpopulation Source
## 1                 18.2%   [82]
## 2                 17.5%   [83]
## 3                 4.28%   [84]
## 4                 3.46%   [85]
## 5                 2.78%   [86]
## 6                 2.74%   [87]
## 7                 2.46%   [88]
## 8                 2.16%   [89]
## 9                 1.92%   [90]
## 10                1.65%   [91]</code></pre>
<div id="finding-xpaths-1" class="section level2">
<h2><span class="header-section-number">8.1</span> Finding XPaths</h2>
<div class="figure">
<img src="PICS/xml_path_1.png" width="650" />

</div>
<p> </p>
<p>In addition to Browser Plugins there are standalone tools such as the Oxygen XML Editor which is availabel through the Emory Software Express Website. This is a comprehensive XML editor that will allow you to parse XML and develop paths to locate specific nodes within an XML document. If you find yourself working with websites with lots of XML then this will be useful. The Oxygen editor is free.</p>
<div class="figure">
<img src="PICS/xml_path_10.png" width="350" />

</div>
<p>Let’s look at an XML file that has some basic content:  </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;</span>?xml version=<span class="st">&quot;1.0&quot;</span> encoding=<span class="st">&quot;UTF-8&quot;</span>?<span class="op">&gt;</span>
<span class="er">&lt;</span>bookstore<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;COOKING&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Everyday Italian<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>Giada De Laurentiis<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2005</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">30.00</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;CHILDREN&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Harry Potter<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>J K. Rowling<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2005</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">29.99</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;WEB&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Learning XML<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>Erik T. Ray<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2003</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">39.95</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="er">&lt;/</span>bookstore<span class="op">&gt;</span></code></pre></div>
<div class="figure">
<img src="PICS/xml_path_2.png" width="650" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/xml_path_3.png" width="550" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/xml_path_4.png" width="550" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/xml_path_4.png" width="550" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/xml_path_6.png" width="550" />

</div>
<div class="figure">
<img src="PICS/xml_path_7.png" width="550" />

</div>
<div class="figure">
<img src="PICS/xml_path_8.png" width="550" />

</div>
<div class="figure">
<img src="PICS/xml_path_9.png" width="550" />

</div>
</div>
<div id="example-geocoding-with-google-1" class="section level2">
<h2><span class="header-section-number">8.2</span> Example: GeoCoding With Google</h2>
<p>Let’s run through an example of using the GeoCoding API with Google. They used to provide free access to this service and they still do although you are limited to a certain number. You have to sign up for an account and get an API key. Anyway, let’s run through this example and then look at how I parsed the XML file that is returned by the Google GeoCoding API. Let’s say that we wanted to get the latitude and longitude associated with the the address <em>1510 Clifton Rd, Atlanta, GA</em> which corresponds to the Rollins Research Building.</p>
<p>First we will see an example of what Google returns in terms of XML. We can use some tools like Oxygen Editor (available free via Emory Software Express) to develop an appropriate XPATH expression to parse out the latitude and longitude information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># https://maps.googleapis.com/maps/api/geocode/xml?address=1510+Clifton+Road,+Atlanta,+GA&amp;key=AIzaSyAbhVdPH0wDVWUayUaj5N4r379Fbkq5NBM</span>

<span class="co"># https://maps.googleapis.com/maps/api/geocode/json?address=1510+Clifton+Road,+Atlanta,+GA&amp;key=AIzaSyAbhVdPH0wDVWUayUaj5N4r379Fbkq5NBM</span>

myGeo &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">address=</span><span class="st">&quot;1510 Clifton Rd Atlanta GA&quot;</span>,<span class="dt">form=</span><span class="st">&quot;xml&quot;</span>) {
  <span class="kw">library</span>(XML)
  <span class="kw">library</span>(RCurl)
  
  geourl &lt;-<span class="st"> &quot;https://maps.googleapis.com/maps/api/geocode/&quot;</span>
  key &lt;-<span class="st"> &quot;AIzaSyAbhVdPH0wDVWUayUaj5N4r379Fbkq5NBM&quot;</span>
  address &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot; &quot;</span>,<span class="st">&quot;+&quot;</span>,address)
  
  add &lt;-<span class="st"> </span><span class="kw">paste0</span>(geourl,form,<span class="dt">sep=</span><span class="st">&quot;?address=&quot;</span>)
  add &lt;-<span class="st"> </span><span class="kw">paste0</span>(add,address,<span class="st">&quot;&amp;key=&quot;</span>)
  geourl &lt;-<span class="st"> </span><span class="kw">paste0</span>(add,key)
  
  locale &lt;-<span class="st"> </span><span class="kw">getURL</span>(geourl)
  plocal &lt;-<span class="st"> </span><span class="kw">xmlParse</span>(locale,<span class="dt">useInternalNodes=</span><span class="ot">TRUE</span>)
  
  <span class="co"># Okay let&#39;s extract the lat and lon</span>
  latlon &lt;-<span class="st"> </span><span class="kw">getNodeSet</span>(plocal,<span class="st">&quot;/GeocodeResponse/result/geometry/location/descendant::*&quot;</span>)
  lat  &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">xmlSApply</span>(latlon,xmlValue))[<span class="dv">1</span>]
  lon  &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">xmlSApply</span>(latlon,xmlValue))[<span class="dv">2</span>]
  
  <span class="kw">return</span>(<span class="kw">c</span>(<span class="dt">lat=</span>lat,<span class="dt">lng=</span>lon))  
}

<span class="kw">myGeo</span>()</code></pre></div>
<pre><code>##       lat       lng 
##  33.79667 -84.32319</code></pre>
<p>  Now. We could have saved the report to a file on our local computer and open it up with Oxygen editor and figure out what the approproate XPATH would be. This is basically what I did. Here is a screenshot of the session:</p>
<div class="figure">
<img src="PICS/oxygen2.png" width="650" />

</div>
<p>  We could expand this considerable to process a number of addresses:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">namevec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Atlanta GA&quot;</span>, 
             <span class="st">&quot;Birmingham AL&quot;</span>, 
             <span class="st">&quot;Seattle WA&quot;</span>, 
             <span class="st">&quot;Sacramento CA&quot;</span>,
             <span class="st">&quot;Denver CO&quot;</span>, 
             <span class="st">&quot;LosAngeles CA&quot;</span>, 
             <span class="st">&quot;Rochester NY&quot;</span>)

cityList &lt;-<span class="st"> </span><span class="kw">lapply</span>(namevec,myGeo)

<span class="co"># Or to get a data frame</span>

cities &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">city=</span>namevec,<span class="kw">do.call</span>(rbind,cityList),
                     <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
cities</code></pre></div>
<pre><code>##            city      lat        lng
## 1    Atlanta GA 33.74900  -84.38798
## 2 Birmingham AL 33.51859  -86.81036
## 3    Seattle WA 47.60621 -122.33207
## 4 Sacramento CA 38.58157 -121.49440
## 5     Denver CO 39.73924 -104.99025
## 6 LosAngeles CA 34.05223 -118.24368
## 7  Rochester NY 43.15658  -77.60885</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Let&#39;s create a Map</span>

<span class="kw">library</span>(leaflet)
m &lt;-<span class="st"> </span><span class="kw">leaflet</span>(<span class="dt">data=</span>cities)
m &lt;-<span class="st"> </span><span class="kw">addTiles</span>(m)
m &lt;-<span class="st"> </span><span class="kw">addMarkers</span>(m,<span class="dt">popup=</span>cities<span class="op">$</span>city)

<span class="co"># Put up the Map - click on the markers</span>
m</code></pre></div>
<div id="htmlwidget-5eefe2f3a81051b5ea1d" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-5eefe2f3a81051b5ea1d">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[[33.7489954,33.5185892,47.6062095,38.5815719,39.7392358,34.0522342,43.1565779],[-84.3879824,-86.8103567,-122.3320708,-121.4943996,-104.990251,-118.2436849,-77.6088465],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Atlanta GA","Birmingham AL","Seattle WA","Sacramento CA","Denver CO","LosAngeles CA","Rochester NY"],null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[33.5185892,47.6062095],"lng":[-122.3320708,-77.6088465]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="using-json-1" class="section level2">
<h2><span class="header-section-number">8.3</span> Using JSON</h2>
<p>JSON is fast becoming the primary interchange format over XML although XML is still well supported. R has a number of packages to ease the parsing of JSON/ documents returned by web pages. Ususally you get back a <em>list</em> which is a native data type in R that can easily be manipulated into a data frame. Most web APIs provide an option for JSON or XML although some only provide JSON.</p>
<div class="figure">
<img src="PICS/json.png" width="650" />

</div>
<p>There are rules and regulations about how JSON is formed and we will learn them by example but you can look at the numerous tutotorials on the web to locate definitive references. See <a href="http://www.w3schools.com/json/" class="uri">http://www.w3schools.com/json/</a> Here is an XML file that describes some employees.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;</span>employees<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;</span>employee<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>firstName<span class="op">&gt;</span>John<span class="op">&lt;</span><span class="er">/</span>firstName<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>lastName<span class="op">&gt;</span>Doe<span class="op">&lt;</span><span class="er">/</span>lastName<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;/</span>employee<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;</span>employee<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>firstName<span class="op">&gt;</span>Anna<span class="op">&lt;</span><span class="er">/</span>firstName<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>lastName<span class="op">&gt;</span>Smith<span class="op">&lt;</span><span class="er">/</span>lastName<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;/</span>employee<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;</span>employee<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>firstName<span class="op">&gt;</span>Peter<span class="op">&lt;</span><span class="er">/</span>firstName<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>lastName<span class="op">&gt;</span>Jones<span class="op">&lt;</span><span class="er">/</span>lastName<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;/</span>employee<span class="op">&gt;</span>
<span class="st"> </span><span class="er">&lt;/</span>employees<span class="op">&gt;</span></code></pre></div>
<p>And here is the corresposning JSON file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">{
  <span class="st">&quot;employees&quot;</span><span class="op">:</span>[
    {<span class="st">&quot;firstName&quot;</span><span class="op">:</span><span class="st">&quot;John&quot;</span>, <span class="st">&quot;lastName&quot;</span><span class="op">:</span><span class="st">&quot;Doe&quot;</span>},
    {<span class="st">&quot;firstName&quot;</span><span class="op">:</span><span class="st">&quot;Anna&quot;</span>, <span class="st">&quot;lastName&quot;</span><span class="op">:</span><span class="st">&quot;Smith&quot;</span>},
    {<span class="st">&quot;firstName&quot;</span><span class="op">:</span><span class="st">&quot;Peter&quot;</span>,<span class="st">&quot;lastName&quot;</span><span class="op">:</span><span class="st">&quot;Jones&quot;</span>}
] }</code></pre></div>
<ul>
<li><p>It is important to note that the actual information in the document, things like city name, county name, latitude, and longitude are the same as they would be in the comparable XML document.</p></li>
<li><p>JSON documents are at the heart of the NoSQL“database”called MongoDB</p></li>
<li><p>JSON can be found within many webpages since it is closely related to JavaScript which is a language strongly related to web pages.</p></li>
<li><p>JSON is very compact and lighweight which has made it a natural followon to XML so much so that it appears to be replacing XML</p></li>
</ul>
<p>See http:..www.json.org/ for a full description of the specification</p>
<ul>
<li><p>An object is an unordered set of name/value pairs. An object begins with (left brace) and ends with (right brace). Each name is followed by : (colon) and the name/value pairs are separated by , (comma).</p></li>
<li><p>An array is an ordered collection of values. An array begins with [ (left bracket) and ends with ] (right bracket). Values are separated by , (comma).</p></li>
<li><p>A value can be a string in double quotes, or a number, or true or false or null, or an object or an array. These structures can be nested.</p></li>
<li><p>A string is a sequence of zero or more Unicode characters, wrapped in double quotes, using backslash escapes. A character is represented as a single character string.</p></li>
</ul>
<p>Do you remember the Google Geocding example from before ? We can tell Google to send us back JSON instead of XML just by adjusting the URL accordingly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://maps.googleapis.com/maps/api/geocode/json?address=1510+Clifton+Rd+Atlanta+GA&amp;key=AIzaSyAbhVdPH0wDVWUayUaj5N4r379Fbkq5NBM&quot;</span></code></pre></div>
<div class="figure">
<img src="PICS/json_google.png" width="650" />

</div>
</div>
<div id="using-the-rjsonio-package-1" class="section level2">
<h2><span class="header-section-number">8.4</span> Using the RJSONIO Package</h2>
<p>To read/parse this in R we use a package called RJSONIO. There are other packages but this is the one we will be using. Download and install it.</p>
<p>There is a function called fromJSON which will parse the JSON file and return a list to contain the data.</p>
<p>So we parse lists instead of using XPath. Many people feel this to be easier than trying to construct XPath statments. You will have to decide for yourself.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RJSONIO)

url &lt;-<span class="st"> &quot;https://maps.googleapis.com/maps/api/geocode/json?address=1510+Clifton+Road,+Atlanta,+GA&amp;key=AIzaSyAbhVdPH0wDVWUayUaj5N4r379Fbkq5NBM&quot;</span>
geo &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(url)
<span class="kw">str</span>(geo,<span class="dv">3</span>)</code></pre></div>
<pre><code>## List of 2
##  $ results:List of 1
##   ..$ :List of 6
##   .. ..$ address_components:List of 7
##   .. ..$ formatted_address : chr &quot;1510 Clifton Rd, Atlanta, GA 30322, USA&quot;
##   .. ..$ geometry          :List of 3
##   .. ..$ place_id          : chr &quot;ChIJ5QjdF_oG9YgRWAJzCm19Vf8&quot;
##   .. ..$ plus_code         : Named chr [1:2] &quot;QMWG+MP Druid Hills, Georgia, United States&quot; &quot;865QQMWG+MP&quot;
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;compound_code&quot; &quot;global_code&quot;
##   .. ..$ types             : chr &quot;street_address&quot;
##  $ status : chr &quot;OK&quot;</code></pre>
<p>Since what we get back is a list we can directly access whatever we want. We just index into the list. No need for complicated XPATHS.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">geo<span class="op">$</span>results[[<span class="dv">1</span>]]<span class="op">$</span>geometry<span class="op">$</span>location</code></pre></div>
<pre><code>##       lat       lng 
##  33.79667 -84.32319</code></pre>
<!--chapter:end:01-xmljson.Rmd-->
</div>
</div>
<div id="Moreexamples" class="section level1">
<h1><span class="header-section-number">9</span> More Real Life Examples</h1>
<p>Okay. This is a tour of some sites that will serve as important examples on how to parse sites. Let’s check the price of bitcoins. You want to be rich don’t you ?</p>
<div id="bitcoin-prices-1" class="section level2">
<h2><span class="header-section-number">9.1</span> BitCoin Prices</h2>
<div class="figure">
<img src="PICS/crypto.png" width="650" />

</div>
<div class="figure">
<img src="PICS/view_source.png" width="750" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)
url &lt;-<span class="st"> &quot;https://coinmarketcap.com/all/views/all/&quot;</span>
bc &lt;-<span class="st"> </span><span class="kw">read_html</span>(url)

path &lt;-<span class="st"> &#39;//*[@id=&quot;currencies-all&quot;]&#39;</span>
 bc_table &lt;-<span class="st"> </span>bc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="dt">xpath=</span>path) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()
 <span class="co"># We get back a one element list that is a data frame</span>
 <span class="kw">str</span>(bc_table,<span class="dv">0</span>)</code></pre></div>
<pre><code>## List of 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> bc_table &lt;-<span class="st"> </span>bc_table[[<span class="dv">1</span>]]
 <span class="kw">head</span>(bc_table[,<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>])</code></pre></div>
<pre><code>##   Symbol       Market Cap     Price
## 1    BTC $110,506,260,873  $6360.77
## 2    ETH  $21,565,430,142   $209.04
## 3    XRP  $20,738,359,893 $0.515809
## 4    BCH   $9,007,279,340   $516.03
## 5    XLM   $5,065,544,817 $0.267523
## 6    EOS   $4,877,744,763     $5.38</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The data is &quot;dirty&quot; and has characers in it that need cleaning</span>
bc_table &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Name,Symbol,Price)
bc_table &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Name=</span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,<span class="st">&quot; &quot;</span>,Name))
bc_table &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Name=</span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.+&quot;</span>,<span class="st">&quot;&quot;</span>,Name))
bc_table &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Price=</span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">$&quot;</span>,<span class="st">&quot;&quot;</span>,Price))
bc_table &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Price=</span><span class="kw">round</span>(<span class="kw">as.numeric</span>(Price),<span class="dv">2</span>))</code></pre></div>
<pre><code>## Warning in evalq(round(as.numeric(Price), 2), &lt;environment&gt;): NAs
## introduced by coercion</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># There are four rows wherein the Price is missing NA</span>
bc_table &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">complete.cases</span>(bc_table))

<span class="co"># Let&#39;s get the Crypto currencies with the Top 10 highest prices </span>
top_<span class="dv">10</span> &lt;-<span class="st"> </span>bc_table <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Price)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>)

<span class="co"># Next we want to make a barplot of the Top 10</span>
ylim=<span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">max</span>(top_<span class="dv">10</span><span class="op">$</span>Price)<span class="op">+</span><span class="dv">10000</span>)
main=<span class="st">&quot;Top 10 Crypto Currencies in Terms of Price&quot;</span>
bp &lt;-<span class="st"> </span><span class="kw">barplot</span>(top_<span class="dv">10</span><span class="op">$</span>Price,<span class="dt">col=</span><span class="st">&quot;aquamarine&quot;</span>,
              <span class="dt">ylim=</span>ylim,<span class="dt">main=</span>main)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span>bp, <span class="dt">labels=</span>top_<span class="dv">10</span><span class="op">$</span>Symbol,  <span class="dt">cex.axis =</span> <span class="fl">0.7</span>)
<span class="kw">grid</span>()</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Let&#39;s take the log of the price</span>
ylim=<span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">max</span>(<span class="kw">log</span>(top_<span class="dv">10</span><span class="op">$</span>Price))<span class="op">+</span><span class="dv">5</span>)
main=<span class="st">&quot;Top 10 Crypto Currencies in Terms of log(Price)&quot;</span>
bp &lt;-<span class="st"> </span><span class="kw">barplot</span>(<span class="kw">log</span>(top_<span class="dv">10</span><span class="op">$</span>Price),<span class="dt">col=</span><span class="st">&quot;aquamarine&quot;</span>,
              <span class="dt">ylim=</span>ylim,<span class="dt">main=</span>main)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span>bp, <span class="dt">labels=</span>top_<span class="dv">10</span><span class="op">$</span>Symbol,  <span class="dt">cex.axis =</span> <span class="fl">0.7</span>)
<span class="kw">grid</span>()</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-81-2.png" width="672" /></p>
</div>
<div id="faculty-salaries-1" class="section level2">
<h2><span class="header-section-number">9.2</span> Faculty Salaries</h2>
<p>In this example we have to parse the main table associated with the results page.</p>
<div class="figure">
<img src="PICS/salary.png" alt="Salary" />
<p class="caption">Salary</p>
</div>
<div class="figure">
<img src="PICS/sal_page.png" alt="Salary" />
<p class="caption">Salary</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://www.insidehighered.com/aaup-compensation-survey&quot;</span>
df &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>() <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">1</span>)
intost &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Institution&quot;</span>,<span class="st">&quot;Category&quot;</span>,<span class="st">&quot;State&quot;</span>)
salary &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(InstitutionCategoryState,<span class="dt">into=</span>intost,<span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>) 
salary</code></pre></div>
<pre><code>##                            Institution      Category   State
## 1                    Auburn University      Doctoral ALABAMA
## 2          Birmingham Southern College Baccalaureate ALABAMA
## 3                   Huntingdon College Baccalaureate ALABAMA
## 4                   Samford University        Master ALABAMA
## 5                      Troy University        Master ALABAMA
## 6            The University of Alabama      Doctoral ALABAMA
## 7  University of Alabama at Birmingham      Doctoral ALABAMA
## 8  University of Alabama in Huntsville      Doctoral ALABAMA
## 9             University of Montevallo        Master ALABAMA
## 10         University of South Alabama        Master ALABAMA
##    Avg. SalaryFull Professors Avg. ChangeContinuing Full Professors
## 1                    $126,900                                  3.7%
## 2                     $80,400                                  0.3%
## 3                     $76,700                                  0.0%
## 4                    $104,500                                  1.4%
## 5                     $84,500                                  1.6%
## 6                    $148,100                                  2.0%
## 7                    $135,100                                  1.9%
## 8                    $131,000                                  2.4%
## 9                     $79,800                                  0.0%
## 10                    $89,100                                   N/A
##    CountFull Professors Avg. Total CompensationFull Professors
## 1                   411                               $181,600
## 2                    38                               $102,800
## 3                    13                                $89,500
## 4                   117                               $141,300
## 5                    30                                $88,500
## 6                   300                               $202,400
## 7                   191                               $178,800
## 8                    62                               $177,700
## 9                    44                                      -
## 10                  111                                $97,100
##    Salary EquityFull Professors
## 1                          88.8
## 2                          95.5
## 3                         109.6
## 4                          84.3
## 5                         105.7
## 6                          86.7
## 7                          89.4
## 8                          92.0
## 9                          93.4
## 10                         97.6</code></pre>
<p>So we could process multiple pages</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># So now we could process multiple pages</span>

url &lt;-<span class="st"> &#39;https://www.insidehighered.com/aaup-compensation-survey?institution-name=&amp;professor-category=1591&amp;page=1&#39;</span>
str1 &lt;-<span class="st"> &quot;https://www.insidehighered.com/aaup-compensation-survey?&quot;</span>
str2 &lt;-<span class="st"> &quot;institution-name=&amp;professor-category=1591&amp;page=&quot;</span>
intost &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Institution&quot;</span>,<span class="st">&quot;Category&quot;</span>,<span class="st">&quot;State&quot;</span>)

salary &lt;-<span class="st"> </span><span class="kw">data.frame</span>()
<span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) {
  nurl  &lt;-<span class="st"> </span><span class="kw">paste</span>(str1,str2,ii,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
  df &lt;-<span class="st"> </span><span class="kw">read_html</span>(nurl)
  tmp &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>() <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">1</span>)
  tmp &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(InstitutionCategoryState,<span class="dt">into=</span>intost,<span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>) 
  salary &lt;-<span class="st"> </span><span class="kw">rbind</span>(salary,tmp)
}

salary</code></pre></div>
<p>Look at the URLs at the bottom of the main page to find beginning and ending page numbers. Visually this is easy. Programmatically we could do something like the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># https://www.insidehighered.com/aaup-compensation-survey?page=1</span>
<span class="co"># https://www.insidehighered.com/aaup-compensation-survey?page=94</span>

<span class="co"># What is the last page number ? We already know the answer - 94</span>

lastnum &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="dt">xpath=</span><span class="st">&#39;//a&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>) <span class="op">%&gt;%</span><span class="st"> &#39;[&#39;</span>(<span class="dv">103</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">strsplit</span>(.,<span class="st">&quot;page=&quot;</span>) <span class="op">%&gt;%</span><span class="st"> &#39;[[&#39;</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> &#39;[&#39;</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>(.)

<span class="co"># So now we could get all pages of the survey</span>

str1 &lt;-<span class="st"> &quot;https://www.insidehighered.com/aaup-compensation-survey?&quot;</span>
str2 &lt;-<span class="st"> &quot;institution-name=&amp;professor-category=1591&amp;page=&quot;</span>
intost &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Institution&quot;</span>,<span class="st">&quot;Category&quot;</span>,<span class="st">&quot;State&quot;</span>)

salary &lt;-<span class="st"> </span><span class="kw">data.frame</span>()

<span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>lastnum) {
  nurl  &lt;-<span class="st"> </span><span class="kw">paste</span>(str1,str2,ii,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
  df &lt;-<span class="st"> </span><span class="kw">read_html</span>(nurl)
  tmp &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>() <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">1</span>)
  tmp &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(InstitutionCategoryState,<span class="dt">into=</span>intost,<span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>) 
  salary &lt;-<span class="st"> </span><span class="kw">rbind</span>(salary,tmp)
  <span class="kw">Sys.sleep</span>(<span class="dv">1</span>)
}
<span class="kw">names</span>(salary) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Institution&quot;</span>,<span class="st">&quot;Category&quot;</span>,<span class="st">&quot;State&quot;</span>,<span class="st">&quot;AvgSalFP&quot;</span>,<span class="st">&quot;AvgChgFP&quot;</span>,
                   <span class="st">&quot;CntFP&quot;</span>,<span class="st">&quot;AvgTotCompFP&quot;</span>,<span class="st">&quot;SalEquityFP&quot;</span>)

salary &lt;-<span class="st"> </span>salary <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">AvgSalFP=</span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">$|,&quot;</span>,<span class="st">&quot;&quot;</span>,salary<span class="op">$</span>AvgSalFP))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">AvgTotCompFP=</span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">$|,&quot;</span>,<span class="st">&quot;&quot;</span>,salary<span class="op">$</span>AvgTotCompFP)))

salary <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(State,Category) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg=</span><span class="kw">mean</span>(AvgSalFP)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(avg))</code></pre></div>
<p>There are some problems:</p>
<ul>
<li>Data is large and scattered across multiple pages</li>
<li>We could use above techniques to move from page to page</li>
<li>There is a form we could use to narrow criteria</li>
<li>But we have to programmatically submit the form</li>
<li>rvest (and other packages) let you do this</li>
</ul>
</div>
<div id="filling-out-forms-from-a-program-1" class="section level2">
<h2><span class="header-section-number">9.3</span> Filling Out Forms From a Program</h2>
<div class="figure">
<img src="PICS/salary_form.png" alt="Salary" width="250" />
<p class="caption">Salary</p>
</div>
<p>Let’s find salaries between $ 150,000 and the default max ($ 244,000)</p>
<ul>
<li>Find the element name associated with “Average Salary”</li>
<li>Establish a connection with the form (usually the url of the page)</li>
<li>Get a local copy of the form</li>
<li>Fill in the value for the “Average Salary”</li>
<li>Submit the lled in form</li>
<li>Get the results and parse them like above `</li>
</ul>
<p>So finding the correct element is more challenging. I use Chrome to do this. Just highlight the area over the form and right click to “Insepct” the element. This opens up the developer tools. You have to dig down to find the corrext form and the element name. Here is a screen shot of my activity:</p>
<div class="figure">
<img src="PICS/form.png" alt="Salary" width="550" />
<p class="caption">Salary</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://www.insidehighered.com/aaup-compensation-survey&quot;</span>

<span class="co"># Establish a session</span>
mysess &lt;-<span class="st"> </span><span class="kw">html_session</span>(url)

<span class="co"># Get the form</span>

form_unfilled &lt;-<span class="st"> </span>mysess <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_node</span>(<span class="st">&quot;form&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_form</span>()
form_filled   &lt;-<span class="st"> </span>form_unfilled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">set_values</span>(<span class="st">&quot;range-from&quot;</span>=<span class="dv">150000</span>)

<span class="co"># Submit form</span>

results &lt;-<span class="st"> </span><span class="kw">submit_form</span>(mysess,form_filled)</code></pre></div>
<pre><code>## Submitting with &#39;op&#39;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">first_page &lt;-<span class="st"> </span>results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="dt">xpath=</span>expr) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()

first_page</code></pre></div>
<pre><code>## [[1]]
##                                                     InstitutionCategoryState
## 1                          Ohio State University-Main Campus\nDoctoral\nOHIO
## 2             University of Illinois at Urbana-Champaign\nDoctoral\nILLINOIS
## 3  University of Colorado Denver/Anschutz Medical Campus\nDoctoral\nCOLORADO
## 4                                     University of Houston\nDoctoral\nTEXAS
## 5                              Amherst College\nBaccalaureate\nMASSACHUSETTS
## 6                 University of California-Merced\nBaccalaureate\nCALIFORNIA
## 7                      University of Illinois at Chicago\nDoctoral\nILLINOIS
## 8                             Wake Forest University\nMaster\nNORTH CAROLINA
## 9                       Rensselaer Polytechnic Institute\nDoctoral\nNEW YORK
## 10                              Brandeis University\nDoctoral\nMASSACHUSETTS
##    Avg. SalaryFull Professors Avg. ChangeContinuing Full Professors
## 1                    $150,000                                  2.7%
## 2                    $150,500                                  4.1%
## 3                    $150,800                                  2.2%
## 4                    $150,900                                  0.9%
## 5                    $151,000                                  2.8%
## 6                    $151,100                                   N/A
## 7                    $151,100                                  4.1%
## 8                    $151,700                                  3.2%
## 9                    $151,800                                  3.3%
## 10                   $151,900                                  3.5%
##    CountFull Professors Avg. Total CompensationFull Professors
## 1                   994                               $195,700
## 2                   833                               $190,600
## 3                   179                               $207,200
## 4                   427                               $183,300
## 5                    85                               $196,700
## 6                    55                               $204,500
## 7                   346                               $194,000
## 8                   194                               $191,000
## 9                   199                               $204,000
## 10                  150                               $194,300
##    Salary EquityFull Professors
## 1                          89.6
## 2                          91.4
## 3                          93.1
## 4                          85.8
## 5                          92.3
## 6                          88.9
## 7                          94.4
## 8                          85.4
## 9                          98.6
## 10                         96.6</code></pre>
</div>
<div id="pubmed-1" class="section level2">
<h2><span class="header-section-number">9.4</span> PubMed</h2>
<p>Pubmed provides a rich source of information on published scientific literature. There are tutorials on how to leverage its capabilities but one thing to consider is that MESH terms are a good starting place since the search is index-based. MeSH (Medical Subject Headings) is the NLM controlled vocabulary thesaurus used for indexing articles for PubMed. It’s faster and more accurate so you can first use the MESH browser to generate the appropriate search terms and add that into the Search interface. The MESH browser can be found at <a href="https://www.ncbi.nlm.nih.gov/mesh/" class="uri">https://www.ncbi.nlm.nih.gov/mesh/</a></p>
<div class="figure">
<img src="PICS/pubmed1.png" width="550" />

</div>
<div class="figure">
<img src="PICS/mesh.png" width="550" />

</div>
<p>What we do here is get the links associated with each publication so we can then process each of those and get the abstract associated with each publication.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># &quot;hemodialysis, home&quot; [MeSH Terms] </span>

url &lt;-<span class="st"> &quot;https://www.ncbi.nlm.nih.gov/pubmed/?term=%22hemodialysis%2C+home%22+%5BMeSH+Terms%5D&quot;</span>

<span class="co"># </span>

results &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grep</span>(<span class="st">&quot;/pubmed/[0-9]{1,6}&quot;</span>,.,<span class="dt">value=</span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>(.)

results</code></pre></div>
<pre><code>##  [1] &quot;/pubmed/30212930&quot; &quot;/pubmed/29656667&quot; &quot;/pubmed/29272506&quot;
##  [4] &quot;/pubmed/29148012&quot; &quot;/pubmed/29122999&quot; &quot;/pubmed/29122220&quot;
##  [7] &quot;/pubmed/28978613&quot; &quot;/pubmed/28963833&quot; &quot;/pubmed/28835369&quot;
## [10] &quot;/pubmed/28710094&quot; &quot;/pubmed/28679363&quot; &quot;/pubmed/28651528&quot;
## [13] &quot;/pubmed/28614637&quot; &quot;/pubmed/28597060&quot; &quot;/pubmed/28546368&quot;
## [16] &quot;/pubmed/28535526&quot; &quot;/pubmed/28495360&quot; &quot;/pubmed/28490435&quot;
## [19] &quot;/pubmed/28485119&quot; &quot;/pubmed/28448966&quot;</code></pre>
<div class="figure">
<img src="PICS/pubmed_results.png" width="550" />

</div>
<p>So now we could loop through these links and get the abstracts for these results. It looks that there are approximately 10 results per page. As before we would have to dive in to the underlying structure of the page to get the correct XML pathnames or we could look for Paragraph elements and pick out the links that way.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text.vec &lt;-<span class="st"> </span><span class="kw">vector</span>()

<span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(results)) {
  string &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;https://www.ncbi.nlm.nih.gov&quot;</span>,results[ii])
  text.vec[ii] &lt;-<span class="st"> </span><span class="kw">read_html</span>(string) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&quot;p&quot;</span>) <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()
}

<span class="co"># Eliminate lines with newlines characters</span>

final.vec &lt;-<span class="st"> </span>text.vec[<span class="kw">grep</span>(<span class="st">&quot;^</span><span class="ch">\n</span><span class="st">&quot;</span>,text.vec,<span class="dt">invert=</span><span class="ot">TRUE</span>)]

final.vec</code></pre></div>
<pre><code>##  [1] &quot;End-stage renal disease (ESRD) is the final stage of chronic kidney disease in which the kidney is not sufficient to meet the needs of daily life. It is necessary to understand the role of genes expression involved in ESRD patient responses to nocturnal hemodialysis (NHD) and to improve the immunity responsiveness. The aim of this study was to investigate novel immune-associated genes that may play important roles in patients with ESRD.The microarray expression profiles of peripheral blood in patients with ESRD before and after NHD were analyzed by network-based approaches, and then using Gene Ontology (GO) and Kyoto Encyclopedia of Genes and Genomes pathway analysis to explore the biological process and molecular functions of differentially expressed genes. Subsequently, a transcriptional regulatory network of the core genes and the connected transcriptional regulators was constructed. We found that NHD had a significant effect on neutrophil activation and immune response in patients with ESRD.In addition, Our findings suggest that MAPKAPK3, RHOA, ARRB2, FLOT1, MYH9, PRKCD, RHOG, PTPN6, MAPK3, CNPY3, PI3KCG, and PYGL genes maybe potential targets regulated by core transcriptional factors, including ARNT, C/EBPalpha, CEBPA, CREB1, PSG1, DAND5, SP1, GATA1, MYC, EGR2, and EGR3.&quot;                                                                                                                                                                                                                                                                                                                  
##  [2] &quot;Only a minority of patients with chronic kidney disease treated by hemodialysis are currently treated at home. Until relatively recently, the only type of hemodialysis machine available for these patients was a slightly smaller version of the standard machines used for in-center dialysis treatments. Areas covered: There are now an alternative generation of dialysis machines specifically designed for home hemodialysis. The home dialysis patient wants a smaller machine, which is intuitive to use, easy to trouble shoot, robust and reliable, quick to setup and put away, requiring minimal waste disposal. The machines designed for home dialysis have some similarities in terms of touch-screen patient interfaces, and using pre-prepared cartridges to speed up setting up the machine. On the other hand, they differ in terms of whether they use slower or standard dialysate flows, prepare batches of dialysis fluid, require separate water purification equipment, or whether this is integrated, or use pre-prepared sterile bags of dialysis fluid. Expert commentary: Dialysis machine complexity is one of the hurdles reducing the number of patients opting for home hemodialysis and the introduction of the newer generation of dialysis machines designed for ease of use will hopefully increase the number of patients opting for home hemodialysis.&quot;                                                                                                                                                                                                                                                                   
##  [3] &quot;Home haemodialysis (HHD) has the potential to impact positively on patient outcomes and health resource management. There has been rejuvenated international interest in HHD in recent years.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
##  [4] &quot;Assess the feasibility of using a bovine carotid artery graft for buttonhole technique hemodialysis in patients who are not candidates for a native fistula.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
##  [5] &quot;renal system; urology; vascular surgery&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
##  [6] &quot;NxStage System One is a new dialytic technology based on easy setup, simplicity of use and reduced dimensions, which is increasingly in use worldwide for home hemodialysis treatments. The system utilizes a low amount of dialysate, usually 15-30 liters according to anthropometric patients&#39; values. The dialysate is supplied at very low flux, generally about 1/3 of blood flow, in order to obtain an elevated saturation of dialysate for solutes. In these conditions the clearance of urea will be almost equal to dialysate flow rate. In order to achieve an obptimal weekly clearance evaluated by Std Kt/V the dialysis sessions are repeated six times a week. In this way a good control of blood voleme can be reached. In this paper we report our experience of treatment with NxStage System One in 12 patients from May 2011 to Dicember 2016.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
##  [7] &quot;Data on racial disparities in home dialysis utilization and outcomes are lacking in Canada, where health care is universally available.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
##  [8] &quot;Telehealth and remote monitoring of a patient&#39;s health status has become more commonplace in the last decade and has been applied to conditions such as heart failure, diabetes mellitus, hypertension, and chronic obstructive pulmonary disease. Conversely, uptake of these technologies to help engender and support home RRTs has lagged. Although studies have looked at the role of telehealth in RRT, they are small and single-centered, and both outcome and cost-effectiveness data are needed to inform future decision making. Furthermore, alignment of payer and government (federal and state) regulations with telehealth procedures is needed along with a better understanding of the viewpoints of the various stakeholders in this process (patients, caregivers, clinicians, payers, dialysis organizations, and government regulators). Despite these barriers, telehealth has great potential to increase the acceptance of home dialysis, and improve outcomes and patient satisfaction while potentially decreasing costs. The Kidney Health Initiative convened a multidisciplinary workgroup to examine the current state of telehealth use in home RRTs as well as outline potential benefits and drawbacks, impediments to implementation, and key unanswered questions.&quot;                                                                                                                                                                                                                                                                                                                                                            
##  [9] &quot;Patients starting dialysis often have substantial residual kidney function. Incremental hemodialysis provides a hemodialysis prescription that supplements patients&#39; residual kidney function while maintaining total (residual + dialysis) urea clearance (standard Kt/Vurea) targets. We describe our experience with incremental hemodialysis in patients using NxStage System One for home hemodialysis.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
## [10] &quot;Internationally, the use of patient-reported outcomes (PROs) is increasing. Electronic PROs (ePROs) offer immediate access of such reports to healthcare providers. The objectives of this study were to assess nurses&#39; perspectives on the usefulness and impact of ePRO administration in home dialysis clinics and assess patient perceptions of satisfaction with nursing care following use of ePROs.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
## [11] &quot;The Lancashire Teaching Hospitals NHS Trust in the UK has been providing renal care through video-as-a-service (VAAS) to patients since 2013, with support from the North West NHS Shared Infrastructure Service, a collaborative team that supports information and communication technology use in the UK National Health Service.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
## [12] &quot;Neonatal autosomal recessive polycystic kidney disease (ARPKD) is associated with giant kidneys, lung hypoplasia, pulmonal hypertension, and end-stage renal failure. Depending on the study, mortality is reported to range between 20 and 80%.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
## [13] &quot;Improvement in the rates of home dialysis has been a desirable but difficult-to-achieve target for United States nephrology. Provision of comprehensive predialysis education (CPE) in institutes with established home dialysis programs has been shown to facilitate a higher home dialysis choice amongst chronic kidney disease (CKD) patients. Unfortunately, limited data have shown the efficacy of such programs in the United States or in institutes with small home dialysis (HoD) programs.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
## [14] &quot;Home hemodialysis (HD) is undergoing a resurgence. A major driver of this is economics, however, providers are also encouraged by a combination of excellent patient outcomes and patient experiences as well as the development of newer technologies that offer ease of use. Home HD offers significant advantages in flexible scheduling and the practical implementation of extended hours dialysis. This paper explores the reasons why home HD is making a comeback and strives to offer approaches to improve the uptake of this dialysis modality.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
## [15] &quot;Bone deformities and fractures are common consequences of renal osteodystrophy in the dialysis population. Persistent hypophosphatemia may be observed with more frequent home hemodialysis regimens, but the specific effects on the skeleton are unknown. We present a patient with end-stage renal disease treated with frequent home hemodialysis who developed severe bone pain and multiple fractures, including a hip fracture and a tibia-fibula fracture complicated by nonunion, rendering her nonambulatory and wheelchair bound for more than a year. A bone biopsy revealed severe osteomalacia, likely secondary to chronic hypophosphatemia and hypocalcemia. Treatment changes included the addition of phosphate to the dialysate, a higher dialysate calcium concentration, and increased calcitriol dose. Several months later, the patient no longer required a wheelchair and was able to ambulate without pain. Repeat bone biopsy revealed marked improvements in bone mineralization and turnover parameters. Also, with increased dialysate phosphate and calcium concentrations, as well as increased calcitriol, circulating fibroblast growth factor 23 levels increased.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
## [16] &quot;The ESRD Prospective Payment System introduced two incentives to increase home dialysis use: bundling injectable medications into a single payment for treatment and paying for home dialysis training. We evaluated the effects of the ESRD Prospective Payment System on home dialysis use by patients starting dialysis in the United States from January 1, 2006 to August 31, 2013. We analyzed data on dialysis modality, insurance type, and comorbidities from the United States Renal Data System. We estimated the effect of the policy on home dialysis use with multivariable logistic regression and compared the effect on Medicare Parts A/B beneficiaries with the effect on patients with other types of insurance. The ESRD Prospective Payment System associated with a 5.0% (95% confidence interval [95% CI], 4.0% to 6.0%) increase in home dialysis use by the end of the study period. Home dialysis use increased by 5.8% (95% CI, 4.3% to 6.9%) among Medicare beneficiaries and 4.1% (95% CI, 2.3% to 5.4%) among patients covered by other forms of health insurance. The difference between these groups was not statistically significant (1.8%; 95% CI, -0.2% to 3.8%). Conversely, in both populations, the training add-on did not associate with increases in home dialysis use beyond the effect of the policy. The ESRD Prospective Payment System bundling, but not the training add-on, associated with substantial increases in home dialysis, which were identical for both Medicare and non-Medicare patients. These spill-over effects suggest that major payment changes in Medicare can affect all patients with ESRD.&quot;
## [17] &quot;We present a case of a patient on home hemodialysis who developed Mycobacterium mucogenicum bacteremia. While infections with this particular organism are rare, disseminated infections have been reported and have been associated with significant morbidity and mortality. Diagnosis required appropriate cultures, understanding of natural habitat of organism and complete environmental analysis including blood, dialysis sample port, reverse osmosis and incoming water supply cultures. The patient was treated successfully with systemic antibiotics, removal of central venous catheter, patient education and complete exchange of the hemodialysis circuit.&quot;</code></pre>
<p>Well that was a lot of work and it’s very tedious. And we processed only the first page of results. How do we “progrmmatically” hit the “Next” Button at the bottom of the page ? This is complicated by the fact that there appears to be some Javascript at work that we would have to somehow interact with to get the URL for the next page. Unlike with the school salary example it isn’t obvious how to do this. If we hove over the “Next” button we don’t get an associated link.</p>
<!--chapter:end:02-moreexamples.Rmd-->
</div>
</div>
<div id="APIs" class="section level1">
<h1><span class="header-section-number">10</span> APIs</h1>
<div id="omdb-1" class="section level2">
<h2><span class="header-section-number">10.1</span> OMDB</h2>
<p>Let’s look at the IMDB page whic catalogues lots of information about movies. Just got to the web site and search although here is an example link. <a href="https://www.imdb.com/title/tt0076786/?ref_=fn_al_tt_2" class="uri">https://www.imdb.com/title/tt0076786/?ref_=fn_al_tt_2</a> In this case we would like to get the summary information for the movie. So we would use Selector Gadget or some other method to find the XPATH or CSS associated with this element.</p>
<div class="figure">
<img src="PICS/suspiria_77.png" width="450" />

</div>
<p>This pretty easy and doesn’t present much of a problem although for large scale mining of movie data we would run into trouble because IMDB doesn’t really like you to scrape their pages. They have an API that they would like for you to use.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &#39;https://www.imdb.com/title/tt0076786/?ref_=fn_al_tt_2&#39;</span>
summary &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;.summary_text&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_text</span>()</code></pre></div>
<p>But here we go again. We have to parse the desired elements on this page and then what if we wanted to follow other links or set up a general function to search IMDB for other movies of various genres, titles, directors, etc.</p>
<div class="figure">
<img src="PICS/omdb.png" width="550" />

</div>
<div class="figure">
<img src="PICS/omdb_api.png" width="450" />

</div>
<div class="figure">
<img src="PICS/omdb_instruc.png" width="450" />

</div>
<hr />
<p>So as an example on how this works. Paste the URL into any web browser. You must supply your key for this to work. What you get back is a JSON formatted entry corresponding to ”The GodFather”movie.</p>
<hr />
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;http://www.omdbapi.com/?apikey=f7c004c&amp;t=The+Godfather&quot;</span></code></pre></div>
<div class="figure">
<img src="PICS/omdb_result.png" width="650" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RJSONIO)

url &lt;-<span class="st"> &quot;http://www.omdbapi.com/?apikey=f7c004c&amp;t=The+Godfather&quot;</span>

<span class="co"># Fetch the URL via fromJSON</span>
movie &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(<span class="st">&quot;http://www.omdbapi.com/?apikey=f7c004c&amp;t=The+Godfather&quot;</span>)

<span class="co"># We get back a list which is much easier to process than raw JSON or XML</span>
<span class="kw">str</span>(movie)</code></pre></div>
<pre><code>## List of 25
##  $ Title     : chr &quot;The Godfather&quot;
##  $ Year      : chr &quot;1972&quot;
##  $ Rated     : chr &quot;R&quot;
##  $ Released  : chr &quot;24 Mar 1972&quot;
##  $ Runtime   : chr &quot;175 min&quot;
##  $ Genre     : chr &quot;Crime, Drama&quot;
##  $ Director  : chr &quot;Francis Ford Coppola&quot;
##  $ Writer    : chr &quot;Mario Puzo (screenplay by), Francis Ford Coppola (screenplay by), Mario Puzo (based on the novel by)&quot;
##  $ Actors    : chr &quot;Marlon Brando, Al Pacino, James Caan, Richard S. Castellano&quot;
##  $ Plot      : chr &quot;The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.&quot;
##  $ Language  : chr &quot;English, Italian, Latin&quot;
##  $ Country   : chr &quot;USA&quot;
##  $ Awards    : chr &quot;Won 3 Oscars. Another 24 wins &amp; 28 nominations.&quot;
##  $ Poster    : chr &quot;https://m.media-amazon.com/images/M/MV5BM2MyNjYxNmUtYTAwNi00MTYxLWJmNWYtYzZlODY3ZTk3OTFlXkEyXkFqcGdeQXVyNzkwMjQ&quot;| __truncated__
##  $ Ratings   :List of 3
##   ..$ : Named chr [1:2] &quot;Internet Movie Database&quot; &quot;9.2/10&quot;
##   .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Source&quot; &quot;Value&quot;
##   ..$ : Named chr [1:2] &quot;Rotten Tomatoes&quot; &quot;98%&quot;
##   .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Source&quot; &quot;Value&quot;
##   ..$ : Named chr [1:2] &quot;Metacritic&quot; &quot;100/100&quot;
##   .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Source&quot; &quot;Value&quot;
##  $ Metascore : chr &quot;100&quot;
##  $ imdbRating: chr &quot;9.2&quot;
##  $ imdbVotes : chr &quot;1,378,375&quot;
##  $ imdbID    : chr &quot;tt0068646&quot;
##  $ Type      : chr &quot;movie&quot;
##  $ DVD       : chr &quot;09 Oct 2001&quot;
##  $ BoxOffice : chr &quot;N/A&quot;
##  $ Production: chr &quot;Paramount Pictures&quot;
##  $ Website   : chr &quot;http://www.thegodfather.com&quot;
##  $ Response  : chr &quot;True&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movie<span class="op">$</span>Plot</code></pre></div>
<pre><code>## [1] &quot;The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(movie<span class="op">$</span>Ratings,unlist)</code></pre></div>
<pre><code>##        [,1]                      [,2]              [,3]        
## Source &quot;Internet Movie Database&quot; &quot;Rotten Tomatoes&quot; &quot;Metacritic&quot;
## Value  &quot;9.2/10&quot;                  &quot;98%&quot;             &quot;100/100&quot;</code></pre>
<p>Let’s Get all the Episodes for Season 1 of Game of Thrones</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;http://www.omdbapi.com/?apikey=f7c004c&amp;t=Game%20of%20Thrones&amp;Season=1&quot;</span>
movie &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(url)
<span class="kw">str</span>(movie,<span class="dv">1</span>)</code></pre></div>
<pre><code>## List of 5
##  $ Title       : chr &quot;Game of Thrones&quot;
##  $ Season      : chr &quot;1&quot;
##  $ totalSeasons: chr &quot;8&quot;
##  $ Episodes    :List of 10
##  $ Response    : chr &quot;True&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">episodes &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">do.call</span>(rbind,movie<span class="op">$</span>Episodes),<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
episodes</code></pre></div>
<pre><code>##                                    Title   Released Episode imdbRating
## 1                       Winter Is Coming 2011-04-17       1        9.0
## 2                          The Kingsroad 2011-04-24       2        8.8
## 3                              Lord Snow 2011-05-01       3        8.7
## 4  Cripples, Bastards, and Broken Things 2011-05-08       4        8.8
## 5                  The Wolf and the Lion 2011-05-15       5        9.1
## 6                         A Golden Crown 2011-05-22       6        9.2
## 7                     You Win or You Die 2011-05-29       7        9.3
## 8                         The Pointy End 2011-06-05       8        9.1
## 9                                 Baelor 2011-06-12       9        9.6
## 10                        Fire and Blood 2011-06-19      10        9.5
##       imdbID
## 1  tt1480055
## 2  tt1668746
## 3  tt1829962
## 4  tt1829963
## 5  tt1829964
## 6  tt1837862
## 7  tt1837863
## 8  tt1837864
## 9  tt1851398
## 10 tt1851397</code></pre>
</div>
<div id="the-omdbapi-package-1" class="section level2">
<h2><span class="header-section-number">10.2</span> The omdbapi package</h2>
<p>Wait a minute. Looks like someone created an R package that wraps all this for us. It is called omdbapi</p>
<div class="figure">
<img src="PICS/omdbapi.png" width="650" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use devtools to install</span>
devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;hrbrmstr/omdbapi&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(omdbapi)
<span class="co"># The first time you use this you will be prompted to enter your</span>
 <span class="co"># API key</span>
movie_df &lt;-<span class="st"> </span><span class="kw">search_by_title</span>(<span class="st">&quot;Star Wars&quot;</span>, <span class="dt">page =</span> <span class="dv">2</span>)
(movie_df &lt;-<span class="st"> </span>movie_df[,<span class="op">-</span><span class="dv">5</span>])</code></pre></div>
<pre><code>##                                     Title      Year    imdbID   Type
## 1               Star Wars: The Clone Wars      2008 tt1185834  movie
## 2               Star Wars: The Clone Wars 2008–2019 tt0458290 series
## 3                        Star Wars Rebels 2014–2018 tt2930604 series
## 4                   Star Wars: Clone Wars 2003–2005 tt0361243 series
## 5           The Star Wars Holiday Special      1978 tt0193524  movie
## 6                Robot Chicken: Star Wars      2007 tt1020990  movie
## 7  Star Wars: Knights of the Old Republic      2003 tt0356070   game
## 8          Star Wars: The Force Unleashed      2008 tt1024923   game
## 9               Star Wars: Battlefront II      2005 tt0483168   game
## 10    Robot Chicken: Star Wars Episode II      2008 tt1334272  movie</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get lots of info on The GodFather</span>

(gf &lt;-<span class="st"> </span><span class="kw">find_by_title</span>(<span class="st">&quot;The GodFather&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 3 x 25
##   Title Year  Rated Released   Runtime Genre Director Writer Actors Plot 
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;
## 1 The … 1972  R     1972-03-24 175 min Crim… Francis… Mario… Marlo… The …
## 2 The … 1972  R     1972-03-24 175 min Crim… Francis… Mario… Marlo… The …
## 3 The … 1972  R     1972-03-24 175 min Crim… Francis… Mario… Marlo… The …
## # ... with 15 more variables: Language &lt;chr&gt;, Country &lt;chr&gt;, Awards &lt;chr&gt;,
## #   Poster &lt;chr&gt;, Ratings &lt;list&gt;, Metascore &lt;chr&gt;, imdbRating &lt;dbl&gt;,
## #   imdbVotes &lt;dbl&gt;, imdbID &lt;chr&gt;, Type &lt;chr&gt;, DVD &lt;date&gt;,
## #   BoxOffice &lt;chr&gt;, Production &lt;chr&gt;, Website &lt;chr&gt;, Response &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get the actors from the GodFather</span>
<span class="kw">get_actors</span>((gf))</code></pre></div>
<pre><code>## [1] &quot;Marlon Brando&quot;         &quot;Al Pacino&quot;             &quot;James Caan&quot;           
## [4] &quot;Richard S. Castellano&quot;</code></pre>
<div class="figure">
<img src="PICS/api_summary.png" width="550" />

</div>
</div>
<div id="rselenium-1" class="section level2">
<h2><span class="header-section-number">10.3</span> RSelenium</h2>
<p>Sometimes we interact with websites that use Javascript to load more text or comments in a user forum. Here is an example of that. Look at <a href="https://www.dailystrength.org/group/dialysis" class="uri">https://www.dailystrength.org/group/dialysis</a> which is a website associated with people wanting to share information about dialysis.</p>
<div class="figure">
<img src="PICS/diasupport.png" />

</div>
<p>If you check the bottom of the pag you will see a button.</p>
<div class="figure">
<img src="PICS/showmore.png" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># https://www.dailystrength.org/group/dialysis</span>

<span class="kw">library</span>(RSelenium)
<span class="kw">library</span>(rvest)
<span class="kw">library</span>(tm)
<span class="kw">library</span>(SentimentAnalysis)
<span class="kw">library</span>(wordcloud)

url &lt;-<span class="st"> &quot;https://www.dailystrength.org/group/dialysis&quot;</span>

<span class="co"># The website has a &quot;show more&quot; button that hides most of the patient posts</span>
<span class="co"># If we don&#39;t find a way to programmatically &quot;click&quot; this button then we can</span>
<span class="co"># only get a few of the posts and their responses. To do this we need to</span>
<span class="co"># use the RSelenium package which does a lot of behind the scenes work</span>

<span class="co"># See https://cran.r-project.org/web/packages/RSelenium/RSelenium.pdf</span>
<span class="co"># http://brazenly.blogspot.com/2016/05/r-advanced-web-scraping-dynamic.html</span>

<span class="co"># Open up a connection </span>

rD &lt;-<span class="st"> </span><span class="kw">rsDriver</span>()
remDr &lt;-<span class="st"> </span>rD[[<span class="st">&quot;client&quot;</span>]]
remDr<span class="op">$</span><span class="kw">navigate</span>(url)

loadmorebutton &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">findElement</span>(<span class="dt">using =</span> <span class="st">&#39;css selector&#39;</span>, <span class="st">&quot;#load-more-discussions&quot;</span>)

<span class="co"># Do this a number of times to get more links</span>

loadmorebutton<span class="op">$</span><span class="kw">clickElement</span>()

<span class="co"># Now get the page with more comments and questions</span>

page_source &lt;-<span class="st"> </span>remDr<span class="op">$</span><span class="kw">getPageSource</span>()

<span class="co"># So let&#39;s parse the contents</span>

comments &lt;-<span class="st"> </span><span class="kw">read_html</span>(page_source[[<span class="dv">1</span>]])

cumulative_comments &lt;-<span class="st"> </span><span class="kw">vector</span>()

links &lt;-<span class="st"> </span>comments <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="dt">css=</span><span class="st">&quot;.newsfeed__description&quot;</span>)  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_node</span>(<span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)

full_links &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;https://www.dailystrength.org&quot;</span>,links)

<span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">grep</span>(<span class="st">&quot;NA&quot;</span>,full_links)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
  full_links &lt;-<span class="st"> </span>full_links[<span class="op">-</span><span class="kw">grep</span>(<span class="st">&quot;NA&quot;</span>,full_links)]
}

ugly_xpath &lt;-<span class="st"> &#39;//*[contains(concat( &quot; &quot;, @class, &quot; &quot; ), concat( &quot; &quot;, &quot;comments__comment-text&quot;, &quot; &quot; ))] | //p&#39;</span>

<span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(full_links)) {
  text &lt;-<span class="st"> </span><span class="kw">read_html</span>(full_links[ii]) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">html_nodes</span>(<span class="dt">xpath=</span>ugly_xpath) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">html_text</span>() 
  <span class="kw">length</span>(text) &lt;-<span class="st"> </span><span class="kw">length</span>(text) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
  text &lt;-<span class="st"> </span>text[<span class="op">-</span><span class="dv">1</span>]
  
  text
  
  cumulative_comments &lt;-<span class="st"> </span><span class="kw">c</span>(cumulative_comments,text)
}

remDr<span class="op">$</span><span class="kw">close</span>()
<span class="co"># stop the selenium server</span>
rD[[<span class="st">&quot;server&quot;</span>]]<span class="op">$</span><span class="kw">stop</span>()</code></pre></div>
</div>
<div id="easypubmed-1" class="section level2">
<h2><span class="header-section-number">10.4</span> EasyPubMed</h2>
<p>So there is an R package called <em>EasyPubMed</em> that helps ease the access of data on the Internet. The idea behind this package is to be able to query NCBI Entrez and retrieve PubMed records in XML or TXT format. The PubMed records can be downloaded and saved as XML or text files if desired. According to the package authours, “Data integrity is enforced during data download, allowing to retrieve and save very large number of records effortlessly”. The bottom line is that you can do what you want after that. Let’s look at an example involving home hemodialysis</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(easyPubMed)</code></pre></div>
<p>Let’s do some searching</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_query &lt;-<span class="st"> &#39;hemodialysis, home&quot; [MeSH Terms]&#39;</span>
my_entrez_id &lt;-<span class="st"> </span><span class="kw">get_pubmed_ids</span>(my_query)
my_abstracts_txt &lt;-<span class="st"> </span><span class="kw">fetch_pubmed_data</span>(my_entrez_id, <span class="dt">format =</span> <span class="st">&quot;abstract&quot;</span>)
my_abstracts_txt[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>]</code></pre></div>
<pre><code>##  [1] &quot;&quot;                                                                                  
##  [2] &quot;1. Medicine (Baltimore). 2018 Sep;97(37):e12018. doi: 10.1097/MD.0000000000012018.&quot;
##  [3] &quot;&quot;                                                                                  
##  [4] &quot;Gene co-expression network analysis identifies the hub genes associated with&quot;      
##  [5] &quot;immune functions for nocturnal hemodialysis in patients with end-stage renal&quot;      
##  [6] &quot;disease.&quot;                                                                          
##  [7] &quot;&quot;                                                                                  
##  [8] &quot;Dai H, Zhou J, Zhu B.&quot;                                                             
##  [9] &quot;&quot;                                                                                  
## [10] &quot;End-stage renal disease (ESRD) is the final stage of chronic kidney disease in&quot;    
## [11] &quot;which the kidney is not sufficient to meet the needs of daily life. It is&quot;         
## [12] &quot;necessary to understand the role of genes expression involved in ESRD patient&quot;     
## [13] &quot;responses to nocturnal hemodialysis (NHD) and to improve the immunity&quot;             
## [14] &quot;responsiveness. The aim of this study was to investigate novel immune-associated &quot; 
## [15] &quot;genes that may play important roles in patients with ESRD.The microarray&quot;          
## [16] &quot;expression profiles of peripheral blood in patients with ESRD before and after&quot;    
## [17] &quot;NHD were analyzed by network-based approaches, and then using Gene Ontology (GO) &quot; 
## [18] &quot;and Kyoto Encyclopedia of Genes and Genomes pathway analysis to explore the&quot;       
## [19] &quot;biological process and molecular functions of differentially expressed genes.&quot;     
## [20] &quot;Subsequently, a transcriptional regulatory network of the core genes and the&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_abstracts_xml &lt;-<span class="st"> </span><span class="kw">fetch_pubmed_data</span>(my_entrez_id)</code></pre></div>
<p>Well the results aren’t bad but we still have to parse out some junk but nothing like before. It’s a minor problem. In this case the API gives us some XML back that we then have to parse.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_abstracts &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">xpathApply</span>(my_abstracts_xml, <span class="st">&quot;//AbstractText&quot;</span>, saveXML))

<span class="co"># Still have to clear out some junk in each abstract</span>

my_abstracts &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;&lt;(.*)&quot;&gt;&#39;</span>,<span class="st">&quot;&quot;</span>,my_abstracts)
my_abstracts &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;&lt;AbstractText&gt;|&lt;/AbstractText&gt;&#39;</span>,<span class="st">&quot;&quot;</span>,my_abstracts)

<span class="kw">length</span>(my_abstracts)</code></pre></div>
<pre><code>## [1] 935</code></pre>
<p>But we have around 935 abstracts that we can now mess with. The benefit of this approach is that we dont’ have to do all the text conversions and manipulations that we would have with the manual approach. Plus, we are able to get a lot more results more conveniently.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_abstracts[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</code></pre></div>
<pre><code>## [1] &quot;End-stage renal disease (ESRD) is the final stage of chronic kidney disease in which the kidney is not sufficient to meet the needs of daily life. It is necessary to understand the role of genes expression involved in ESRD patient responses to nocturnal hemodialysis (NHD) and to improve the immunity responsiveness. The aim of this study was to investigate novel immune-associated genes that may play important roles in patients with ESRD.The microarray expression profiles of peripheral blood in patients with ESRD before and after NHD were analyzed by network-based approaches, and then using Gene Ontology (GO) and Kyoto Encyclopedia of Genes and Genomes pathway analysis to explore the biological process and molecular functions of differentially expressed genes. Subsequently, a transcriptional regulatory network of the core genes and the connected transcriptional regulators was constructed. We found that NHD had a significant effect on neutrophil activation and immune response in patients with ESRD.In addition, Our findings suggest that MAPKAPK3, RHOA, ARRB2, FLOT1, MYH9, PRKCD, RHOG, PTPN6, MAPK3, CNPY3, PI3KCG, and PYGL genes maybe potential targets regulated by core transcriptional factors, including ARNT, C/EBPalpha, CEBPA, CREB1, PSG1, DAND5, SP1, GATA1, MYC, EGR2, and EGR3.&quot;                                               
## [2] &quot;Only a minority of patients with chronic kidney disease treated by hemodialysis are currently treated at home. Until relatively recently, the only type of hemodialysis machine available for these patients was a slightly smaller version of the standard machines used for in-center dialysis treatments. Areas covered: There are now an alternative generation of dialysis machines specifically designed for home hemodialysis. The home dialysis patient wants a smaller machine, which is intuitive to use, easy to trouble shoot, robust and reliable, quick to setup and put away, requiring minimal waste disposal. The machines designed for home dialysis have some similarities in terms of touch-screen patient interfaces, and using pre-prepared cartridges to speed up setting up the machine. On the other hand, they differ in terms of whether they use slower or standard dialysate flows, prepare batches of dialysis fluid, require separate water purification equipment, or whether this is integrated, or use pre-prepared sterile bags of dialysis fluid. Expert commentary: Dialysis machine complexity is one of the hurdles reducing the number of patients opting for home hemodialysis and the introduction of the newer generation of dialysis machines designed for ease of use will hopefully increase the number of patients opting for home hemodialysis.&quot;
## [3] &quot;Home haemodialysis (HHD) has the potential to impact positively on patient outcomes and health resource management. There has been rejuvenated international interest in HHD in recent years.&quot;</code></pre>
<!--chapter:end:03-apis.Rmd-->
</div>
</div>
<div id="bagofwords" class="section level1">
<h1><span class="header-section-number">11</span> Bag of Words Sentiment Analysis</h1>
<p>One we have a collection of text it’s interesting to figure out what it might mean or infer - if anything at all. In text analysis and NLP (Natural Language Processing) we talk about “Bag of Words” to describe a collection or “corpus” of unstructured text. What do we do with a “bag of words” ?</p>
<ul>
<li>Extract meaning from collections of text (without reading !)</li>
<li>Detect and analyze patterns in unstructured textual collections</li>
<li>Use Natural Language Processing techniques to reach conclusions</li>
<li>Discover what ideas occur in text and how they might be linked</li>
<li>Determine if the discovered patterns be used to predict behavior ?</li>
<li>Identify interesting ideas that might otherwise be ignored</li>
</ul>
<div id="workflow-1" class="section level2">
<h2><span class="header-section-number">11.1</span> Workflow</h2>
<ul>
<li>Identify and Obtain text (e.g. websites, Twitter, Databases, PDFs, surveys)</li>
<li>Create a text ”Corpus”- a structure that contains the raw text</li>
<li>Apply transformations:
<ul>
<li>Normalize case (convert to lower case)</li>
<li>Remove puncutation and stopwords</li>
<li>Remove domain specific stopwords</li>
</ul></li>
<li>Perform Analysis and Visualizations (word frequency, tagging, wordclouds)</li>
<li>Do Sentiment Analysis</li>
</ul>
<p>R has Packages to Help. These are just some of them:</p>
<ul>
<li>QDAP - Quantitative Discourse Package</li>
<li>tm - text mining applications within R</li>
<li>tidytext - Text Mining using ddplyr and ggplot and tidyverse tools</li>
<li>SentimentAnalysis - For Sentiment Analysis</li>
</ul>
<p>However, consider that:</p>
<ul>
<li>Some of these are easier to use than others</li>
<li>Some can be kind of a problem to install (e.g. qdap)</li>
<li>They all offer similar capabilities</li>
<li>We’ll look at tidytext</li>
</ul>
</div>
<div id="simple-example-1" class="section level2">
<h2><span class="header-section-number">11.2</span> Simple Example</h2>
<div class="figure">
<img src="PICS/prez.png" width="650" />

</div>
<p>Find the URL for Lincoln’s March 4, 1865 Speech:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://millercenter.org/the-presidency/presidential-speeches/march-4-1865-second-inaugural-address&quot;</span>
<span class="kw">library</span>(rvest)
lincoln_doc &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) <span class="op">%&gt;%</span>
<span class="st">                    </span><span class="kw">html_nodes</span>(<span class="st">&quot;.view-transcript&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">                    </span><span class="kw">html_text</span>()
lincoln_doc</code></pre></div>
<pre><code>## [1] &quot;TranscriptFellow-Countrymen:  At this second appearing to take the oath of the Presidential office there is less occasion for an extended address than there was at the first. Then a statement somewhat in detail of a course to be pursued seemed fitting and proper. Now, at the expiration of four years, during which public declarations have been constantly called forth on every point and phase of the great contest which still absorbs the attention and engrosses the energies of the nation, little that is new could be presented. The progress of our arms, upon which all else chiefly depends, is as well known to the public as to myself, and it is, I trust, reasonably satisfactory and encouraging to all. With high hope for the future, no prediction in regard to it is ventured.On the occasion corresponding to this four years ago all thoughts were anxiously directed to an impending civil war. All dreaded it, all sought to avert it. While the inaugural address was being delivered from this place, devoted altogether to saving the Union without war, insurgent agents were in the city seeking to destroy it without war-seeking to dissolve the Union and divide effects by negotiation. Both parties deprecated war, but one of them would make war rather than let the nation survive, and the other would accept war rather than let it perish, and the war came.One-eighth of the whole population were colored slaves, not distributed generally over the Union. but localized in the southern part of it. These slaves constituted a peculiar and powerful interest. All knew that this interest was somehow the cause of the war. To strengthen, perpetuate, and extend this interest was the object for which the insurgents would rend the Union even by war, while the Government claimed no right to do more than to restrict the territorial enlargement of it. Neither party expected for the war the magnitude or the duration which it has already attained. Neither anticipated that the cause of the conflict might cease with or even before the conflict itself should cease. Each looked for an easier triumph, and a result less fundamental and astounding. Both read the same Bible and pray to the same God, and each invokes His aid against the other. It may seem strange that any men should dare to ask a just God&#39;s assistance in wringing their bread from the sweat of other men&#39;s faces, but let us judge not, that we be not judged. The prayers of both could not be answered. That of neither has been answered fully. The Almighty has His own purposes. \&quot;Woe unto the world because of offenses; for it must needs be that offenses come, but woe to that man by whom the offense cometh.\&quot; If we shall suppose that American slavery is one of those offenses which, in the providence of God, must needs come, but which, having continued through His appointed time, He now wills to remove, and that He gives to both North and South this terrible war as the woe due to those by whom the offense came, shall we discern therein any departure from those divine attributes which the believers in a living God always ascribe to Him? Fondly do we hope, fervently do we pray, that this mighty scourge of war may speedily pass away. Yet, if God wills that it continue until all the wealth piled by the bondsman&#39;s two hundred and fifty years of unrequited toil shall be sunk, and until every drop of blood drawn with the lash shall be paid by another drawn with the sword, as was said three thousand years ago, so still it must be said \&quot;the judgments of the Lord are true and righteous altogether.\&quot;With malice toward none, with charity for all, with firmness in the fight as God gives us to see the right, let us strive on to finish the work we are in, to bind up the nation&#39;s wounds, to care for him who shall have borne the battle and for his widow and his orphan, to do all which may achieve and cherish a just and lasting peace among ourselves and with all nations.&quot;</code></pre>
<p>There are probably lots of words that don’t really “matter” or contribute to the “real” meaning of the speech.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">word_vec &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(lincoln_doc,<span class="st">&quot; &quot;</span>))
word_vec[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>]</code></pre></div>
<pre><code>##  [1] &quot;TranscriptFellow-Countrymen:&quot; &quot;&quot;                            
##  [3] &quot;At&quot;                           &quot;this&quot;                        
##  [5] &quot;second&quot;                       &quot;appearing&quot;                   
##  [7] &quot;to&quot;                           &quot;take&quot;                        
##  [9] &quot;the&quot;                          &quot;oath&quot;                        
## [11] &quot;of&quot;                           &quot;the&quot;                         
## [13] &quot;Presidential&quot;                 &quot;office&quot;                      
## [15] &quot;there&quot;                        &quot;is&quot;                          
## [17] &quot;less&quot;                         &quot;occasion&quot;                    
## [19] &quot;for&quot;                          &quot;an&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sort</span>(<span class="kw">table</span>(word_vec),<span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</code></pre></div>
<pre><code>## word_vec
##  the   to  and   of that  for   be   in   it    a 
##   54   26   24   22   11    9    8    8    8    7</code></pre>
<p>How do we remove all the uninteresting words ? We could do it manaully</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Remove all punctuation marks</span>
word_vec &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>,<span class="st">&quot;&quot;</span>,word_vec)
stop_words &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;the&quot;</span>,<span class="st">&quot;to&quot;</span>,<span class="st">&quot;and&quot;</span>,<span class="st">&quot;of&quot;</span>,<span class="st">&quot;the&quot;</span>,<span class="st">&quot;for&quot;</span>,<span class="st">&quot;in&quot;</span>,<span class="st">&quot;it&quot;</span>,
                <span class="st">&quot;a&quot;</span>,<span class="st">&quot;this&quot;</span>,<span class="st">&quot;which&quot;</span>,<span class="st">&quot;by&quot;</span>,<span class="st">&quot;is&quot;</span>,<span class="st">&quot;an&quot;</span>,<span class="st">&quot;hqs&quot;</span>,<span class="st">&quot;from&quot;</span>,
                <span class="st">&quot;that&quot;</span>,<span class="st">&quot;with&quot;</span>,<span class="st">&quot;as&quot;</span>)
<span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(stop_words)) {
    <span class="cf">for</span> (jj <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(word_vec)) {
      <span class="cf">if</span> (stop_words[ii] <span class="op">==</span><span class="st"> </span>word_vec[jj]) {
          word_vec[jj] &lt;-<span class="st"> &quot;&quot;</span>
} }
}
word_vec &lt;-<span class="st"> </span>word_vec[word_vec <span class="op">!=</span><span class="st"> &quot;&quot;</span>]
<span class="kw">sort</span>(<span class="kw">table</span>(word_vec),<span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</code></pre></div>
<pre><code>## word_vec
##   war   all    be    we   but   God shall   was    do   let 
##    11     8     8     6     5     5     5     5     4     4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">word_vec[<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>]</code></pre></div>
<pre><code>##  [1] &quot;TranscriptFellowCountrymen&quot; &quot;At&quot;                        
##  [3] &quot;second&quot;                     &quot;appearing&quot;                 
##  [5] &quot;take&quot;                       &quot;oath&quot;                      
##  [7] &quot;Presidential&quot;               &quot;office&quot;                    
##  [9] &quot;there&quot;                      &quot;less&quot;                      
## [11] &quot;occasion&quot;                   &quot;extended&quot;                  
## [13] &quot;address&quot;                    &quot;than&quot;                      
## [15] &quot;there&quot;                      &quot;was&quot;                       
## [17] &quot;at&quot;                         &quot;first&quot;                     
## [19] &quot;Then&quot;                       &quot;statement&quot;                 
## [21] &quot;somewhat&quot;                   &quot;detail&quot;                    
## [23] &quot;course&quot;                     &quot;be&quot;                        
## [25] &quot;pursued&quot;                    &quot;seemed&quot;                    
## [27] &quot;fitting&quot;                    &quot;proper&quot;                    
## [29] &quot;Now&quot;                        &quot;at&quot;</code></pre>
</div>
<div id="tidytext-1" class="section level2">
<h2><span class="header-section-number">11.3</span> tidytext</h2>
<p>A better way would be to use the tidytext package. First we need to create a data frame out of the text. Then we “tokenize” the text which means we have one line per word.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidytext)

text_df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">line =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(lincoln_doc), <span class="dt">text =</span> lincoln_doc)
token_text &lt;-<span class="st"> </span>text_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_tokens</span>(word, text)

token_text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(word,<span class="dt">sort=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 339 x 2
##    word      n
##    &lt;chr&gt; &lt;int&gt;
##  1 the      58
##  2 to       27
##  3 and      24
##  4 of       22
##  5 it       13
##  6 that     12
##  7 war      12
##  8 all      10
##  9 for       9
## 10 in        9
## # ... with 329 more rows</code></pre>
<p>But we need to get rid of the “stop words”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now remove stop words</span>
<span class="kw">data</span>(stop_words)
tidy_text &lt;-<span class="st"> </span>token_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(stop_words)</code></pre></div>
<pre><code>## Joining, by = &quot;word&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This could also be done by the following. I point this out only because some people react</span>
<span class="co"># negatively to &quot;joins&quot; although fully understanding what joins are can only help you since</span>
<span class="co"># much of what the dplyr package does is based on SQL type joins. </span>

tidy_text &lt;-<span class="st"> </span>token_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>word <span class="op">%in%</span><span class="st"> </span>stop_words<span class="op">$</span>word)

tidy_text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(word,<span class="dt">sort=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 193 x 2
##    word           n
##    &lt;chr&gt;      &lt;int&gt;
##  1 war           12
##  2 god            5
##  3 union          4
##  4 offenses       3
##  5 woe            3
##  6 address        2
##  7 ago            2
##  8 altogether     2
##  9 answered       2
## 10 cease          2
## # ... with 183 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(word,<span class="dt">sort=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 193 x 2
##    word           n
##    &lt;chr&gt;      &lt;int&gt;
##  1 war           12
##  2 god            5
##  3 union          4
##  4 offenses       3
##  5 woe            3
##  6 address        2
##  7 ago            2
##  8 altogether     2
##  9 answered       2
## 10 cease          2
## # ... with 183 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">word =</span> <span class="kw">reorder</span>(word, n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(word, n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-105-1.png" width="672" /></p>
</div>
<div id="back-to-the-pubmed-example-1" class="section level2">
<h2><span class="header-section-number">11.4</span> Back To The PubMed Example</h2>
<p>We have around 935 abstracts that we can now mess with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a data frame out of the cleaned up abstracts</span>

text_df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">line =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(my_abstracts), <span class="dt">text =</span> my_abstracts)
token_text &lt;-<span class="st"> </span>text_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_tokens</span>(word, text)

<span class="co"># Many of these words aren&#39;t helpful </span>
token_text <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(<span class="dt">total=</span>word,<span class="dt">sort=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 6,942 x 2
##    total        n
##    &lt;chr&gt;    &lt;int&gt;
##  1 the       3087
##  2 of        2929
##  3 and       2880
##  4 in        1919
##  5 to        1863
##  6 a         1376
##  7 dialysis  1335
##  8 patients  1324
##  9 home      1236
## 10 with      1035
## # ... with 6,932 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now remove stop words</span>
<span class="kw">data</span>(stop_words)
tidy_text &lt;-<span class="st"> </span>token_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(stop_words)</code></pre></div>
<pre><code>## Joining, by = &quot;word&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This could also be done by the following. I point this out only because some people react</span>
<span class="co"># negatively to &quot;joins&quot; although fully understanding what joins are can only help you since</span>
<span class="co"># much of what the dplyr package does is based on SQL type joins. </span>

tidy_text &lt;-<span class="st"> </span>token_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>word <span class="op">%in%</span><span class="st"> </span>stop_words<span class="op">$</span>word)

<span class="co"># Arrange the text by descending word frequency </span>

tidy_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) </code></pre></div>
<pre><code>## # A tibble: 6,465 x 2
##    word             n
##    &lt;chr&gt;        &lt;int&gt;
##  1 dialysis      1335
##  2 patients      1324
##  3 home          1236
##  4 hemodialysis   665
##  5 hd             472
##  6 hhd            406
##  7 patient        380
##  8 pd             307
##  9 renal          277
## 10 study          270
## # ... with 6,455 more rows</code></pre>
<p>Some of the most frequently occurring words are in fact “dialysis”, “patients” so maybe we should consider them to be stop words also since we already know quite well that the overall theme is, well, dialysis and kidneys. There are also synonymns and abbreviations that are somewhat redundant such as “pdd”,“pd”,“hhd” so let’s eliminate them also.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_text &lt;-<span class="st"> </span>token_text <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">filter</span>(<span class="op">!</span>word <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(stop_words<span class="op">$</span>word,<span class="st">&quot;dialysis&quot;</span>,<span class="st">&quot;patients&quot;</span>,<span class="st">&quot;home&quot;</span>,<span class="st">&quot;kidney&quot;</span>,
                       <span class="st">&quot;hemodialysis&quot;</span>,<span class="st">&quot;haemodialysis&quot;</span>,<span class="st">&quot;patient&quot;</span>,<span class="st">&quot;hhd&quot;</span>,
                       <span class="st">&quot;pd&quot;</span>,<span class="st">&quot;peritoneal&quot;</span>,<span class="st">&quot;hd&quot;</span>,<span class="st">&quot;renal&quot;</span>,<span class="st">&quot;study&quot;</span>,<span class="st">&quot;care&quot;</span>,
                       <span class="st">&quot;ci&quot;</span>,<span class="st">&quot;chd&quot;</span>,<span class="st">&quot;nhd&quot;</span>,<span class="st">&quot;disease&quot;</span>))

tidy_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) </code></pre></div>
<pre><code>## # A tibble: 6,447 x 2
##    word             n
##    &lt;chr&gt;        &lt;int&gt;
##  1 treatment      228
##  2 therapy        191
##  3 survival       188
##  4 clinical       180
##  5 center         178
##  6 conventional   177
##  7 nocturnal      177
##  8 quality        176
##  9 compared       172
## 10 outcomes       165
## # ... with 6,437 more rows</code></pre>
<p>Let’s do some plotting of these words</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_text <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">word =</span> <span class="kw">reorder</span>(word, n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(word, n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-108-1.png" width="672" /></p>
<p>Okay, it looks like there are numbers in there which might be useful. I suspect that the “95” is probably associated with the idea of a confidence interval. But there are other references to numbers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">grep</span>(<span class="st">&quot;^[0-9]{1,3}$&quot;</span>,tidy_text<span class="op">$</span>word)[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>]</code></pre></div>
<pre><code>##  [1] 203 260 268 269 271 333 347 351 356 400 401 409 410 446 513 523 530
## [18] 545 552 569</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_text_nonum &lt;-<span class="st"> </span>tidy_text[<span class="kw">grep</span>(<span class="st">&quot;^[0-9]{1,3}$&quot;</span>,tidy_text<span class="op">$</span>word,<span class="dt">invert=</span><span class="ot">TRUE</span>),]</code></pre></div>
<p>Okay well I think maybe we have some reasonable data to examine. As you might have realized by now, manipulating data to get it “clean” can be tedious and frustrating though it is an inevitable part of the process.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_text_nonum <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">word =</span> <span class="kw">reorder</span>(word, n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(word, n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-110-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nrc_joy &lt;-<span class="st"> </span><span class="kw">get_sentiments</span>(<span class="st">&quot;nrc&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(sentiment <span class="op">==</span><span class="st"> &quot;joy&quot;</span>)

bing_word_counts &lt;-<span class="st"> </span>tidy_text_nonum <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(<span class="kw">get_sentiments</span>(<span class="st">&quot;nrc&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(word,sentiment,<span class="dt">sort=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Joining, by = &quot;word&quot;</code></pre>
<p>t the positive vs negative words</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bing_word_counts <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(sentiment) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">top_n</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">word =</span> <span class="kw">reorder</span>(word, n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(word, n, <span class="dt">fill =</span> sentiment)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>sentiment, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Contribution to sentiment&quot;</span>,
       <span class="dt">x =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<pre><code>## Selecting by n</code></pre>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-112-1.png" width="672" /></p>
<p>Let’s create a word cloud</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(wordcloud)
<span class="co">#</span>

tidy_text_nonum <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">count</span>(word) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">with</span>(<span class="kw">wordcloud</span>(word,n,<span class="dt">max.words=</span><span class="dv">100</span>,<span class="dt">colors=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&quot;Dark2&quot;</span>)))</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-113-1.png" width="672" /></p>
</div>
<div id="bigrams-1" class="section level2">
<h2><span class="header-section-number">11.5</span> BiGrams</h2>
<p>Let’s look at bigrams. We need to go back to the cleaned abstracts and pair words to get phrase that might be suggestive of some sentiment</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text_df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">line =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(my_abstracts), <span class="dt">text =</span> my_abstracts)
dialysis_bigrams &lt;-<span class="st"> </span>text_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_tokens</span>(bigram, text, <span class="dt">token =</span> <span class="st">&quot;ngrams&quot;</span>, <span class="dt">n =</span> <span class="dv">2</span>)

dialysis_bigrams <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(bigram, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 41,630 x 2
##    bigram                  n
##    &lt;chr&gt;               &lt;int&gt;
##  1 in the                382
##  2 of the                316
##  3 home dialysis         280
##  4 home hemodialysis     267
##  5 peritoneal dialysis   198
##  6 of home               189
##  7 associated with       172
##  8 home hd               153
##  9 home haemodialysis    138
## 10 in center             138
## # ... with 41,620 more rows</code></pre>
<p>But we have to filter out stop words</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bigrams_sep &lt;-<span class="st"> </span>dialysis_bigrams <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(bigram,<span class="kw">c</span>(<span class="st">&quot;word1&quot;</span>,<span class="st">&quot;word2&quot;</span>),<span class="dt">sep=</span><span class="st">&quot; &quot;</span>)

stop_list &lt;-<span class="st"> </span><span class="kw">c</span>(stop_words<span class="op">$</span>word,<span class="st">&quot;dialysis&quot;</span>,<span class="st">&quot;patients&quot;</span>,<span class="st">&quot;home&quot;</span>,<span class="st">&quot;kidney&quot;</span>,
                       <span class="st">&quot;hemodialysis&quot;</span>,<span class="st">&quot;haemodialysis&quot;</span>,<span class="st">&quot;patient&quot;</span>,<span class="st">&quot;hhd&quot;</span>,
                       <span class="st">&quot;pd&quot;</span>,<span class="st">&quot;peritoneal&quot;</span>,<span class="st">&quot;hd&quot;</span>,<span class="st">&quot;renal&quot;</span>,<span class="st">&quot;study&quot;</span>,<span class="st">&quot;care&quot;</span>,
                       <span class="st">&quot;ci&quot;</span>,<span class="st">&quot;chd&quot;</span>,<span class="st">&quot;nhd&quot;</span>,<span class="st">&quot;esrd&quot;</span>,<span class="st">&quot;lt&quot;</span>,<span class="st">&quot;95&quot;</span>,<span class="st">&quot;0.001&quot;</span>)

bigrams_filtered &lt;-<span class="st"> </span>bigrams_sep <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>word1 <span class="op">%in%</span><span class="st"> </span>stop_list) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>word2 <span class="op">%in%</span><span class="st"> </span>stop_list)

bigram_counts &lt;-<span class="st"> </span>bigrams_filtered <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(word1, word2, <span class="dt">sort =</span> <span class="ot">TRUE</span>)

bigrams_united &lt;-<span class="st"> </span>bigrams_filtered <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unite</span>(bigram, word1, word2, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)

bigrams_united <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">count</span>(bigram, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">n=</span><span class="dv">25</span>)</code></pre></div>
<pre><code>## # A tibble: 11,825 x 2
##    bigram                     n
##    &lt;chr&gt;                  &lt;int&gt;
##  1 replacement therapy       69
##  2 vascular access           62
##  3 technique failure         54
##  4 left ventricular          42
##  5 confidence interval       40
##  6 blood pressure            39
##  7 clinical outcomes         36
##  8 thrice weekly             32
##  9 short daily               31
## 10 technique survival        29
## 11 quality improvement       26
## 12 hazard ratio              25
## 13 adverse events            22
## 14 6 months                  20
## 15 access related            20
## 16 ventricular mass          19
## 17 12 months                 18
## 18 arteriovenous fistula     17
## 19 3 times                   15
## 20 buttonhole cannulation    15
## 21 daily life                15
## 22 health related            15
## 23 observational studies     15
## 24 cost effective            14
## 25 cost effectiveness        14
## # ... with 1.18e+04 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bigram_counts <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(word1, <span class="op">-</span>n), <span class="dt">y =</span> <span class="kw">reorder</span>(word2, <span class="op">-</span>n), <span class="dt">fill =</span> n)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_tile</span>(<span class="dt">alpha =</span> <span class="fl">0.8</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colours =</span> <span class="kw">c</span>(<span class="kw">palette_light</span>()[[<span class="dv">1</span>]], <span class="kw">palette_light</span>()[[<span class="dv">2</span>]])) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">theme_tq</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;right&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;first word in pair&quot;</span>,
         <span class="dt">y =</span> <span class="st">&quot;second word in pair&quot;</span>)</code></pre></div>
<p><img src="Web_Scraping_files/figure-html/unnamed-chunk-116-1.png" width="672" /></p>
<!--chapter:end:04-bow.Rmd-->
</div>
</div>
<div id="final-words-1" class="section level1">
<h1><span class="header-section-number">12</span> Final Words</h1>
<p>We have finished a nice book.</p>
<!--chapter:end:05-summary.Rmd-->
</div>
<div id="references-1" class="section level1 unnumbered">
<h1>References</h1>
<!--chapter:end:06-references.Rmd-->
<!--chapter:end:WebScraping.Rmd-->
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

</body>

</html>
