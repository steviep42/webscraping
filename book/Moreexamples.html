<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 More Real Life Examples | Web Scraping with R</title>
  <meta name="description" content="This is in support of my talk for the Data Science group" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 More Real Life Examples | Web Scraping with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is in support of my talk for the Data Science group" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 More Real Life Examples | Web Scraping with R" />
  
  <meta name="twitter:description" content="This is in support of my talk for the Data Science group" />
  

<meta name="author" content="Steve Pittard" />


<meta name="date" content="2022-02-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="xml.html"/>
<link rel="next" href="APIs.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Web Scraping</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Motivations</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#lots-of-data-for-the-taking"><i class="fa fa-check"></i><b>1.1</b> Lots of Data For The Taking ?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#web-scraping-can-be-ugly"><i class="fa fa-check"></i><b>1.2</b> Web Scraping Can Be Ugly</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#understanding-the-language-of-the-web"><i class="fa fa-check"></i><b>1.3</b> Understanding The Language of The Web</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#useful-tools"><i class="fa fa-check"></i><b>1.3.1</b> Useful tools</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#useful-packages"><i class="fa fa-check"></i><b>1.4</b> Useful Packages</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#quick-rvest-tutorial"><i class="fa fa-check"></i><b>1.5</b> Quick <strong>rvest</strong> tutorial</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#example-parsing-a-table-from-wikipedia"><i class="fa fa-check"></i><b>1.6</b> Example: Parsing A Table From Wikipedia</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#scraping-patient-dialysis-stories"><i class="fa fa-check"></i><b>1.7</b> Scraping Patient Dialysis Stories</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="index.html"><a href="index.html#getting-more-detail"><i class="fa fa-check"></i><b>1.7.1</b> Getting More Detail</a></li>
<li class="chapter" data-level="1.7.2" data-path="index.html"><a href="index.html#writing-some-code"><i class="fa fa-check"></i><b>1.7.2</b> Writing Some Code</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#summary"><i class="fa fa-check"></i><b>1.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="xml.html"><a href="xml.html"><i class="fa fa-check"></i><b>2</b> XML and JSON</a>
<ul>
<li class="chapter" data-level="2.1" data-path="xml.html"><a href="xml.html#finding-xpaths"><i class="fa fa-check"></i><b>2.1</b> Finding XPaths</a></li>
<li class="chapter" data-level="2.2" data-path="xml.html"><a href="xml.html#example-geocoding-with-google"><i class="fa fa-check"></i><b>2.2</b> Example: GeoCoding With Google</a></li>
<li class="chapter" data-level="2.3" data-path="xml.html"><a href="xml.html#using-json"><i class="fa fa-check"></i><b>2.3</b> Using JSON</a></li>
<li class="chapter" data-level="2.4" data-path="xml.html"><a href="xml.html#using-the-rjsonio-package"><i class="fa fa-check"></i><b>2.4</b> Using the RJSONIO Package</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Moreexamples.html"><a href="Moreexamples.html"><i class="fa fa-check"></i><b>3</b> More Real Life Examples</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Moreexamples.html"><a href="Moreexamples.html#bitcoin-prices"><i class="fa fa-check"></i><b>3.1</b> BitCoin Prices</a></li>
<li class="chapter" data-level="3.2" data-path="Moreexamples.html"><a href="Moreexamples.html#imdb"><i class="fa fa-check"></i><b>3.2</b> IMDB</a></li>
<li class="chapter" data-level="3.3" data-path="Moreexamples.html"><a href="Moreexamples.html#faculty-salaries"><i class="fa fa-check"></i><b>3.3</b> Faculty Salaries</a></li>
<li class="chapter" data-level="3.4" data-path="Moreexamples.html"><a href="Moreexamples.html#filling-out-forms-from-a-program"><i class="fa fa-check"></i><b>3.4</b> Filling Out Forms From a Program</a></li>
<li class="chapter" data-level="3.5" data-path="Moreexamples.html"><a href="Moreexamples.html#pubmed"><i class="fa fa-check"></i><b>3.5</b> PubMed</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="APIs.html"><a href="APIs.html"><i class="fa fa-check"></i><b>4</b> APIs</a>
<ul>
<li class="chapter" data-level="4.1" data-path="APIs.html"><a href="APIs.html#omdb"><i class="fa fa-check"></i><b>4.1</b> OMDB</a></li>
<li class="chapter" data-level="4.2" data-path="APIs.html"><a href="APIs.html#the-omdbapi-package"><i class="fa fa-check"></i><b>4.2</b> The omdbapi package</a></li>
<li class="chapter" data-level="4.3" data-path="APIs.html"><a href="APIs.html#rselenium"><i class="fa fa-check"></i><b>4.3</b> RSelenium</a></li>
<li class="chapter" data-level="4.4" data-path="APIs.html"><a href="APIs.html#easypubmed"><i class="fa fa-check"></i><b>4.4</b> EasyPubMed</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bagofwords.html"><a href="bagofwords.html"><i class="fa fa-check"></i><b>5</b> Bag of Words Sentiment Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bagofwords.html"><a href="bagofwords.html#workflow"><i class="fa fa-check"></i><b>5.1</b> Workflow</a></li>
<li class="chapter" data-level="5.2" data-path="bagofwords.html"><a href="bagofwords.html#simple-example"><i class="fa fa-check"></i><b>5.2</b> Simple Example</a></li>
<li class="chapter" data-level="5.3" data-path="bagofwords.html"><a href="bagofwords.html#tidytext"><i class="fa fa-check"></i><b>5.3</b> tidytext</a></li>
<li class="chapter" data-level="5.4" data-path="bagofwords.html"><a href="bagofwords.html#back-to-the-pubmed-example"><i class="fa fa-check"></i><b>5.4</b> Back To The PubMed Example</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="bagofwords.html"><a href="bagofwords.html#how-do-you-feel"><i class="fa fa-check"></i><b>5.4.1</b> How Do You Feel ?</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="bagofwords.html"><a href="bagofwords.html#bigrams"><i class="fa fa-check"></i><b>5.5</b> BiGrams</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>6</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Web Scraping with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Moreexamples" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> More Real Life Examples</h1>
<p>Okay. This is a tour of some sites that will serve as important examples on how to parse sites. Let’s check the price of bitcoins. You want to be rich don’t you ?</p>
<div id="bitcoin-prices" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> BitCoin Prices</h2>
<p><img src="PICS/bc4.png" /></p>
<p>The challenge here is that it’s all one big table and it’s not clear how to adress it. And the owners of the web site will ususally change the format or start using Javascript or HTML5 which will mess things up in the future. One solid approach I frequently use is to simply pull out all the tables and, by experimentation, try to figure out which one has the information I want. This always require some work.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="Moreexamples.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb56-2"><a href="Moreexamples.html#cb56-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://coinmarketcap.com/all/views/all/&quot;</span></span>
<span id="cb56-3"><a href="Moreexamples.html#cb56-3" aria-hidden="true" tabindex="-1"></a>bc <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb56-4"><a href="Moreexamples.html#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="Moreexamples.html#cb56-5" aria-hidden="true" tabindex="-1"></a>bc_table <span class="ot">&lt;-</span> bc <span class="sc">%&gt;%</span> </span>
<span id="cb56-6"><a href="Moreexamples.html#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&#39;table&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-7"><a href="Moreexamples.html#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>() <span class="sc">%&gt;%</span> .[[<span class="dv">3</span>]]</span>
<span id="cb56-8"><a href="Moreexamples.html#cb56-8" aria-hidden="true" tabindex="-1"></a> <span class="co"># We get back a one element list that is a data frame</span></span>
<span id="cb56-9"><a href="Moreexamples.html#cb56-9" aria-hidden="true" tabindex="-1"></a> <span class="fu">str</span>(bc_table,<span class="dv">0</span>)</span></code></pre></div>
<pre><code>## tibble [200 × 1,001] (S3: tbl_df/tbl/data.frame)</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="Moreexamples.html#cb58-1" aria-hidden="true" tabindex="-1"></a> bc_table <span class="ot">&lt;-</span> bc_table[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">5</span>)]</span>
<span id="cb58-2"><a href="Moreexamples.html#cb58-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">head</span>(bc_table)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   Name         Symbol Price     
##   &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;     
## 1 BTCBitcoin   BTC    $43,023.30
## 2 ETHEthereum  ETH    $3,055.21 
## 3 USDTTether   USDT   $1.00     
## 4 BNBBNB       BNB    $416.09   
## 5 USDCUSD Coin USDC   $0.9995   
## 6 XRPXRP       XRP    $0.8144</code></pre>
<p>Everything is a character at this point so we have to go in an do some surgery on the data frame to turn the Price into an actual numeric.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="Moreexamples.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The data is &quot;dirty&quot; and has characers in it that need cleaning</span></span>
<span id="cb60-2"><a href="Moreexamples.html#cb60-2" aria-hidden="true" tabindex="-1"></a>bc_table <span class="ot">&lt;-</span> bc_table <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Price=</span><span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">$&quot;</span>,<span class="st">&quot;&quot;</span>,Price))</span>
<span id="cb60-3"><a href="Moreexamples.html#cb60-3" aria-hidden="true" tabindex="-1"></a>bc_table <span class="ot">&lt;-</span> bc_table <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Price=</span><span class="fu">gsub</span>(<span class="st">&quot;,&quot;</span>,<span class="st">&quot;&quot;</span>,Price))</span>
<span id="cb60-4"><a href="Moreexamples.html#cb60-4" aria-hidden="true" tabindex="-1"></a>bc_table <span class="ot">&lt;-</span> bc_table <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Price=</span><span class="fu">round</span>(<span class="fu">as.numeric</span>(Price),<span class="dv">2</span>))</span>
<span id="cb60-5"><a href="Moreexamples.html#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="Moreexamples.html#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co"># There are four rows wherein the Price is missing NA</span></span>
<span id="cb60-7"><a href="Moreexamples.html#cb60-7" aria-hidden="true" tabindex="-1"></a>bc_table <span class="ot">&lt;-</span> bc_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">complete.cases</span>(bc_table))</span>
<span id="cb60-8"><a href="Moreexamples.html#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="Moreexamples.html#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s get the Crypto currencies with the Top 10 highest prices </span></span>
<span id="cb60-10"><a href="Moreexamples.html#cb60-10" aria-hidden="true" tabindex="-1"></a>top_10 <span class="ot">&lt;-</span> bc_table <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Price)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb60-11"><a href="Moreexamples.html#cb60-11" aria-hidden="true" tabindex="-1"></a>top_10</span></code></pre></div>
<pre><code>## # A tibble: 10 × 3
##    Name                Symbol    Price
##    &lt;chr&gt;               &lt;chr&gt;     &lt;dbl&gt;
##  1 WBTCWrapped Bitcoin WBTC   43062.  
##  2 BTCBitcoin          BTC    43023.  
##  3 ETHEthereum         ETH     3055.  
##  4 BNBBNB              BNB      416.  
##  5 LTCLitecoin         LTC      132.  
##  6 SOLSolana           SOL      112.  
##  7 AVAXAvalanche       AVAX      84.1 
##  8 LUNATerra           LUNA      56.4 
##  9 DOTPolkadot         DOT       21.3 
## 10 MATICPolygon        MATIC      1.89</code></pre>
<p>Let’s make a barplot of the top 10 crypto currencies.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="Moreexamples.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Next we want to make a barplot of the Top 10</span></span>
<span id="cb62-2"><a href="Moreexamples.html#cb62-2" aria-hidden="true" tabindex="-1"></a>ylim<span class="ot">=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(top_10<span class="sc">$</span>Price)<span class="sc">+</span><span class="dv">10000</span>)</span>
<span id="cb62-3"><a href="Moreexamples.html#cb62-3" aria-hidden="true" tabindex="-1"></a>main<span class="ot">=</span><span class="st">&quot;Top 10 Crypto Currencies in Terms of Price&quot;</span></span>
<span id="cb62-4"><a href="Moreexamples.html#cb62-4" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">barplot</span>(top_10<span class="sc">$</span>Price,<span class="at">col=</span><span class="st">&quot;aquamarine&quot;</span>,</span>
<span id="cb62-5"><a href="Moreexamples.html#cb62-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">ylim=</span>ylim,<span class="at">main=</span>main)</span>
<span id="cb62-6"><a href="Moreexamples.html#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at=</span>bp, <span class="at">labels=</span>top_10<span class="sc">$</span>Symbol,  <span class="at">cex.axis =</span> <span class="fl">0.7</span>)</span>
<span id="cb62-7"><a href="Moreexamples.html#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span></code></pre></div>
<p><img src="Web_Scraping_files/figure-html/bitbar-1.png" width="672" /></p>
<p>So that didn’t work out so well since one of the crypto currencies dominates the others in terms of price. So let’s create a log transformed verion of the plot.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="Moreexamples.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s take the log of the price</span></span>
<span id="cb63-2"><a href="Moreexamples.html#cb63-2" aria-hidden="true" tabindex="-1"></a>ylim<span class="ot">=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(<span class="fu">log</span>(top_10<span class="sc">$</span>Price))<span class="sc">+</span><span class="dv">5</span>)</span>
<span id="cb63-3"><a href="Moreexamples.html#cb63-3" aria-hidden="true" tabindex="-1"></a>main<span class="ot">=</span><span class="st">&quot;Top 10 Crypto Currencies in Terms of log(Price)&quot;</span></span>
<span id="cb63-4"><a href="Moreexamples.html#cb63-4" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">barplot</span>(<span class="fu">log</span>(top_10<span class="sc">$</span>Price),<span class="at">col=</span><span class="st">&quot;aquamarine&quot;</span>,</span>
<span id="cb63-5"><a href="Moreexamples.html#cb63-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">ylim=</span>ylim,<span class="at">main=</span>main)</span>
<span id="cb63-6"><a href="Moreexamples.html#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at=</span>bp, <span class="at">labels=</span>top_10<span class="sc">$</span>Symbol,  <span class="at">cex.axis =</span> <span class="fl">0.7</span>)</span>
<span id="cb63-7"><a href="Moreexamples.html#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span></code></pre></div>
<p><img src="Web_Scraping_files/figure-html/bitbarlog-1.png" width="672" /></p>
</div>
<div id="imdb" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> IMDB</h2>
<p>Look at this example from IMDb (Internet Movie Database). According to Wikipedia:</p>
<p>IMDb (Internet Movie Database)[2] is an online database of information related to films, television programs, home videos, video games, and streaming content online – including cast, production crew and personal biographies, plot summaries, trivia, fan and critical reviews, and ratings. We can search or refer to specific movies by URL if we wanted. For example, consider the following link to the “Lego Movie”: <a href="http://www.imdb.com/title/tt1490017/" class="uri">http://www.imdb.com/title/tt1490017/</a></p>
<p><img src="PICS/legom.png" /></p>
<p>In terms of scraping information from this site we could do that using the <strong>rvest</strong> package. Let’s say that we wanted to capture the rating information which is 7.8 out of 10. We could use the xPath Tool or the Selector gadet tool to zone in on this information. According to selector gadget we have the following xpath expression:</p>
<p><img src="PICS/sg.png" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="Moreexamples.html#cb64-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://www.imdb.com/title/tt1490017/&quot;</span></span>
<span id="cb64-2"><a href="Moreexamples.html#cb64-2" aria-hidden="true" tabindex="-1"></a>lego_movie <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb64-3"><a href="Moreexamples.html#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="Moreexamples.html#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Scrape the website for the movie rating</span></span>
<span id="cb64-5"><a href="Moreexamples.html#cb64-5" aria-hidden="true" tabindex="-1"></a>rating <span class="ot">&lt;-</span> lego_movie <span class="sc">%&gt;%</span></span>
<span id="cb64-6"><a href="Moreexamples.html#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;.ratingValue span&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-7"><a href="Moreexamples.html#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() </span></code></pre></div>
<p>So that gives us what we need albeit in character form. Now it’s a simple matter of parsing out the first rating value:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="Moreexamples.html#cb65-1" aria-hidden="true" tabindex="-1"></a>(rating <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(rating[<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>That wasn’t so bad. Let’s see what using the xPath plugin gives us:</p>
<p><img src="PICS/xpp.png" /></p>
<p>We get a much longer xpath expression which should provide us with direct access to the value.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="Moreexamples.html#cb67-1" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">&lt;-</span> <span class="st">&quot;/html/body/div[3]/div/div[2]/div[5]/div[1]/div[2]/div/div[1]/div[2]/div/div[1]/div[1]/div[1]/strong/span&quot;</span></span>
<span id="cb67-2"><a href="Moreexamples.html#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="Moreexamples.html#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Scrape the website for the movie rating</span></span>
<span id="cb67-4"><a href="Moreexamples.html#cb67-4" aria-hidden="true" tabindex="-1"></a>rating <span class="ot">&lt;-</span> lego_movie <span class="sc">%&gt;%</span></span>
<span id="cb67-5"><a href="Moreexamples.html#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="at">xpath=</span>xp) <span class="sc">%&gt;%</span></span>
<span id="cb67-6"><a href="Moreexamples.html#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb67-7"><a href="Moreexamples.html#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="Moreexamples.html#cb67-8" aria-hidden="true" tabindex="-1"></a>rating</span></code></pre></div>
<pre><code>## numeric(0)</code></pre>
<p>Let’s access the summary section of the link. We could use Selector Gadget or the xPath plugin. I’ll use the former.</p>
<p><img src="PICS/summary.png" /></p>
<p><img src="PICS/sumxt.png" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="Moreexamples.html#cb69-1" aria-hidden="true" tabindex="-1"></a>mov_summary <span class="ot">&lt;-</span> lego_movie <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="Moreexamples.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;.summary_text&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="Moreexamples.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() </span>
<span id="cb69-4"><a href="Moreexamples.html#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="Moreexamples.html#cb69-5" aria-hidden="true" tabindex="-1"></a>mov_summary</span></code></pre></div>
<pre><code>## character(0)</code></pre>
</div>
<div id="faculty-salaries" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Faculty Salaries</h2>
<p>In this example we have to parse the main table associated with the results page.</p>
<div class="figure">
<img src="PICS/salary.png" alt="" />
<p class="caption">Salary</p>
</div>
<div class="figure">
<img src="PICS/sal_page.png" alt="" />
<p class="caption">Salary</p>
</div>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="Moreexamples.html#cb71-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.insidehighered.com/aaup-compensation-survey&quot;</span></span>
<span id="cb71-2"><a href="Moreexamples.html#cb71-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">%&gt;%</span> <span class="fu">html_table</span>() <span class="sc">%&gt;%</span> <span class="st">`</span><span class="at">[[</span><span class="st">`</span>(<span class="dv">1</span>)</span>
<span id="cb71-3"><a href="Moreexamples.html#cb71-3" aria-hidden="true" tabindex="-1"></a>intost <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Institution&quot;</span>,<span class="st">&quot;Category&quot;</span>,<span class="st">&quot;State&quot;</span>)</span>
<span id="cb71-4"><a href="Moreexamples.html#cb71-4" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">separate</span>(InstitutionCategoryState,<span class="at">into=</span>intost,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) </span>
<span id="cb71-5"><a href="Moreexamples.html#cb71-5" aria-hidden="true" tabindex="-1"></a>salary</span></code></pre></div>
<pre><code>## # A tibble: 10 × 8
##    Institution Category State `Avg. SalaryFul… `Avg. ChangeCon… `CountFull Prof… `Avg. Total Com…
##    &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;            &lt;chr&gt;                       &lt;int&gt; &lt;chr&gt;           
##  1 Auburn Uni… Doctoral ALAB… $132,600         4.4%                          407 $170,300        
##  2 Birmingham… Baccala… ALAB… $81,000          0.0%                           39 $100,000        
##  3 Huntingdon… Baccala… ALAB… $76,700          0.0%                           13 $89,500         
##  4 Jacksonvil… Master’s ALAB… $77,300          N/A                            78 $104,100        
##  5 Samford Un… Master   ALAB… $105,200         3.2%                          130 $133,300        
##  6 Troy Unive… Masters  ALAB… $84,500          1.6%                           30 $88,500         
##  7 The Univer… Doctoral ALAB… $151,600         2.0%                          300 $205,100        
##  8 University… Doctoral ALAB… $139,100         2.8%                          191 $164,800        
##  9 University… Doctoral ALAB… $126,400         2.0%                           64 $169,200        
## 10 University… Master   ALAB… $80,700          2.1%                           47 $106,100        
## # … with 1 more variable: Salary EquityFull Professors &lt;dbl&gt;</code></pre>
<p>So the default is 10 listings per page but there are many more pages we could process to get more information. If we look at the bottom of the page we can get some clues as to what the URLs are. Here we’ll just process the first two pages since it will be quick and won’t burden the server.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="Moreexamples.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># So now we could process multiple pages</span></span>
<span id="cb73-2"><a href="Moreexamples.html#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="Moreexamples.html#cb73-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&#39;https://www.insidehighered.com/aaup-compensation-survey?institution-name=&amp;professor-category=1591&amp;page=1&#39;</span></span>
<span id="cb73-4"><a href="Moreexamples.html#cb73-4" aria-hidden="true" tabindex="-1"></a>str1 <span class="ot">&lt;-</span> <span class="st">&quot;https://www.insidehighered.com/aaup-compensation-survey?&quot;</span></span>
<span id="cb73-5"><a href="Moreexamples.html#cb73-5" aria-hidden="true" tabindex="-1"></a>str2 <span class="ot">&lt;-</span> <span class="st">&quot;institution-name=&amp;professor-category=1591&amp;page=&quot;</span></span>
<span id="cb73-6"><a href="Moreexamples.html#cb73-6" aria-hidden="true" tabindex="-1"></a>intost <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Institution&quot;</span>,<span class="st">&quot;Category&quot;</span>,<span class="st">&quot;State&quot;</span>)</span>
<span id="cb73-7"><a href="Moreexamples.html#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="Moreexamples.html#cb73-8" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb73-9"><a href="Moreexamples.html#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="Moreexamples.html#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co"># We&#39;ll get just the first two pages</span></span>
<span id="cb73-11"><a href="Moreexamples.html#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="Moreexamples.html#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) {</span>
<span id="cb73-13"><a href="Moreexamples.html#cb73-13" aria-hidden="true" tabindex="-1"></a>  nurl  <span class="ot">&lt;-</span> <span class="fu">paste</span>(str1,str2,ii,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb73-14"><a href="Moreexamples.html#cb73-14" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read_html</span>(nurl)</span>
<span id="cb73-15"><a href="Moreexamples.html#cb73-15" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">html_table</span>() <span class="sc">%&gt;%</span> <span class="st">`</span><span class="at">[[</span><span class="st">`</span>(<span class="dv">1</span>)</span>
<span id="cb73-16"><a href="Moreexamples.html#cb73-16" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> tmp <span class="sc">%&gt;%</span> <span class="fu">separate</span>(InstitutionCategoryState,<span class="at">into=</span>intost,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) </span>
<span id="cb73-17"><a href="Moreexamples.html#cb73-17" aria-hidden="true" tabindex="-1"></a>  salary <span class="ot">&lt;-</span> <span class="fu">rbind</span>(salary,tmp)</span>
<span id="cb73-18"><a href="Moreexamples.html#cb73-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-19"><a href="Moreexamples.html#cb73-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-20"><a href="Moreexamples.html#cb73-20" aria-hidden="true" tabindex="-1"></a>salary</span></code></pre></div>
<p>Look at the URLs at the bottom of the main page to find beginning and ending page numbers. Visually this is easy. Programmatically we could do something like the following:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="Moreexamples.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.insidehighered.com/aaup-compensation-survey?page=1</span></span>
<span id="cb74-2"><a href="Moreexamples.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.insidehighered.com/aaup-compensation-survey?page=94</span></span>
<span id="cb74-3"><a href="Moreexamples.html#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="Moreexamples.html#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># What is the last page number ? We already know the answer - 94</span></span>
<span id="cb74-5"><a href="Moreexamples.html#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="Moreexamples.html#cb74-6" aria-hidden="true" tabindex="-1"></a>lastnum <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">html_nodes</span>(<span class="at">xpath=</span><span class="st">&#39;//a&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-7"><a href="Moreexamples.html#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">&quot;href&quot;</span>) <span class="sc">%&gt;%</span> <span class="st">&#39;[&#39;</span>(<span class="dv">103</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-8"><a href="Moreexamples.html#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(.,<span class="st">&quot;page=&quot;</span>) <span class="sc">%&gt;%</span> <span class="st">&#39;[[&#39;</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="st">&#39;[&#39;</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(.)</span>
<span id="cb74-9"><a href="Moreexamples.html#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="Moreexamples.html#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co"># So now we could get all pages of the survey</span></span>
<span id="cb74-11"><a href="Moreexamples.html#cb74-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-12"><a href="Moreexamples.html#cb74-12" aria-hidden="true" tabindex="-1"></a>str1 <span class="ot">&lt;-</span> <span class="st">&quot;https://www.insidehighered.com/aaup-compensation-survey?&quot;</span></span>
<span id="cb74-13"><a href="Moreexamples.html#cb74-13" aria-hidden="true" tabindex="-1"></a>str2 <span class="ot">&lt;-</span> <span class="st">&quot;institution-name=&amp;professor-category=1591&amp;page=&quot;</span></span>
<span id="cb74-14"><a href="Moreexamples.html#cb74-14" aria-hidden="true" tabindex="-1"></a>intost <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Institution&quot;</span>,<span class="st">&quot;Category&quot;</span>,<span class="st">&quot;State&quot;</span>)</span>
<span id="cb74-15"><a href="Moreexamples.html#cb74-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-16"><a href="Moreexamples.html#cb74-16" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb74-17"><a href="Moreexamples.html#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="Moreexamples.html#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lastnum) {</span>
<span id="cb74-19"><a href="Moreexamples.html#cb74-19" aria-hidden="true" tabindex="-1"></a>  nurl  <span class="ot">&lt;-</span> <span class="fu">paste</span>(str1,str2,ii,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb74-20"><a href="Moreexamples.html#cb74-20" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read_html</span>(nurl)</span>
<span id="cb74-21"><a href="Moreexamples.html#cb74-21" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">html_table</span>() <span class="sc">%&gt;%</span> <span class="st">`</span><span class="at">[[</span><span class="st">`</span>(<span class="dv">1</span>)</span>
<span id="cb74-22"><a href="Moreexamples.html#cb74-22" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> tmp <span class="sc">%&gt;%</span> <span class="fu">separate</span>(InstitutionCategoryState,<span class="at">into=</span>intost,<span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>) </span>
<span id="cb74-23"><a href="Moreexamples.html#cb74-23" aria-hidden="true" tabindex="-1"></a>  salary <span class="ot">&lt;-</span> <span class="fu">rbind</span>(salary,tmp)</span>
<span id="cb74-24"><a href="Moreexamples.html#cb74-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">1</span>)</span>
<span id="cb74-25"><a href="Moreexamples.html#cb74-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-26"><a href="Moreexamples.html#cb74-26" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(salary) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Institution&quot;</span>,<span class="st">&quot;Category&quot;</span>,<span class="st">&quot;State&quot;</span>,<span class="st">&quot;AvgSalFP&quot;</span>,<span class="st">&quot;AvgChgFP&quot;</span>,</span>
<span id="cb74-27"><a href="Moreexamples.html#cb74-27" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;CntFP&quot;</span>,<span class="st">&quot;AvgTotCompFP&quot;</span>,<span class="st">&quot;SalEquityFP&quot;</span>)</span>
<span id="cb74-28"><a href="Moreexamples.html#cb74-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-29"><a href="Moreexamples.html#cb74-29" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> salary <span class="sc">%&gt;%</span> </span>
<span id="cb74-30"><a href="Moreexamples.html#cb74-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AvgSalFP=</span><span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">$|,&quot;</span>,<span class="st">&quot;&quot;</span>,salary<span class="sc">$</span>AvgSalFP))) <span class="sc">%&gt;%</span></span>
<span id="cb74-31"><a href="Moreexamples.html#cb74-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AvgTotCompFP=</span><span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">$|,&quot;</span>,<span class="st">&quot;&quot;</span>,salary<span class="sc">$</span>AvgTotCompFP)))</span>
<span id="cb74-32"><a href="Moreexamples.html#cb74-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-33"><a href="Moreexamples.html#cb74-33" aria-hidden="true" tabindex="-1"></a>salary <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(State,Category) <span class="sc">%&gt;%</span> </span>
<span id="cb74-34"><a href="Moreexamples.html#cb74-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg=</span><span class="fu">mean</span>(AvgSalFP)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-35"><a href="Moreexamples.html#cb74-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg))</span></code></pre></div>
<p>There are some problems:</p>
<ul>
<li>Data is large and scattered across multiple pages</li>
<li>We could use above techniques to move from page to page</li>
<li>There is a form we could use to narrow criteria</li>
<li>But we have to programmatically submit the form</li>
<li>rvest (and other packages) let you do this</li>
</ul>
</div>
<div id="filling-out-forms-from-a-program" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Filling Out Forms From a Program</h2>
<div class="figure">
<img src="PICS/salary_form.png" width="250" alt="" />
<p class="caption">Salary</p>
</div>
<p>Let’s find salaries between $ 150,000 and the default max ($ 244,000)</p>
<ul>
<li>Find the element name associated with “Average Salary”</li>
<li>Establish a connection with the form (usually the url of the page)</li>
<li>Get a local copy of the form</li>
<li>Fill in the value for the “Average Salary”</li>
<li>Submit the lled in form</li>
<li>Get the results and parse them like above
`</li>
</ul>
<p>So finding the correct element is more challenging. I use Chrome to do this. Just highlight the area over the form and right click to “Insepct” the element. This opens up the developer tools. You have to dig down to find the corrext form and the element name. Here is a screen shot of my activity:</p>
<div class="figure">
<img src="PICS/form.png" width="550" alt="" />
<p class="caption">Salary</p>
</div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="Moreexamples.html#cb75-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.insidehighered.com/aaup-compensation-survey&quot;</span></span>
<span id="cb75-2"><a href="Moreexamples.html#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="Moreexamples.html#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Establish a session</span></span>
<span id="cb75-4"><a href="Moreexamples.html#cb75-4" aria-hidden="true" tabindex="-1"></a>mysess <span class="ot">&lt;-</span> <span class="fu">html_session</span>(url)</span>
<span id="cb75-5"><a href="Moreexamples.html#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="Moreexamples.html#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the form</span></span>
<span id="cb75-7"><a href="Moreexamples.html#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="Moreexamples.html#cb75-8" aria-hidden="true" tabindex="-1"></a>form_unfilled <span class="ot">&lt;-</span> mysess <span class="sc">%&gt;%</span> <span class="fu">html_node</span>(<span class="st">&quot;form&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">html_form</span>()</span>
<span id="cb75-9"><a href="Moreexamples.html#cb75-9" aria-hidden="true" tabindex="-1"></a>form_filled   <span class="ot">&lt;-</span> form_unfilled <span class="sc">%&gt;%</span> <span class="fu">set_values</span>(<span class="st">&quot;range-from&quot;</span><span class="ot">=</span><span class="dv">150000</span>)</span>
<span id="cb75-10"><a href="Moreexamples.html#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="Moreexamples.html#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Submit form</span></span>
<span id="cb75-12"><a href="Moreexamples.html#cb75-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-13"><a href="Moreexamples.html#cb75-13" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">submit_form</span>(mysess,form_filled)</span>
<span id="cb75-14"><a href="Moreexamples.html#cb75-14" aria-hidden="true" tabindex="-1"></a>first_page <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span> <span class="fu">html_nodes</span>(<span class="at">xpath=</span>expr) <span class="sc">%&gt;%</span> <span class="fu">html_table</span>()</span>
<span id="cb75-15"><a href="Moreexamples.html#cb75-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-16"><a href="Moreexamples.html#cb75-16" aria-hidden="true" tabindex="-1"></a>first_page</span></code></pre></div>
</div>
<div id="pubmed" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> PubMed</h2>
<p>Pubmed provides a rich source of information on published scientific literature. There are tutorials on how to leverage its capabilities but one thing to consider is that MESH terms are a good starting place since the search is index-based. MeSH (Medical Subject Headings) is the NLM controlled vocabulary thesaurus used for indexing articles for PubMed. It’s faster and more accurate so you can first use the MESH browser to generate the appropriate search terms and add that into the Search interface. The MESH browser can be found at <a href="https://www.ncbi.nlm.nih.gov/mesh/" class="uri">https://www.ncbi.nlm.nih.gov/mesh/</a></p>
<p><img src="PICS/pubmed1.png" width="550" /></p>
<p><img src="PICS/mesh.png" width="550" /></p>
<p>What we do here is get the links associated with each publication so we can then process each of those and get the abstract associated with each publication.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="Moreexamples.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;hemodialysis, home&quot; [MeSH Terms] </span></span>
<span id="cb76-2"><a href="Moreexamples.html#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="Moreexamples.html#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="Moreexamples.html#cb76-4" aria-hidden="true" tabindex="-1"></a>url<span class="ot">&lt;-</span><span class="st">&quot;https://www.ncbi.nlm.nih.gov/pubmed/?term=%22hemodialysis%2C+home%22+%5BMeSH+Terms%5D&quot;</span></span>
<span id="cb76-5"><a href="Moreexamples.html#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="Moreexamples.html#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb76-7"><a href="Moreexamples.html#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The results from the search will be of the form:</span></span>
<span id="cb76-8"><a href="Moreexamples.html#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.ncbi.nlm.nih.gov/pubmed/30380542</span></span>
<span id="cb76-9"><a href="Moreexamples.html#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="Moreexamples.html#cb76-10" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">%&gt;%</span> </span>
<span id="cb76-11"><a href="Moreexamples.html#cb76-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;a&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-12"><a href="Moreexamples.html#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">&quot;href&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-13"><a href="Moreexamples.html#cb76-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grep</span>(<span class="st">&quot;/[0-9]{6,6}&quot;</span>,.,<span class="at">value=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">unique</span>(.)</span>
<span id="cb76-14"><a href="Moreexamples.html#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="Moreexamples.html#cb76-15" aria-hidden="true" tabindex="-1"></a>results</span></code></pre></div>
<pre><code>##  [1] &quot;/27061610/&quot; &quot;/30041224/&quot; &quot;/25925822/&quot; &quot;/25925819/&quot; &quot;/28066912/&quot; &quot;/28535526/&quot; &quot;/27545636/&quot;
##  [8] &quot;/30041223/&quot; &quot;/26586045/&quot; &quot;/27781373/&quot;</code></pre>
<p><img src="PICS/pubmed_results.png" width="550" /></p>
<p>So now we could loop through these links and get the abstracts for these results. It looks that there are approximately 20 results per page. As before we would have to dive in to the underlying structure of the page to get the correct HTML pathnames or we could just look for Paragraph elements and pick out the links that way.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="Moreexamples.html#cb78-1" aria-hidden="true" tabindex="-1"></a>text.vec <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb78-2"><a href="Moreexamples.html#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="Moreexamples.html#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results)) {</span>
<span id="cb78-4"><a href="Moreexamples.html#cb78-4" aria-hidden="true" tabindex="-1"></a>  string <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;https://pubmed.ncbi.nlm.nih.gov&quot;</span>,results[ii])</span>
<span id="cb78-5"><a href="Moreexamples.html#cb78-5" aria-hidden="true" tabindex="-1"></a>  text.vec[ii] <span class="ot">&lt;-</span> <span class="fu">read_html</span>(string) <span class="sc">%&gt;%</span> <span class="fu">html_nodes</span>(<span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> <span class="st">`</span><span class="at">[[</span><span class="st">`</span>(<span class="dv">7</span>) <span class="sc">%&gt;%</span> <span class="fu">html_text</span>()</span>
<span id="cb78-6"><a href="Moreexamples.html#cb78-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-7"><a href="Moreexamples.html#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="Moreexamples.html#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminate lines with newlines characters</span></span>
<span id="cb78-9"><a href="Moreexamples.html#cb78-9" aria-hidden="true" tabindex="-1"></a>final.vec <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,<span class="st">&quot;&quot;</span>,text.vec)</span>
<span id="cb78-10"><a href="Moreexamples.html#cb78-10" aria-hidden="true" tabindex="-1"></a>final.vec <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;^</span><span class="sc">\\</span><span class="st">s+&quot;</span>,<span class="st">&quot;&quot;</span>,final.vec)</span>
<span id="cb78-11"><a href="Moreexamples.html#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="Moreexamples.html#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="co">#final.vec &lt;- text.vec[grep(&quot;^\n&quot;,text.vec,invert=TRUE)]</span></span>
<span id="cb78-13"><a href="Moreexamples.html#cb78-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-14"><a href="Moreexamples.html#cb78-14" aria-hidden="true" tabindex="-1"></a>final.vec</span></code></pre></div>
<pre><code>##  [1] &quot;Pediatric home hemodialysis is infrequently performed despite a growing need globally among patients with end-stage renal disease who do not have immediate access to a kidney transplant. In this review, we expand the scope of the Implementing Hemodialysis in the Home website and associated supplement published previously in Hemodialysis International and offer information tailored to the pediatric population. We describe the experience and outcomes of centers managing pediatric patients, and offer recommendations and practical tools to assist clinicians in providing quotidian dialysis for children, including infrastructural and staffing needs, equipment and prescriptions, and patient selection and training.    &quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
##  [2] &quot;Home hemodialysis (HHD) has been available as a modality of renal replacement therapy since the 1960s. HHD allows intensive dialysis such as nocturnal hemodialysis or short daily hemodialysis. Previous studies have shown that patients receiving HHD have an increased survival and better quality of life compared with those receiving in-center conventional HD. However, HHD may increase the risk for specific complications such as vascular access complications, infection, loss of residual kidney function and patient and caregiver burden. In Japan, only 529 patients (0.2% of the total dialysis patients) were on maintenance HHD at the end of 2014. The most commonly perceived barriers to intensive HHD included lack of patient motivation, unwillingness to change from in-center modality, and fear of self-cannulation. However, these barriers can often be overcome by adequate predialysis education, motivational training of patient and caregiver, nurse-assisted cannulation, nurse-led home visits, a well-defined nursing/technical support system for patients, and provision of respite care.    &quot;                                                                                                                                                                                                                                                                                                                                                                                                
##  [3] &quot;This special supplement of Hemodialysis International focuses on home hemodialysis (HD). It has been compiled by a group of international experts in home HD who were brought together throughout 2013-2014 to construct a home HD \&quot;manual.\&quot; Drawing upon both the literature and their own extensive expertise, these experts have helped develop this supplement that now stands as an A-to-Z guide for any who may be unfamiliar or uncertain about how to establish and maintain a successful home HD program.     &quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
##  [4] &quot;Prescribing a regimen that provides \&quot;optimal dialysis\&quot; to patients who wish to dialyze at home is of major importance, yet there is substantial variation in how home hemodialysis (HD) is prescribed. Geographic location, patient health status and clinical goals, and patient lifestyle and preferences all influence the selection of a prescription for a particular patient-there is no single prescription that provides optimal therapy for all patients, and careful weighing of potential benefit and burden is required for long-term success. This article describes how home HD prescribing patterns have changed over time and provides examples of commonly used home HD prescriptions. In addition, associated clinical outcomes and adequacy parameters as well as criteria for identifying which patients may benefit most from these diverse prescriptions are also presented.     &quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
##  [5] &quot;Home hemodialysis (HD) was first introduced in the 1960s with a rapid increase in its use due to inability of dialysis units to accommodate patient demand. A sharp decline was subsequently seen with expanding outpatient dialysis facilities and changes in reimbursement policies. In the last decade, with emerging reports of benefits with home HD and more user-friendly equipment, there has been resurgence in home HD. However, home HD remains underutilized with considerable variations between and within countries. This paper will review the history of home HD, elaborate on its established benefits, identify some of the barriers in uptake of this modality and expand on potential strategies to overcome these barriers.    &quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
##  [6] &quot;Home hemodialysis (HD) is undergoing a resurgence. A major driver of this is economics, however, providers are also encouraged by a combination of excellent patient outcomes and patient experiences as well as the development of newer technologies that offer ease of use. Home HD offers significant advantages in flexible scheduling and the practical implementation of extended hours dialysis. This paper explores the reasons why home HD is making a comeback and strives to offer approaches to improve the uptake of this dialysis modality.    &quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [7] &quot;The home extracorporeal hemodialysis, which aroused a great interest in the past, has not kept its promises due to the complexity and expectations for family involvement in treatment management. In the United States NxStage One portable system was proposed and designed for home use. In this work we describe, starting from the history of home hemodialysis, the method with NxStage system by comparing it with the conventional HD in 5 patients. The dialysis efficiency was similar between the two treatments, even if home hemodialysis showed a reduction in serum urea, creatinine and phosphorus. At the same time phosphate binders use decreased with an increase in serum calcium while hemoglobin increased reducing doses of erythropoietin. The method was successful in the training of the patients and their partners during hospital training and at home. Patients have shown great enthusiasm at the beginning and during the therapy, which is developed around the users personal needs, being able to decide at its own times during 24 hours according to personal needs, in addition to faster recovery after the dialysis. This method certainly improved the patients&#39; wellness and increased their autonomy.     &quot;                                                                                                                                                                                                                                                                                
##  [8] &quot;Most hemodialysis (HD) in Japan is based on the central dialysis fluid delivery system (CDDS). With CDDS, there is an improvement in work efficiency, reduction in cost, and a reduction in regional and institutional differences in dialysis conditions. This has resulted in an improvement in the survival rate throughout Japan. However, as the number of cases with various complications increases, it is necessary to select the optimal dialysis prescription (including hours and frequency) for each individual in order to further improve survival rates. To perform intensive HD, home HD is essential, and various prescriptions have been tried. However, several challenges remain before widespread implementation of home HD can occur.    &quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
##  [9] &quot;Home hemodialysis (HD) is a modality of renal replacement therapy that can be safely and independently performed at home by end-stage renal disease (ESRD) patients. Home HD can be performed at the convenience of the patients on a daily basis, every other day and overnight (nocturnal). Despite the great and many perceived benefits of home HD, including the significant improvements in health outcomes and resource utilization, the adoption of home HD has been limited; lack or inadequate pre-dialysis education and training constitute a major barrier. The lack of self-confidence and/or self-efficacy to manage own therapy, lack of family and/or social support, fear of machine and cannulation of blood access and worries of possible catastrophic events represent other barriers for the implementation of home HD besides inadequate competence and/or expertise in caring for home HD patients among renal care providers (nephrologists, dialysis nurses, educators). A well-studied, planned and prepared and carefully implemented central country program supported by adequate budget can play a positive role in overcoming the challenges to home HD. Healthcare authorities, with the increasingly financial and logistic demands and the relatively higher mortality and morbidity rates of the conventional in-center HD, should tackle home HD as an attractive and cost-effective modality with more freedom, quality of life and improvement of clinical outcomes for the ESRD patients.     &quot;
## [10] &quot;Home hemodialysis (HHD) is emerging as an important alternate renal replacement therapy. Although there are multiple clinical advantages with HHD, concerns surrounding increased risks of infection in this group of patients remain a major barrier to its implementation. In contrast to conventional hemodialysis, infection related complication represents the major morbidity in this mode of renal replacement therapy. Vascular access related infection is an important cause of infection in this population. Use of central vein catheters and buttonhole cannulation in HHD are important modifiable risk factors for HHD associated infection. Several preventive measures are suggested in the literature, which will require further prospective validation.    &quot;</code></pre>
<p>Well that was tedious. And we processed only the first page of results. How do we “progrmmatically” hit the “Next” Button at the bottom of the page ? This is complicated by the fact that there appears to be some Javascript at work that we would have to somehow interact with to get the URL for the next page. Unlike with the school salary example it isn’t obvious how to do this. If we hove over the “Next” button we don’t get an associated link.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="xml.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="APIs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Web_Scraping.pdf", "Web_Scraping.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
