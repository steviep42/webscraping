[
["index.html", "Web Scraping with R Chapter 1 Motivations 1.1 Lots of Data For The Taking ? 1.2 Web Scraping Can Be Ugly 1.3 Understanding The Language of The Web 1.4 Useful Packages 1.5 Quick rvest tutorial 1.6 Example: Parsing A Table From Wikipedia 1.7 Summary", " Web Scraping with R Steve Pittard 2019-02-17 Chapter 1 Motivations 1.1 Lots of Data For The Taking ? The web hosts lots of interesting data that you can ”scrape”. Some of it is stashed in data bases, behind APIs, or in free form text. Lots of people want to grab information of of Twitter or from user forums to see what people are thinking. There is a lot of valuable information out there for the taking although some web sites have “caught on” and either block programmatic access or they setup “pay walls” that require you to subscribe to an API for access. The New York Times does this. But there are lots of opportunities to get data. tables Fetch tables like from Wikipedia forms You can submit forms and fetch the results css You can access parts of a web site using style or css selectors Tweets Process tweets including emojis Web Sites User forums have lots of content Instagram Yes you can “scrape” photos also 1.2 Web Scraping Can Be Ugly Depending on what web sites you want to scrape the process can be involved and quite tedious. Many websites are very much aware that people are scraping so they offer Application Programming Interfaces (APIs) to make requests for information easier for the user and easier for the server administrators to control access. Most times the user must apply for a “key” to gain access. For premium sites, the key costs money. Some sites like Google and Wunderground (a popular weather site) allow some number of free accesses before they start charging you. Even so the results are typically returned in XML or JSON which then requires you to parse the result to get the information you want. In the best situation there is an R package that will wrap in the parsing and will return lists or data frames. Here is a summary: First. Always try to find an R package that will access a site (e.g. New York Times, Wunderground, PubMed). These packages (e.g. omdbapi, easyPubMed, RBitCoin, rtimes) provide a programmatic search interface and return data frames with little to no effort on your part. If no package exists then hopefully there is an API that allows you to query the website and get results back in JSON or XML. I prefer JSON because it’s “easier” and the packages for parsing JSON return lists which are native data structures to R. So you can easily turn results into data frames. You will ususally use the rvest package in conjunction with XML, and the RSJONIO packages. If the Web site doesn’t have an API then you will need to scrape text. This isn’t hard but it is tedious. You will need to use rvest to parse HMTL elements. If you want to parse mutliple pages then you will need to use rvest to move to the other pages and possibly fill out forms. If there is a lot of Javascript then you might need to use RSelenium to programmatically manage the web page. 1.3 Understanding The Language of The Web The Web has its own languages: HTML, CSS, Javascript &lt;h1&gt;, &lt;h2&gt;, ..., &lt;h6&gt; Heading 1 and so on &lt;p&gt; Paragraph elements &lt;ul&gt; Unordered List &lt;ol&gt; Ordered List &lt;li&gt; List Element &lt;div&gt; Division / Section &lt;table&gt; Tables &lt;form&gt; Web forms So to be productive at scraping requires you to have some familiairty with HMTL XML, and CSS. Here we look at a very basic HTML file &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;body&gt; &lt;h1&gt;My First Heading&lt;/h1&gt; &lt;p&gt;My first paragraph.&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; And you could apply some styling to this courtest of the CSS language which allows you to inject styles into plain HTML: There are a number of tools that allow us to inspect web pages and see “what is under the hood”. Warning - I just discovered that one of my favorite browser plugins to find the xpaths and/or css paths of page elements is no longer supported under Firefox or Chrome. I’ve found a couple of replacements but they don’t work as well. I’ll research it more. Selector Gadget http://selectorgadget.com/ Firebug https://getfirebug.com/ (now integrated into a version of Firefox) Google Chrome Right click to inspect a page element Google Chrome View Developer - Developer Tools Oxygen Editor Can obtain via the Emory Software Express Site 1.4 Useful Packages You will use the following three primary packages to help you get data from various web pages: rvest, XML, and RJSONIO. Note that you won’t always use them simultaneously but you might use them in pairs or individually depending on the task at hand. 1.5 Quick rvest tutorial Now let’s do a quick rvest tutorial: library(rvest) ## Loading required package: xml2 url &lt;- &quot;https://en.wikipedia.org/wiki/World_population&quot; (paragraphs &lt;- read_html(url) %&gt;% html_nodes(&quot;p&quot;)) ## {xml_nodeset (64)} ## [1] &lt;p class=&quot;mw-empty-elt&quot;&gt;\\n&lt;/p&gt; ## [2] &lt;p class=&quot;mw-empty-elt&quot;&gt;\\n&lt;/p&gt; ## [3] &lt;p&gt;In &lt;a href=&quot;/wiki/Demographics&quot; class=&quot;mw-redirect&quot; title=&quot;Demog ... ## [4] &lt;p&gt;World population has experienced &lt;a href=&quot;/wiki/Population_growt ... ## [5] &lt;p&gt;Total annual births were highest in the late 1980s at about 139 ... ## [6] &lt;p&gt;Six of the &lt;a href=&quot;/wiki/Earth&quot; title=&quot;Earth&quot;&gt;Earth&lt;/a&gt;&#39;s seven ... ## [7] &lt;p&gt;Estimates of world population by their nature are an aspect of &lt; ... ## [8] &lt;p&gt;It is difficult for estimates to be better than rough approximat ... ## [9] &lt;p&gt;Estimates of the population of the world at the time agriculture ... ## [10] &lt;p&gt;The &lt;a href=&quot;/wiki/Plague_of_Justinian&quot; title=&quot;Plague of Justini ... ## [11] &lt;p&gt;Starting in AD 2, the &lt;a href=&quot;/wiki/Han_Dynasty&quot; class=&quot;mw-redi ... ## [12] &lt;p&gt;The &lt;a href=&quot;/wiki/Pre-Columbian_era&quot; title=&quot;Pre-Columbian era&quot;&gt; ... ## [13] &lt;p&gt;During the European &lt;a href=&quot;/wiki/British_Agricultural_Revoluti ... ## [14] &lt;p&gt;Population growth in the West became more rapid after the introd ... ## [15] &lt;p&gt;The first half of the 20th century in &lt;a href=&quot;/wiki/Russian_Emp ... ## [16] &lt;p&gt;Many countries in the &lt;a href=&quot;/wiki/Developing_world&quot; class=&quot;mw ... ## [17] &lt;p&gt;It is estimated that the world population reached one billion fo ... ## [18] &lt;p&gt;According to current projections, the global population will rea ... ## [19] &lt;p&gt;There is no estimation for the exact day or month the world&#39;s po ... ## [20] &lt;p&gt;As of 2012, the global &lt;a href=&quot;/wiki/Human_sex_ratio&quot; title=&quot;Hu ... ## ... Then we might want to actually parse out those paragraphs into text: url &lt;- &quot;https://en.wikipedia.org/wiki/World_population&quot; paragraphs &lt;- read_html(url) %&gt;% html_nodes(&quot;p&quot;) %&gt;% html_text() paragraphs[1:10] ## [1] &quot;\\n&quot; ## [2] &quot;\\n&quot; ## [3] &quot;In demographics, the world population is the total number of humans currently living, and was estimated to have reached 7.7 billion people as of November 2018.[1] It took over 200,000 years of human history for the world&#39;s population to reach 1 billion;[2] and only 200 years more to reach 7 billion.[3]&quot; ## [4] &quot;World population has experienced continuous growth since the end of the Great Famine of 1315–1317 and the Black Death in 1350, when it was near 370 million.[4] \\nThe highest population growth rates – global population increases above 1.8% per year – occurred between 1955 and 1975, peaking to 2.06% between 1965 and 1970.[5] The growth rate has declined to 1.18% between 2010 and 2015 and is projected to decline further in the course of the 21st century.[5]&quot; ## [5] &quot;Total annual births were highest in the late 1980s at about 139 million,[6] and as of 2011 were expected to remain essentially constant at a level of 135 million,[7] while deaths numbered 56 million per year and were expected to increase to 80 million per year by 2040.[8] \\nThe median age of the world&#39;s population was estimated to be 30.4 years in 2018.[9]&quot; ## [6] &quot;Six of the Earth&#39;s seven continents are permanently inhabited on a large scale. Asia is the most populous continent, with its 4.54 billion inhabitants accounting for 60% of the world population. The world&#39;s two most populated countries, China and India, together constitute about 36% of the world&#39;s population. Africa is the second most populated continent, with around 1.28 billion people, or 16% of the world&#39;s population. Europe&#39;s 742 million people make up 10% of the world&#39;s population as of 2018, while the Latin American and Caribbean regions are home to around 651 million (9%). Northern America, primarily consisting of the United States and Canada, has a population of around 363 million (5%), and Oceania, the least populated region, has about 41 million inhabitants (0.5%).[11] Though it is not permanently inhabited by any fixed population, Antarctica has a small, fluctuating international population based mainly in polar science stations. This population tends to rise in the summer months and decrease significantly in winter, as visiting researchers return to their home countries.[12]&quot; ## [7] &quot;Estimates of world population by their nature are an aspect of modernity, possible only since the Age of Discovery. Early estimates for the population of the world[14] date to the 17th century: William Petty in 1682 estimated world population at 320 million (modern estimates ranging close to twice this number); by the late 18th century, estimates ranged close to one billion (consistent with modern estimates).[15] More refined estimates, broken down by continents, were published in the first half of the 19th century, at 600 to 1000 million in the early 1800s and at 800 to 1000 million in the 1840s.[16]&quot; ## [8] &quot;It is difficult for estimates to be better than rough approximations, as even modern population estimates are fraught with uncertainties on the order of 3% to 5%.[17]&quot; ## [9] &quot;Estimates of the population of the world at the time agriculture emerged in around 10,000 BC have ranged between 1 million and 15 million.[18][19] Even earlier, genetic evidence suggests humans may have gone through a population bottleneck of between 1,000 and 10,000 people about 70,000 BC, according to the Toba catastrophe theory. By contrast, it is estimated that around 50–60 million people lived in the combined eastern and western Roman Empire in the 4th century AD.[20]&quot; ## [10] &quot;The Plague of Justinian, which first emerged during the reign of the Roman emperor Justinian, caused Europe&#39;s population to drop by around 50% between the 6th and 8th centuries AD.[21] The population of Europe was more than 70 million in 1340.[22] The Black Death pandemic of the 14th century may have reduced the world&#39;s population from an estimated 450 million in 1340 to between 350 and 375 million in 1400;[23] it took 200 years for population figures to recover.[24] The population of China decreased from 123 million in 1200 to 65 million in 1393,[25] presumably due to a combination of Mongol invasions, famine, and plague.[26]&quot; Get some other types of HTML obejects. Let’s get all the “h2” HTML elements: read_html(url) %&gt;% html_nodes(&quot;h2&quot;) %&gt;% html_text() ## [1] &quot;Contents&quot; ## [2] &quot;Population by region&quot; ## [3] &quot;History&quot; ## [4] &quot;Global demographics&quot; ## [5] &quot;Largest populations by country&quot; ## [6] &quot;Fluctuation&quot; ## [7] &quot;Mathematical approximations&quot; ## [8] &quot;Overpopulation&quot; ## [9] &quot;Number of humans who have ever lived&quot; ## [10] &quot;See also&quot; ## [11] &quot;Notes&quot; ## [12] &quot;References&quot; ## [13] &quot;External links&quot; ## [14] &quot;Navigation menu&quot; What about tables ? url &lt;- &quot;https://en.wikipedia.org/wiki/World_population&quot; tables &lt;- read_html(url) %&gt;% html_nodes(&quot;table&quot;) tables ## {xml_nodeset (23)} ## [1] &lt;table class=&quot;box-Verify_sources plainlinks metadata ambox ambox-co ... ## [2] &lt;table class=&quot;infobox&quot; style=&quot;float: right; font-size:90%&quot;&gt;&lt;tbody&gt;\\ ... ## [3] &lt;table class=&quot;wikitable sortable&quot;&gt;\\n&lt;caption&gt;Population by continen ... ## [4] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:center; float:right; cle ... ## [5] &lt;table width=&quot;100%&quot;&gt;&lt;tbody&gt;&lt;tr&gt;\\n&lt;td valign=&quot;top&quot;&gt; &lt;div class=&quot;lege ... ## [6] &lt;table class=&quot;wikitable sortable&quot; style=&quot;text-align:left&quot;&gt;&lt;tbody&gt;\\n ... ## [7] &lt;table class=&quot;wikitable sortable&quot; style=&quot;text-align:right&quot;&gt;\\n&lt;capti ... ## [8] &lt;table class=&quot;wikitable sortable&quot; style=&quot;text-align:right&quot;&gt;\\n&lt;capti ... ## [9] &lt;table class=&quot;wikitable sortable&quot; style=&quot;font-size:97%; text-align: ... ## [10] &lt;table class=&quot;wikitable sortable&quot; style=&quot;font-size:97%; text-align: ... ## [11] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:right;&quot;&gt;&lt;tbody&gt;\\n&lt;tr&gt;\\n&lt; ... ## [12] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:center; margin:1em; floa ... ## [13] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:right; font-size:96%;&quot;&gt;\\ ... ## [14] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:center;&quot;&gt;\\n&lt;caption&gt;Star ... ## [15] &lt;table class=&quot;wikitable&quot; style=&quot;text-align:center;&quot;&gt;\\n&lt;caption&gt;Star ... ## [16] &lt;table role=&quot;presentation&quot; class=&quot;mbox-small plainlinks sistersiteb ... ## [17] &lt;table class=&quot;nowraplinks collapsible autocollapse navbox-inner&quot; st ... ## [18] &lt;table class=&quot;nowraplinks collapsible collapsed navbox-inner&quot; style ... ## [19] &lt;table class=&quot;nowraplinks hlist collapsible autocollapse navbox-inn ... ## [20] &lt;table class=&quot;nowraplinks hlist collapsible autocollapse navbox-inn ... ## ... 1.6 Example: Parsing A Table From Wikipedia Look at the Wikipedia Page for world population: https://en.wikipedia.org/wiki/World_population We can get any table we want using rvest We might have to experiment to figure out which one Get the one that lists the ten most populous countries I think this might be the 4th or 5th table on the page How do we get this ? First we will load packages that will help us throughout this session. ## Warning: package &#39;tibble&#39; was built under R version 3.5.2 ## Warning: package &#39;purrr&#39; was built under R version 3.5.2 ## Warning: package &#39;stringr&#39; was built under R version 3.5.2 In this case we’ll need to figure out what number table it is we want. We could fetch all the tables and then experiment to find the precise one. library(rvest) library(tidyr) library(dplyr) library(ggplot2) # Use read_html to fetch the webpage url &lt;- &quot;https://en.wikipedia.org/wiki/World_population&quot; ten_most_df &lt;- read_html(url) ten_most_populous &lt;- ten_most_df %&gt;% html_nodes(&quot;table&quot;) %&gt;% `[[`(6) %&gt;% html_table() # Let&#39;s get just the first three columns ten_most_populous &lt;- ten_most_populous[,2:4] # Get some content - Change the column names names(ten_most_populous) &lt;- c(&quot;Country_Territory&quot;,&quot;Population&quot;,&quot;Date&quot;) # Do reformatting on the columns to be actual numerics where appropriate ten_most_populous %&gt;% mutate(Population=gsub(&quot;,&quot;,&quot;&quot;,Population)) %&gt;% mutate(Population=round(as.numeric(Population)/1e+06)) %&gt;% ggplot(aes(x=Country_Territory,y=Population)) + geom_point() + labs(y = &quot;Population / 1,000,000&quot;) + coord_flip() + ggtitle(&quot;Top 10 Most Populous Countries&quot;) In the above example we leveraged the fact that we were looking specifically for a table element and it became a project to locate the correct table number. This isn’t always the case with more complicated websites in that the element we are trying to grab or scrape is contained within a nested structure that doesn’t correspond neatly to a paragraph, link, heading, or table. This can be the case if the page is heavily styled with CSS or Javascript. We might have to work harder. But it’s okay to try to use simple elements and then try to refine the search some more. 1.7 Summary Need some basic HTML and CSS knowledge to find correct elements How to extract text from common elements How to extract text from specific elements Always have to do some text cleanup of data It usually takes multiple times to get it right See http://bradleyboehmke.github.io/2015/12/scraping-html-text.html "]
]
