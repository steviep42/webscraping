<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 XML and JSON | Web Scraping with R</title>
  <meta name="description" content="This is in support of my talk for the Data Science group" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 XML and JSON | Web Scraping with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is in support of my talk for the Data Science group" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 XML and JSON | Web Scraping with R" />
  
  <meta name="twitter:description" content="This is in support of my talk for the Data Science group" />
  

<meta name="author" content="Steve Pittard" />


<meta name="date" content="2020-02-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="Moreexamples.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Web Scraping</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Motivations</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#lots-of-data-for-the-taking"><i class="fa fa-check"></i><b>1.1</b> Lots of Data For The Taking ?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#web-scraping-can-be-ugly"><i class="fa fa-check"></i><b>1.2</b> Web Scraping Can Be Ugly</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#understanding-the-language-of-the-web"><i class="fa fa-check"></i><b>1.3</b> Understanding The Language of The Web</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#useful-tools"><i class="fa fa-check"></i><b>1.3.1</b> Useful tools</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#useful-packages"><i class="fa fa-check"></i><b>1.4</b> Useful Packages</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#quick-rvest-tutorial"><i class="fa fa-check"></i><b>1.5</b> Quick <strong>rvest</strong> tutorial</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#example-parsing-a-table-from-wikipedia"><i class="fa fa-check"></i><b>1.6</b> Example: Parsing A Table From Wikipedia</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#scraping-patient-dialysis-stories"><i class="fa fa-check"></i><b>1.7</b> Scraping Patient Dialysis Stories</a><ul>
<li class="chapter" data-level="1.7.1" data-path="index.html"><a href="index.html#getting-more-detail"><i class="fa fa-check"></i><b>1.7.1</b> Getting More Detail</a></li>
<li class="chapter" data-level="1.7.2" data-path="index.html"><a href="index.html#writing-some-code"><i class="fa fa-check"></i><b>1.7.2</b> Writing Some Code</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#summary"><i class="fa fa-check"></i><b>1.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="xml.html"><a href="xml.html"><i class="fa fa-check"></i><b>2</b> XML and JSON</a><ul>
<li class="chapter" data-level="2.1" data-path="xml.html"><a href="xml.html#finding-xpaths"><i class="fa fa-check"></i><b>2.1</b> Finding XPaths</a></li>
<li class="chapter" data-level="2.2" data-path="xml.html"><a href="xml.html#example-geocoding-with-google"><i class="fa fa-check"></i><b>2.2</b> Example: GeoCoding With Google</a></li>
<li class="chapter" data-level="2.3" data-path="xml.html"><a href="xml.html#using-json"><i class="fa fa-check"></i><b>2.3</b> Using JSON</a></li>
<li class="chapter" data-level="2.4" data-path="xml.html"><a href="xml.html#using-the-rjsonio-package"><i class="fa fa-check"></i><b>2.4</b> Using the RJSONIO Package</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Moreexamples.html"><a href="Moreexamples.html"><i class="fa fa-check"></i><b>3</b> More Real Life Examples</a><ul>
<li class="chapter" data-level="3.1" data-path="Moreexamples.html"><a href="Moreexamples.html#bitcoin-prices"><i class="fa fa-check"></i><b>3.1</b> BitCoin Prices</a></li>
<li class="chapter" data-level="3.2" data-path="Moreexamples.html"><a href="Moreexamples.html#imdb"><i class="fa fa-check"></i><b>3.2</b> IMDB</a></li>
<li class="chapter" data-level="3.3" data-path="Moreexamples.html"><a href="Moreexamples.html#faculty-salaries"><i class="fa fa-check"></i><b>3.3</b> Faculty Salaries</a></li>
<li class="chapter" data-level="3.4" data-path="Moreexamples.html"><a href="Moreexamples.html#filling-out-forms-from-a-program"><i class="fa fa-check"></i><b>3.4</b> Filling Out Forms From a Program</a></li>
<li class="chapter" data-level="3.5" data-path="Moreexamples.html"><a href="Moreexamples.html#pubmed"><i class="fa fa-check"></i><b>3.5</b> PubMed</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="APIs.html"><a href="APIs.html"><i class="fa fa-check"></i><b>4</b> APIs</a><ul>
<li class="chapter" data-level="4.1" data-path="APIs.html"><a href="APIs.html#omdb"><i class="fa fa-check"></i><b>4.1</b> OMDB</a></li>
<li class="chapter" data-level="4.2" data-path="APIs.html"><a href="APIs.html#the-omdbapi-package"><i class="fa fa-check"></i><b>4.2</b> The omdbapi package</a></li>
<li class="chapter" data-level="4.3" data-path="APIs.html"><a href="APIs.html#rselenium"><i class="fa fa-check"></i><b>4.3</b> RSelenium</a></li>
<li class="chapter" data-level="4.4" data-path="APIs.html"><a href="APIs.html#easypubmed"><i class="fa fa-check"></i><b>4.4</b> EasyPubMed</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bagofwords.html"><a href="bagofwords.html"><i class="fa fa-check"></i><b>5</b> Bag of Words Sentiment Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="bagofwords.html"><a href="bagofwords.html#workflow"><i class="fa fa-check"></i><b>5.1</b> Workflow</a></li>
<li class="chapter" data-level="5.2" data-path="bagofwords.html"><a href="bagofwords.html#simple-example"><i class="fa fa-check"></i><b>5.2</b> Simple Example</a></li>
<li class="chapter" data-level="5.3" data-path="bagofwords.html"><a href="bagofwords.html#tidytext"><i class="fa fa-check"></i><b>5.3</b> tidytext</a></li>
<li class="chapter" data-level="5.4" data-path="bagofwords.html"><a href="bagofwords.html#back-to-the-pubmed-example"><i class="fa fa-check"></i><b>5.4</b> Back To The PubMed Example</a><ul>
<li class="chapter" data-level="5.4.1" data-path="bagofwords.html"><a href="bagofwords.html#how-do-you-feel"><i class="fa fa-check"></i><b>5.4.1</b> How Do You Feel ?</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="bagofwords.html"><a href="bagofwords.html#bigrams"><i class="fa fa-check"></i><b>5.5</b> BiGrams</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>6</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Web Scraping with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="xml" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> XML and JSON</h1>
<p>This is where things get a little dicey because some web pages will return XML and JSON in response to inquiries and while these formats seem complicated they are actually doing you a really big favor by doing this since these formats can ususally be easily parsed using various packges. XML is a bit hard to get your head around and JSON is the new kid on the block which is easier to use.</p>
<p>Since this isn’t a full-on course lecture I’ll keep it short as to how and why you would want to use these but any time you spend trying to better understand JSON (and XML) the better of you will be when parsing web pages. It’s not such a big deal if all you are going to be parsing is raw text since the mthods we use to do that avoid XML and JSON although cleaning up raw text has its own problems. Let’s revisit the Wikipedia example from the previous section.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)

<span class="co"># Use read_html to fetch the webpage</span>
url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>
ten_most_df &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) 
  
ten_most_populous &lt;-<span class="st"> </span>ten_most_df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()</code></pre></div>
<div class="figure">
<img src="PICS/xml.png" width="650" />

</div>
<div class="figure">
<img src="PICS/xmls.png" width="450" />

</div>
<p>Let’s look at an XML file that has some basic content:  </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;</span>?xml version=<span class="st">&quot;1.0&quot;</span> encoding=<span class="st">&quot;UTF-8&quot;</span>?<span class="op">&gt;</span>
<span class="er">&lt;</span>bookstore<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;COOKING&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Everyday Italian<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>Giada De Laurentiis<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2005</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">30.00</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;CHILDREN&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Harry Potter<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>J K. Rowling<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2005</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">29.99</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;WEB&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Learning XML<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>Erik T. Ray<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2003</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">39.95</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="er">&lt;/</span>bookstore<span class="op">&gt;</span></code></pre></div>
<p>Well we pulled out all tables and then, by experimentation, we isolated table 6 and got the content corresponding to that. But. Is there a more direct way to find the content ? There is. It requires us to install some helper plugins such as the xPath Finder for Firefox and Chrome. In reality there are a number of ways to find the XML Path or CSS Path for an element within a web page but this is a good one to start.</p>
<div class="figure">
<img src="PICS/xpath_finder.png" width="350" />

</div>
<p>Remeber that we want to find the table corresponding to the “10 Most Populous Countries”. So we activate the <em>xPath</em> finder plugin and the highlight the element of interest. This takes some practice to get it right. Once you highlight the desired elment you will see the corresponding XPATH. Here is a screenshot of what I did. We can use the resulting path to directly access the table without first having to first pull out all tables and then trying to find the right one</p>
<div class="figure">
<img src="PICS/xpath_pop.png" width="350" />

</div>
<p> </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use read_html to fetch the webpage</span>
url &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/World_population&quot;</span>
ten_most_populous &lt;-<span class="st"> </span><span class="kw">read_html</span>(url) 

ten_most_df &lt;-<span class="st"> </span>ten_most_populous <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="dt">xpath=</span><span class="st">&#39;/html/body/div[3]/div[3]/div[4]/div/table[5]&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_table</span>() 

<span class="co"># We have to get the first element of the list. </span>
ten_most_df &lt;-<span class="st"> </span>ten_most_df[[<span class="dv">1</span>]]

ten_most_df</code></pre></div>
<pre><code>##    Rank Country / Territory    Population % of worldpopulation
## 1     1       China[note 4] 1,401,231,560                18.0%
## 2     2               India 1,358,326,450                17.5%
## 3     3       United States   329,293,594                4.24%
## 4     4           Indonesia   265,015,300                3.41%
## 5     5            Pakistan   212,742,631                2.74%
## 6     6              Brazil   211,093,998                2.72%
## 7     7             Nigeria   188,500,000                2.43%
## 8     8          Bangladesh   168,062,490                2.16%
## 9     9      Russia[note 5]   146,877,088                1.89%
## 10   10              Mexico   126,577,691                1.63%
##               Date Source
## 1       7 Feb 2020   [87]
## 2       7 Feb 2020   [88]
## 3       7 Feb 2020   [89]
## 4      1 July 2018   [90]
## 5      25 May 2017   [91]
## 6       7 Feb 2020   [92]
## 7  31 October 2016   [93]
## 8       7 Feb 2020   [94]
## 9   1 January 2018   [95]
## 10     1 July 2019   [96]</code></pre>
<div id="finding-xpaths" class="section level2">
<h2><span class="header-section-number">2.1</span> Finding XPaths</h2>
<div class="figure">
<img src="PICS/xml_path_1.png" width="650" />

</div>
<p> </p>
<p>In addition to Browser Plugins there are standalone tools such as the Oxygen XML Editor which is availabel through the Emory Software Express Website. This is a comprehensive XML editor that will allow you to parse XML and develop paths to locate specific nodes within an XML document. If you find yourself working with websites with lots of XML then this will be useful. The Oxygen editor is free.</p>
<div class="figure">
<img src="PICS/xml_path_10.png" width="350" />

</div>
<p>Let’s look at an XML file that has some basic content:  </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;</span>?xml version=<span class="st">&quot;1.0&quot;</span> encoding=<span class="st">&quot;UTF-8&quot;</span>?<span class="op">&gt;</span>
<span class="er">&lt;</span>bookstore<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;COOKING&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Everyday Italian<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>Giada De Laurentiis<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2005</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">30.00</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;CHILDREN&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Harry Potter<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>J K. Rowling<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2005</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">29.99</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;</span>book category=<span class="st">&quot;WEB&quot;</span><span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>title lang=<span class="st">&quot;en&quot;</span><span class="op">&gt;</span>Learning XML<span class="op">&lt;</span><span class="er">/</span>title<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>author<span class="op">&gt;</span>Erik T. Ray<span class="op">&lt;</span><span class="er">/</span>author<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>year<span class="op">&gt;</span><span class="dv">2003</span><span class="op">&lt;</span><span class="er">/</span>year<span class="op">&gt;</span>
<span class="st">    </span><span class="er">&lt;</span>price<span class="op">&gt;</span><span class="fl">39.95</span><span class="op">&lt;</span><span class="er">/</span>price<span class="op">&gt;</span>
<span class="st">  </span><span class="er">&lt;/</span>book<span class="op">&gt;</span>
<span class="er">&lt;/</span>bookstore<span class="op">&gt;</span></code></pre></div>
<div class="figure">
<img src="PICS/xml_path_2.png" width="650" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/xml_path_3.png" width="550" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/xml_path_4.png" width="550" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/xml_path_4.png" width="550" />

</div>
<p> </p>
<div class="figure">
<img src="PICS/xml_path_6.png" width="550" />

</div>
<div class="figure">
<img src="PICS/xml_path_7.png" width="550" />

</div>
<div class="figure">
<img src="PICS/xml_path_8.png" width="550" />

</div>
<div class="figure">
<img src="PICS/xml_path_9.png" width="550" />

</div>
</div>
<div id="example-geocoding-with-google" class="section level2">
<h2><span class="header-section-number">2.2</span> Example: GeoCoding With Google</h2>
<p>Let’s run through an example of using the GeoCoding API with Google. They used to provide free access to this service and they still do although you are limited to a certain number. Still, you have to sign up for an account and get an API key. You need to go to the Google Cloud Website and enable the Geocoding API service. Again, this is free but you must generate an API key that you can use to access the service. If you plan on doing thousands of gecoding requests per day then you will need to pay some money. But for learning and examples you can stick with the free version.</p>
<div class="figure">
<img src="PICS/google_api2.png" />

</div>
<p>So one way to do this is to create a URL according to the specification given in the Google Geocoding documentation. We need 1) the base Google URL for the Geocoding service, 2) the format of the desired output (XML or JSON), 3) and address for which we want to find the latitude and longitude, and 4) the API key we create at the Google API service. Here is a fully functional URL you can paste into your browser:</p>
<p><a href="https://maps.googleapis.com/maps/api/geocode/xml?address=1510+Clifton+Road,+Atlanta,+GA&amp;key=AIzaSyDPwt1Ya79b7lhsZkh75BjCz-GpMKC9ZYw" class="uri">https://maps.googleapis.com/maps/api/geocode/xml?address=1510+Clifton+Road,+Atlanta,+GA&amp;key=AIzaSyDPwt1Ya79b7lhsZkh75BjCz-GpMKC9ZYw</a></p>
<p>If you paste this into Chome then you get something back like this:</p>
<div class="figure">
<img src="PICS/geocode1.png" />

</div>
<p>So I could create an R function to take care of this kind of thing so I could maybe pass in arbitrary addressess to be geocided. Let’s run through this example and then look at how I parsed the XML file that is returned by the Google GeoCoding API. We will stick with the <em>1510 Clifton Rd, Atlanta, GA</em> address which corresponds to the Rollins Research Building.</p>
<p>First we will see an example of what Google returns in terms of XML. We can use some tools like Oxygen Editor (available free via Emory Software Express) to develop an appropriate XPATH expression to parse out the latitude and longitude information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># https://maps.googleapis.com/maps/api/geocode/xml?address=1510+Clifton+Road,+Atlanta,+GA&amp;key=AIzaSyDPwt1Ya79b7lhsZkh75BjCz-GpMKC9ZYw</span>

<span class="co"># https://maps.googleapis.com/maps/api/geocode/json?address=1510+Clifton+Road,+Atlanta,+GA&amp;key=AIzaSyDPwt1Ya79b7lhsZkh75BjCz-GpMKC9ZYw</span>

myGeo &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">address=</span><span class="st">&quot;1510 Clifton Rd Atlanta GA&quot;</span>,<span class="dt">form=</span><span class="st">&quot;xml&quot;</span>) {
  <span class="kw">library</span>(XML)
  <span class="kw">library</span>(RCurl)
  
  geourl &lt;-<span class="st"> &quot;https://maps.googleapis.com/maps/api/geocode/&quot;</span>
  
  <span class="co"># You will need to replace this with your OWN key !</span>
  key &lt;-<span class="st"> &quot;AIzaSyDPwt1Ya79b7lhsZkh75BjCz-GpMKC9ZYw&quot;</span>
  
  address &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot; &quot;</span>,<span class="st">&quot;+&quot;</span>,address)
  
  add &lt;-<span class="st"> </span><span class="kw">paste0</span>(geourl,form,<span class="dt">sep=</span><span class="st">&quot;?address=&quot;</span>)
  add &lt;-<span class="st"> </span><span class="kw">paste0</span>(add,address,<span class="st">&quot;&amp;key=&quot;</span>)
  geourl &lt;-<span class="st"> </span><span class="kw">paste0</span>(add,key)
  
  locale &lt;-<span class="st"> </span><span class="kw">getURL</span>(geourl)
  plocal &lt;-<span class="st"> </span><span class="kw">xmlParse</span>(locale,<span class="dt">useInternalNodes=</span><span class="ot">TRUE</span>)
  
  <span class="co"># Okay let&#39;s extract the lat and lon</span>
  latlon &lt;-<span class="st"> </span><span class="kw">getNodeSet</span>(plocal,<span class="st">&quot;/GeocodeResponse/result/geometry/location/descendant::*&quot;</span>)
  lat  &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">xmlSApply</span>(latlon,xmlValue))[<span class="dv">1</span>]
  lon  &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">xmlSApply</span>(latlon,xmlValue))[<span class="dv">2</span>]
  
  <span class="kw">return</span>(<span class="kw">c</span>(<span class="dt">lat=</span>lat,<span class="dt">lng=</span>lon))  
}

<span class="kw">myGeo</span>()</code></pre></div>
<p>  Now. We could have saved the report to a file on our local computer and open it up with Oxygen editor and figure out what the approproate XPATH would be. This is basically what I did. Here is a screenshot of the session. I picked an XPATH expression of //location/descendant::*</p>
<div class="figure">
<img src="PICS/oxygen2.png" width="650" />

</div>
<p>  We could expand this considerable to process a number of addresses. This is a great example of how once you get a single example working then you can generalize this into a function that will allow you to do the same thing for a much larger numnber of addressess.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">namevec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Atlanta GA&quot;</span>, 
             <span class="st">&quot;Birmingham AL&quot;</span>, 
             <span class="st">&quot;Seattle WA&quot;</span>, 
             <span class="st">&quot;Sacramento CA&quot;</span>,
             <span class="st">&quot;Denver CO&quot;</span>, 
             <span class="st">&quot;LosAngeles CA&quot;</span>, 
             <span class="st">&quot;Rochester NY&quot;</span>)

cityList &lt;-<span class="st"> </span><span class="kw">lapply</span>(namevec,myGeo,<span class="dt">eval=</span><span class="ot">FALSE</span>)

<span class="co"># Or to get a data frame</span>

cities &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">city=</span>namevec,<span class="kw">do.call</span>(rbind,cityList),
                     <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
cities


<span class="co"># Let&#39;s create a Map</span>

<span class="kw">library</span>(leaflet)
m &lt;-<span class="st"> </span><span class="kw">leaflet</span>(<span class="dt">data=</span>cities)
m &lt;-<span class="st"> </span><span class="kw">addTiles</span>(m)
m &lt;-<span class="st"> </span><span class="kw">addMarkers</span>(m,<span class="dt">popup=</span>cities<span class="op">$</span>city)

<span class="co"># Put up the Map - click on the markers</span>
m</code></pre></div>
</div>
<div id="using-json" class="section level2">
<h2><span class="header-section-number">2.3</span> Using JSON</h2>
<p>JSON is fast becoming the primary interchange format over XML although XML is still well supported. R has a number of packages to ease the parsing of JSON/ documents returned by web pages. Ususally you get back a <em>list</em> which is a native data type in R that can easily be manipulated into a data frame. Most web APIs provide an option for JSON or XML although some only provide JSON.</p>
<div class="figure">
<img src="PICS/json.png" width="650" />

</div>
<p>There are rules and regulations about how JSON is formed and we will learn them by example but you can look at the numerous tutotorials on the web to locate definitive references. See <a href="http://www.w3schools.com/json/" class="uri">http://www.w3schools.com/json/</a> Here is an XML file that describes some employees.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;</span>employees<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;</span>employee<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>firstName<span class="op">&gt;</span>John<span class="op">&lt;</span><span class="er">/</span>firstName<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>lastName<span class="op">&gt;</span>Doe<span class="op">&lt;</span><span class="er">/</span>lastName<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;/</span>employee<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;</span>employee<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>firstName<span class="op">&gt;</span>Anna<span class="op">&lt;</span><span class="er">/</span>firstName<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>lastName<span class="op">&gt;</span>Smith<span class="op">&lt;</span><span class="er">/</span>lastName<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;/</span>employee<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;</span>employee<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>firstName<span class="op">&gt;</span>Peter<span class="op">&lt;</span><span class="er">/</span>firstName<span class="op">&gt;</span>
<span class="st">         </span><span class="er">&lt;</span>lastName<span class="op">&gt;</span>Jones<span class="op">&lt;</span><span class="er">/</span>lastName<span class="op">&gt;</span>
<span class="st">     </span><span class="er">&lt;/</span>employee<span class="op">&gt;</span>
<span class="st"> </span><span class="er">&lt;/</span>employees<span class="op">&gt;</span></code></pre></div>
<p>And here is the corresposning JSON file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">{
  <span class="st">&quot;employees&quot;</span><span class="op">:</span>[
    {<span class="st">&quot;firstName&quot;</span><span class="op">:</span><span class="st">&quot;John&quot;</span>, <span class="st">&quot;lastName&quot;</span><span class="op">:</span><span class="st">&quot;Doe&quot;</span>},
    {<span class="st">&quot;firstName&quot;</span><span class="op">:</span><span class="st">&quot;Anna&quot;</span>, <span class="st">&quot;lastName&quot;</span><span class="op">:</span><span class="st">&quot;Smith&quot;</span>},
    {<span class="st">&quot;firstName&quot;</span><span class="op">:</span><span class="st">&quot;Peter&quot;</span>,<span class="st">&quot;lastName&quot;</span><span class="op">:</span><span class="st">&quot;Jones&quot;</span>}
] }</code></pre></div>
<ul>
<li><p>It is important to note that the actual information in the document, things like city name, county name, latitude, and longitude are the same as they would be in the comparable XML document.</p></li>
<li><p>JSON documents are at the heart of the NoSQL“database”called MongoDB</p></li>
<li><p>JSON can be found within many webpages since it is closely related to JavaScript which is a language strongly related to web pages.</p></li>
<li><p>JSON is very compact and lighweight which has made it a natural followon to XML so much so that it appears to be replacing XML</p></li>
</ul>
<p>See http:..www.json.org/ for a full description of the specification</p>
<ul>
<li><p>An object is an unordered set of name/value pairs. An object begins with (left brace) and ends with (right brace). Each name is followed by : (colon) and the name/value pairs are separated by , (comma).</p></li>
<li><p>An array is an ordered collection of values. An array begins with [ (left bracket) and ends with ] (right bracket). Values are separated by , (comma).</p></li>
<li><p>A value can be a string in double quotes, or a number, or true or false or null, or an object or an array. These structures can be nested.</p></li>
<li><p>A string is a sequence of zero or more Unicode characters, wrapped in double quotes, using backslash escapes. A character is represented as a single character string.</p></li>
</ul>
<p>Do you remember the Google Geocoding example from before ? We can tell Google to send us back JSON instead of XML just by adjusting the URL accordingly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;https://maps.googleapis.com/maps/api/geocode/json?address=1510+Clifton+Rd+Atlanta+GA&amp;key=AIzaSyD0zIyn2ijIqb7OKYTGnAnchXY7zt3VB9Y&quot;</span></code></pre></div>
<div class="figure">
<img src="PICS/json_google.png" width="650" />

</div>
</div>
<div id="using-the-rjsonio-package" class="section level2">
<h2><span class="header-section-number">2.4</span> Using the RJSONIO Package</h2>
<p>To read/parse this in R we use a package called RJSONIO. There are other packages but this is the one we will be using. Download and install it.</p>
<p>There is a function called fromJSON which will parse the JSON file and return a list to contain the data.</p>
<p>So we parse lists instead of using XPath. Many people feel this to be easier than trying to construct XPath statments. You will have to decide for yourself.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RJSONIO)

url &lt;-<span class="st"> &quot;https://maps.googleapis.com/maps/api/geocode/json?address=1510+Clifton+Road,+Atlanta,+GA&amp;key=AIzaSyD0zIyn2ijIqb7OKYTGnAnchXY7zt3VB9Y&quot;</span>
geo &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(url)
<span class="kw">str</span>(geo,<span class="dv">3</span>)</code></pre></div>
<pre><code>## List of 2
##  $ results:List of 1
##   ..$ :List of 6
##   .. ..$ address_components:List of 7
##   .. ..$ formatted_address : chr &quot;1510 Clifton Rd, Atlanta, GA 30322, USA&quot;
##   .. ..$ geometry          :List of 3
##   .. ..$ place_id          : chr &quot;ChIJ5QjdF_oG9YgRWAJzCm19Vf8&quot;
##   .. ..$ plus_code         : Named chr [1:2] &quot;QMWG+MP Druid Hills, Georgia, United States&quot; &quot;865QQMWG+MP&quot;
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;compound_code&quot; &quot;global_code&quot;
##   .. ..$ types             : chr &quot;street_address&quot;
##  $ status : chr &quot;OK&quot;</code></pre>
<p>Since what we get back is a list we can directly access whatever we want. We just index into the list. No need for complicated XPATHS.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">geo<span class="op">$</span>results[[<span class="dv">1</span>]]<span class="op">$</span>geometry<span class="op">$</span>location</code></pre></div>
<pre><code>##       lat       lng 
##  33.79667 -84.32319</code></pre>
<p>Let’s put this into a function that helps us get the information for a number of addresses</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myGeo &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">address=</span><span class="st">&quot;1510 Clifton Rd Atlanta GA&quot;</span>,<span class="dt">form=</span><span class="st">&quot;json&quot;</span>) {
  <span class="kw">library</span>(RJSONIO)
  
  geourl &lt;-<span class="st"> &quot;https://maps.googleapis.com/maps/api/geocode/&quot;</span>
  
  <span class="co"># You will need to replace this with your OWN key !</span>
  key &lt;-<span class="st"> &quot;AIzaSyD0zIyn2ijIqb7OKYTGnAnchXY7zt3VB9Y&quot;</span>
  
  address &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot; &quot;</span>,<span class="st">&quot;+&quot;</span>,address)
  
  add &lt;-<span class="st"> </span><span class="kw">paste0</span>(geourl,form,<span class="dt">sep=</span><span class="st">&quot;?address=&quot;</span>)
  add &lt;-<span class="st"> </span><span class="kw">paste0</span>(add,address,<span class="st">&quot;&amp;key=&quot;</span>)
  geourl &lt;-<span class="st"> </span><span class="kw">paste0</span>(add,key)
  
  geo &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(geourl)
  
  
  lat  &lt;-<span class="st"> </span>geo<span class="op">$</span>results[[<span class="dv">1</span>]]<span class="op">$</span>geometry<span class="op">$</span>location[<span class="dv">1</span>]
  lng  &lt;-<span class="st"> </span>geo<span class="op">$</span>results[[<span class="dv">1</span>]]<span class="op">$</span>geometry<span class="op">$</span>location[<span class="dv">2</span>]
  
  <span class="kw">return</span>(<span class="kw">c</span>(lat,lng))  
}</code></pre></div>
<p>Consider the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">namevec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Atlanta GA&quot;</span>, 
             <span class="st">&quot;Birmingham AL&quot;</span>, 
             <span class="st">&quot;Seattle WA&quot;</span>, 
             <span class="st">&quot;Sacramento CA&quot;</span>,
             <span class="st">&quot;Denver CO&quot;</span>, 
             <span class="st">&quot;LosAngeles CA&quot;</span>, 
             <span class="st">&quot;Rochester NY&quot;</span>)

cityList &lt;-<span class="st"> </span><span class="kw">lapply</span>(namevec,myGeo)

<span class="co"># Or to get a data frame</span>

cities &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">city=</span>namevec,<span class="kw">do.call</span>(rbind,cityList),
                     <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
cities</code></pre></div>
<pre><code>##            city      lat        lng
## 1    Atlanta GA 33.74900  -84.38798
## 2 Birmingham AL 33.51859  -86.81036
## 3    Seattle WA 47.60621 -122.33207
## 4 Sacramento CA 38.58157 -121.49440
## 5     Denver CO 39.73924 -104.99025
## 6 LosAngeles CA 34.05223 -118.24368
## 7  Rochester NY 43.15658  -77.60885</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Let&#39;s create a Map</span>

<span class="kw">library</span>(leaflet)
m &lt;-<span class="st"> </span><span class="kw">leaflet</span>(<span class="dt">data=</span>cities)
m &lt;-<span class="st"> </span><span class="kw">addTiles</span>(m)
m &lt;-<span class="st"> </span><span class="kw">addMarkers</span>(m,<span class="dt">popup=</span>cities<span class="op">$</span>city)

<span class="co"># Put up the Map - click on the markers</span>
m</code></pre></div>
<div id="htmlwidget-2b6594d1a1234cbe965e" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-2b6594d1a1234cbe965e">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[[33.7489954,33.5185892,47.6062095,38.5815719,39.7392358,34.0522342,43.1565779],[-84.3879824,-86.8103567,-122.3320708,-121.4943996,-104.990251,-118.2436849,-77.6088465],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Atlanta GA","Birmingham AL","Seattle WA","Sacramento CA","Denver CO","LosAngeles CA","Rochester NY"],null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[33.5185892,47.6062095],"lng":[-122.3320708,-77.6088465]}},"evals":[],"jsHooks":[]}</script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Moreexamples.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["Web_Scraping.pdf", "Web_Scraping.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
